<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head profile="http://gmpg.org/xfn/11">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>

  <title>Shaker | The distributed data-plane testing tool for OpenStack</title>

  <!-- LIBS -->

  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.4/js/bootstrap.js"></script>
  <script type="text/javascript"
          src="https://cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/3.0.1/handlebars.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/3.2.7/js-yaml.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.js"></script>

  <!-- STYLES -->

  <link rel="stylesheet"
        href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.4/simplex/bootstrap.min.css">
  <link rel=stylesheet type=text/css
        href="https://cdn.datatables.net/1.10.2/css/jquery.dataTables.min.css">
  <link rel=stylesheet type=text/css
        href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.css">
  <link rel='stylesheet' type='text/css'
        href='http://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic&subset=latin,cyrillic'>

  <script type="application/javascript">
    var report = {"scenarios": {"OpenStack L2": {"file_name": "/root/shaker-env/lib/python2.7/site-packages/shaker/scenarios/openstack/full_l2.yaml", "title": "OpenStack L2", "execution": {"tests": [{"title": "Download", "method": "tcp_download", "class": "flent"}, {"title": "Upload", "method": "tcp_upload", "class": "flent"}, {"title": "Bi-directional", "method": "tcp_bidirectional", "class": "flent"}], "progression": "quadratic"}, "description": "In this scenario Shaker launches pairs of instances in the same tenant network. Every instance is hosted on a separate compute node, all available compute nodes are utilized. The traffic goes within the tenant network (L2 domain).", "deployment": {"accommodation": ["pair", "single_room"], "template": "l2.hot"}}}, "records": {"494f79af-b9e5-4414-8dd3-13e9fb458771": {"meta": [["concurrency", ""], ["ping_icmp", "ms"], ["tcp_download", "Mbits/s"], ["tcp_upload", "Mbits/s"]], "scenario": "OpenStack L2", "test": "Bi-directional", "type": "test", "chart": [["concurrency", 1], ["ping_icmp", 2.355382871780875], ["tcp_download", 4675.371847076773], ["tcp_upload", 4611.370486958058]], "id": "494f79af-b9e5-4414-8dd3-13e9fb458771"}, "16568902-8d33-4d43-a607-de63e5f80b87": {"status": "ok", "node": "node-3.domain.tld", "finish": 1476268232.002497, "stats": {"ping_icmp": {"max": 2.968013708440238, "avg": 2.0379776793964837, "unit": "ms", "min": 0.24463451336978048}, "tcp_upload": {"max": 7244.190945418827, "avg": 6986.998395486882, "unit": "Mbits/s", "min": 5882.2}}, "stderr": "", "scenario": "OpenStack L2", "concurrency": 1, "schedule": 1476268161.518803, "agent": "shaker_afeorz_master_0", "start": 1476268161.528977, "meta": [["time", "s"], ["ping_icmp", "ms"], ["tcp_upload", "Mbits/s"]], "command": {"data": "zcat `flent -H 10.0.0.4 -l 60 -s 1 tcp_upload 2>&1 | grep \"se with\" | grep -Po '\\./\\S+'`", "type": "script"}, "samples": [[0.0, 1.01, null], [1.0, 0.5349942884823011, null], [2.0, 0.4380070758073517, null], [3.0, 0.541972135256138, null], [4.0, 0.4720005675837198, null], [5.0, 0.49299873835445374, null], [6.0, 2.7114737399027264, 5882.2], [7.0, 2.043124376559123, 7063.220923022453], [8.0, 2.1493834207603, 7167.192179861069], [9.0, 2.1996545538272665, 7123.014243965342], [10.0, 2.5767513884115125, 7244.190945418827], [11.0, 2.5601929884100736, 7165.83884267807], [12.0, 2.2927602889991188, 7213.945597327902], [13.0, 2.517284997107825, 7101.439749291295], [14.0, 2.5989184099651603, 7050.567133137342], [15.0, 2.2157793289338494, 6907.417256861859], [16.0, 2.2001646091318605, 6430.474253225797], [17.0, 2.5731140540773416, 6996.229457663322], [18.0, 2.334771979677537, 6976.312523472309], [19.0, 2.2222451849929405, 6984.769086821079], [20.0, 2.4840586842636463, 7017.513648707229], [21.0, 2.3825232732800687, 6941.715550889866], [22.0, 2.2238764184465136, 7048.345257713592], [23.0, 2.483037331419451, 7004.893989197091], [24.0, 2.1592009852315277, 7007.997545814514], [25.0, 2.4705441305850564, 6945.483462323673], [26.0, 2.5381848957930404, 6993.485793962479], [27.0, 2.094457083389892, 7060.591044249485], [28.0, 2.0896739924576613, 7023.4762210774425], [29.0, 2.553568776791318, 7093.315429177284], [30.0, 0.24463451336978048, 7041.21581182003], [31.0, 2.2390515478309427, 6974.523207659721], [32.0, 2.4641214313583175, 6971.668555257308], [33.0, 2.5179598052316847, 7050.170669231415], [34.0, 2.3954997414650125, 7088.346675377718], [35.0, 0.34977572119651645, 7040.475138530731], [36.0, 2.2277837760700225, 6812.7829385223], [37.0, 2.5584874911144104, 7081.25496975347], [38.0, 2.5033337538678264, 7020.090053672729], [39.0, 2.6996304144958225, 6992.704373941422], [40.0, 2.9281903418750743, 7025.783595938682], [41.0, 2.163112643324517, 6960.419892223362], [42.0, 2.2524501305589952, 7073.25040091709], [43.0, 2.968013708440238, 7085.3238413118215], [44.0, 2.160664216546274, 7039.75375289917], [45.0, 1.5063666067293426, 7047.80184353071], [46.0, 2.1663403789891547, 6860.967222157252], [47.0, 2.7734591230589327, 7032.71503714323], [48.0, 2.5943907598928893, 7033.652733763361], [49.0, 2.4115281313438035, 7051.209747850303], [50.0, 2.213066533957511, 7059.2921329575165], [51.0, 2.433284394300616, 6935.388371829987], [52.0, 2.8504197571697967, 7002.777062520981], [53.0, 2.601295134591971, 6999.653540067673], [54.0, 2.3295664387308923, 6868.957345244429], [55.0, 2.106204505793462, 6928.730816963591], [56.0, 2.5061347944832457, 6805.751363180032], [57.0, 2.355347634245436, 6984.508309100064], [58.0, 2.1556012571796233, 7010.700666712239], [59.0, 2.388538600639337, 6986.074871592522], [60.0, 2.2445519593786027, 6987.376105908326], [61.0, 2.303419790235946, 6867.751532657631], [62.0, 2.493236493780551, 6977.840709767342], [63.0, 2.6563150128190602, 7026.561836098901], [64.0, 2.277370890252608, 7033.594866645336], [65.0, 0.4906807423148267, 7002.291996092126], [66.0, 0.5110211815942598, 7001.91], [67.0, 0.502555389796299, null], [68.0, 0.4954405323944159, null], [69.0, 0.4548745794370686, null]], "executor": "flent", "test": "Upload", "type": "agent", "id": "16568902-8d33-4d43-a607-de63e5f80b87"}, "ac5fb062-e7a2-4de4-b456-509041b4064d": {"stats": {"ping_icmp": {"max": 3.585925979115096, "avg": 1.9169166891673195, "unit": "ms", "min": 0.2972419599436358}, "tcp_download": {"max": 7276.151771461963, "avg": 6999.268662203987, "unit": "Mbits/s", "min": 5706.169314246177}}, "scenario": "OpenStack L2", "concurrency": 1, "test": "Download", "type": "concurrency", "id": "ac5fb062-e7a2-4de4-b456-509041b4064d", "node_chart": [["x", "node-3.domain.tld"], ["Avg ping_icmp, ms", 1.9169166891673195], ["Max ping_icmp, ms", 3.585925979115096], ["Min ping_icmp, ms", 0.2972419599436358], ["Avg tcp_download, Mbits/s", 6999.268662203987], ["Max tcp_download, Mbits/s", 7276.151771461963], ["Min tcp_download, Mbits/s", 5706.169314246177]]}, "47e25ff0-475e-4b8d-b13d-d58d7f1d7109": {"status": "ok", "node": "node-3.domain.tld", "finish": 1476268322.506103, "stats": {"ping_icmp": {"max": 3.984316705018472, "avg": 2.355382871780875, "unit": "ms", "min": 0.36613813446702825}, "tcp_download": {"max": 4821.028016171498, "avg": 4675.371847076773, "unit": "Mbits/s", "min": 3387.34}, "tcp_upload": {"max": 4750.571339032221, "avg": 4611.370486958058, "unit": "Mbits/s", "min": 3841.5286333346157}}, "stderr": "", "scenario": "OpenStack L2", "concurrency": 1, "schedule": 1476268252.034491, "agent": "shaker_afeorz_master_0", "start": 1476268252.044697, "meta": [["time", "s"], ["ping_icmp", "ms"], ["tcp_download", "Mbits/s"], ["tcp_upload", "Mbits/s"]], "command": {"data": "zcat `flent -H 10.0.0.4 -l 60 -s 1 tcp_bidirectional 2>&1 | grep \"se with\" | grep -Po '\\./\\S+'`", "type": "script"}, "samples": [[0.0, 0.972, null, null], [1.0, 0.5430287391958919, null, null], [2.0, 0.36613813446702825, null, null], [3.0, 0.4907731490920884, null, null], [4.0, 0.37615724624068214, null, null], [5.0, 0.45288512022357413, null, null], [6.0, 2.7757146513671898, 3387.34, 4071.82], [7.0, 2.869719113845292, 4768.222855464026, 4717.42038286505], [8.0, 2.003152927327081, 4769.11811706543, 4716.25216665268], [9.0, 1.9004715762258515, 4209.256298818588, 3845.7712224069714], [10.0, 2.406830083330715, 4735.195088406595, 4694.4892439556115], [11.0, 2.6380986285790424, 4763.23552537918, 4732.936361803871], [12.0, 3.2436904754257223, 4182.235571240001, 3841.5286333346157], [13.0, 2.7753557750054973, 4716.889410710335, 4617.403634106425], [14.0, 3.4313059303049767, 4772.162908611298, 4663.970655336742], [15.0, 2.631218826256158, 4730.284720107048, 4627.386559636593], [16.0, 2.1567830720402683, 4213.839369697571, 4160.807513761466], [17.0, 2.622244801397559, 4776.384278469086, 4652.939333032256], [18.0, 2.796929076522274, 4755.97449771881, 4683.233819669912], [19.0, 2.6529339701382244, 4770.068451871873, 4646.510227159809], [20.0, 2.5325409636859306, 4781.11019505066, 4690.9127870272705], [21.0, 2.510455275046733, 4777.909643495083, 4702.996701200088], [22.0, 3.5041691923293414, 4762.638557089123, 4715.116286551455], [23.0, 2.048825028689175, 4755.2200296068195, 4672.127735840293], [24.0, 3.060099116647619, 4759.263456837789, 4713.090401093959], [25.0, 2.3514067389938695, 4769.205902814865, 4738.6358507447185], [26.0, 3.4346526375696147, 4720.0129204845425, 4661.092665736017], [27.0, 2.395029159021042, 4787.315115537643, 4728.249195764771], [28.0, 3.0460903343007173, 4721.021227053104, 4654.373173353299], [29.0, 2.3262937329422337, 4723.474635448456, 4750.571339032221], [30.0, 2.8495653801638356, 4224.260364577999, 3970.2105292367937], [31.0, 2.157086718139304, 4543.415370912552, 4599.835282753225], [32.0, 2.6396967314773363, 4724.50368452549, 4599.650349887031], [33.0, 2.4967817735813576, 4764.101069529848, 4690.601435006043], [34.0, 3.5432343631962917, 4763.475164897442, 4685.579479641915], [35.0, 3.016243421926863, 4773.44129730918, 4708.987090296626], [36.0, 3.209753180770084, 4711.341999306679, 4704.874869880677], [37.0, 2.4369184148484218, 4766.361785292625, 4676.424596048296], [38.0, 3.0098795297673484, 4706.339168643952, 4625.115639333076], [39.0, 1.4383960726221403, 4773.0708157825475, 4672.810347298744], [40.0, 2.48202974549114, 4731.179743732164, 4679.198638238907], [41.0, 3.6492425772657633, 4743.783693959714, 4681.688321085628], [42.0, 3.984316705018472, 4706.789031047821, 4663.948451366425], [43.0, 2.8743805904257362, 4779.44975455761, 4667.593760351021], [44.0, 2.2148635692504186, 4757.8401962208745, 4743.754421746823], [45.0, 2.9058420397823514, 4751.050325074196, 4681.862236230373], [46.0, 3.3735080049907546, 4723.617554507256, 4677.226082730293], [47.0, 1.9318335858033708, 4487.984881606102, 4311.842575327516], [48.0, 2.112324128444994, 4763.796243224144, 4667.903995600915], [49.0, 3.3100507789136238, 4724.945059349796, 4657.807510013581], [50.0, 2.332039190651379, 4796.095502507686, 4744.654252344529], [51.0, 2.9606749325352952, 4683.706975662708, 4730.269729034115], [52.0, 2.8980224991586394, 4730.084580059051, 4724.89434556708], [53.0, 2.312457277087161, 4786.678167684078, 4682.427059019063], [54.0, 2.95776876338687, 4745.385085673332, 4693.393452391784], [55.0, 2.1552692886276095, 4773.353814796669, 4696.294988760777], [56.0, 2.6559333613962375, 4737.29448656559, 4719.295578410625], [57.0, 3.902294605955099, 4386.161379493333, 4068.1748543802746], [58.0, 2.9459768655979834, 4731.616916027069, 4692.5582348918915], [59.0, 2.583081548129106, 4779.274027996063, 4707.892971686541], [60.0, 2.8179273852878297, 4779.145359859466, 4727.407109527588], [61.0, 1.339166629920903, 4688.041140823365, 4694.286966815275], [62.0, 2.3029227886486616, 4372.42096282959, 4502.481469049169], [63.0, 2.4458390672605432, 4811.240132465362, 4695.316603649137], [64.0, 2.715266171012562, 4821.028016171498, 4717.821620898247], [65.0, 0.5582468319277685, 4774.3101420324665, 4714.9589658755385], [66.0, 0.5235977538390469, 4773.72, 4714.92], [67.0, 0.5142753082671883, null, null], [68.0, 0.4954984459475424, null, null], [69.0, 0.5096015219328538, null, null]], "executor": "flent", "test": "Bi-directional", "type": "agent", "id": "47e25ff0-475e-4b8d-b13d-d58d7f1d7109"}, "bd1c64a0-3f7d-411e-b6f6-22c37a03db91": {"status": "ok", "node": "node-3.domain.tld", "finish": 1476268141.481311, "stats": {"ping_icmp": {"max": 3.585925979115096, "avg": 1.9169166891673195, "unit": "ms", "min": 0.2972419599436358}, "tcp_download": {"max": 7276.151771461963, "avg": 6999.268662203987, "unit": "Mbits/s", "min": 5706.169314246177}}, "stderr": "", "scenario": "OpenStack L2", "concurrency": 1, "schedule": 1476268065.392498, "agent": "shaker_afeorz_master_0", "start": 1476268065.402674, "meta": [["time", "s"], ["ping_icmp", "ms"], ["tcp_download", "Mbits/s"]], "command": {"data": "zcat `flent -H 10.0.0.4 -l 60 -s 1 tcp_download 2>&1 | grep \"se with\" | grep -Po '\\./\\S+'`", "type": "script"}, "samples": [[0.0, 3.26, null], [1.0, 0.4652183542620588, null], [2.0, 0.5677262703726639, null], [3.0, 0.4600026849388093, null], [4.0, 0.46114747010012236, null], [5.0, 0.5190961372318588, null], [6.0, 1.8501913979933207, 6004.23], [7.0, 2.0099488843568087, 7221.7776456403735], [8.0, 2.0799018397894664, 7181.190092036723], [9.0, 2.0001935514296045, 7078.4623537755015], [10.0, 2.019911699642682, 6642.233297541168], [11.0, 2.884462840654697, 6087.1995999479295], [12.0, 2.1153705667002902, 6081.401728229523], [13.0, 2.3975871979453176, 7194.395338206292], [14.0, 2.6474989812890404, 6607.858175415992], [15.0, 1.9972985521246556, 7137.426123445034], [16.0, 2.14804073779051, 7180.725606148243], [17.0, 2.120402369211491, 7153.603268594742], [18.0, 1.9918800396503302, 7184.785867643356], [19.0, 0.30847426799368804, 7156.956586812713], [20.0, 2.218479861968236, 6943.970512430668], [21.0, 1.9944611628264772, 7164.127819886207], [22.0, 2.2255755496667486, 7128.827542319298], [23.0, 2.1515738075298065, 7276.151771461963], [24.0, 2.600178640793337, 7207.3562990260125], [25.0, 2.0625728433731725, 7122.986403687], [26.0, 2.1574713249272848, 7210.593241844177], [27.0, 2.052647327101842, 7179.103701503276], [28.0, 2.030504062674666, 7213.197733697892], [29.0, 0.3660390393836299, 7211.953596754073], [30.0, 3.077217938133615, 6256.1735784459115], [31.0, 2.179868121128912, 6975.590635399818], [32.0, 2.169384868681115, 7087.022680648983], [33.0, 2.6247347683388034, 6108.500320715904], [34.0, 0.2972419599436358, 5706.169314246177], [35.0, 2.230152800460762, 7038.238842558861], [36.0, 2.1455779043330088, 7155.718708834648], [37.0, 2.2074721821716823, 7171.809389910698], [38.0, 2.1233582729310707, 7181.369326901436], [39.0, 2.446804807751594, 7181.45050863266], [40.0, 2.200817528802005, 7140.7837644815445], [41.0, 2.0078200648365225, 7175.99968744278], [42.0, 2.201096037524056, 7241.762772181201], [43.0, 2.152575085020457, 7258.401230080128], [44.0, 0.45993542158155987, 7247.376362199783], [45.0, 2.107011306981178, 6555.65737256527], [46.0, 2.409056291016296, 6227.995403515733], [47.0, 2.1156120960882125, 7140.618457715511], [48.0, 2.0809991496021514, 7190.184340877533], [49.0, 2.08, 7178.295567624568], [50.0, 2.1558176805289575, 7128.06742106676], [51.0, 2.330342206807851, 7153.607379522324], [52.0, 2.150970338536042, 7195.017376668453], [53.0, 2.224947549034081, 7163.490032982826], [54.0, 2.192297672188145, 7198.667431218624], [55.0, 1.9734588672510138, 7123.5400347256655], [56.0, 2.1572607027624584, 7198.7793698191645], [57.0, 2.1230955202299064, 7147.690090386867], [58.0, 2.1012566800909647, 7124.613021042347], [59.0, 3.585925979115096, 7171.149964163304], [60.0, 2.23265878377412, 6693.175134343282], [61.0, 2.9038613443198567, 7119.432144522667], [62.0, 2.8016586421302927, 7094.449507451057], [63.0, 2.2505097559726983, 7169.158995699882], [64.0, 2.2750310689766526, 7184.681334564686], [65.0, 1.156212311439502, 7150.236585237875], [66.0, 0.43879844329493034, 7150.0], [67.0, 0.7809943181126917, null], [68.0, 0.36266482125554494, null], [69.0, 0.5058114868423061, null]], "executor": "flent", "test": "Download", "type": "agent", "id": "bd1c64a0-3f7d-411e-b6f6-22c37a03db91"}, "55d6b5c2-3b85-4a17-a8f5-26a2c9b50a0e": {"meta": [["concurrency", ""], ["ping_icmp", "ms"], ["tcp_upload", "Mbits/s"]], "scenario": "OpenStack L2", "test": "Upload", "type": "test", "chart": [["concurrency", 1], ["ping_icmp", 2.0379776793964837], ["tcp_upload", 6986.998395486882]], "id": "55d6b5c2-3b85-4a17-a8f5-26a2c9b50a0e"}, "2097b085-761f-4364-9a09-c7b8f8ad8ebc": {"stats": {"ping_icmp": {"max": 2.968013708440238, "avg": 2.0379776793964837, "unit": "ms", "min": 0.24463451336978048}, "tcp_upload": {"max": 7244.190945418827, "avg": 6986.998395486882, "unit": "Mbits/s", "min": 5882.2}}, "scenario": "OpenStack L2", "concurrency": 1, "test": "Upload", "type": "concurrency", "id": "2097b085-761f-4364-9a09-c7b8f8ad8ebc", "node_chart": [["x", "node-3.domain.tld"], ["Avg ping_icmp, ms", 2.0379776793964837], ["Max ping_icmp, ms", 2.968013708440238], ["Min ping_icmp, ms", 0.24463451336978048], ["Avg tcp_upload, Mbits/s", 6986.998395486882], ["Max tcp_upload, Mbits/s", 7244.190945418827], ["Min tcp_upload, Mbits/s", 5882.2]]}, "3330d5e5-5d98-4979-955a-879615fe665a": {"stats": {"ping_icmp": {"max": 3.984316705018472, "avg": 2.355382871780875, "unit": "ms", "min": 0.36613813446702825}, "tcp_download": {"max": 4821.028016171498, "avg": 4675.371847076773, "unit": "Mbits/s", "min": 3387.34}, "tcp_upload": {"max": 4750.571339032221, "avg": 4611.370486958058, "unit": "Mbits/s", "min": 3841.5286333346157}}, "scenario": "OpenStack L2", "concurrency": 1, "test": "Bi-directional", "type": "concurrency", "id": "3330d5e5-5d98-4979-955a-879615fe665a", "node_chart": [["x", "node-3.domain.tld"], ["Avg ping_icmp, ms", 2.355382871780875], ["Max ping_icmp, ms", 3.984316705018472], ["Min ping_icmp, ms", 0.36613813446702825], ["Avg tcp_download, Mbits/s", 4675.371847076773], ["Max tcp_download, Mbits/s", 4821.028016171498], ["Min tcp_download, Mbits/s", 3387.34], ["Avg tcp_upload, Mbits/s", 4611.370486958058], ["Max tcp_upload, Mbits/s", 4750.571339032221], ["Min tcp_upload, Mbits/s", 3841.5286333346157]]}, "d4fab789-753c-4409-847d-5876b8e1e22e": {"meta": [["concurrency", ""], ["ping_icmp", "ms"], ["tcp_download", "Mbits/s"]], "scenario": "OpenStack L2", "test": "Download", "type": "test", "chart": [["concurrency", 1], ["ping_icmp", 1.9169166891673195], ["tcp_download", 6999.268662203987]], "id": "d4fab789-753c-4409-847d-5876b8e1e22e"}}, "tests": {"Download": {"class": "flent", "method": "tcp_download", "title": "Download"}, "Bi-directional": {"class": "flent", "method": "tcp_bidirectional", "title": "Bi-directional"}, "Upload": {"class": "flent", "method": "tcp_upload", "title": "Upload"}}, "agents": {"shaker_afeorz_master_0": {"node": "node-3.domain.tld", "slave": {"node": "node-2.domain.tld", "zone": "nova", "availability_zone": "nova:node-2.domain.tld", "ip": "10.0.0.4", "mode": "slave", "master_id": "shaker_afeorz_master_0", "id": "shaker_afeorz_slave_0"}, "zone": "nova", "availability_zone": "nova:node-3.domain.tld", "ip": "10.0.0.3", "mode": "master", "slave_id": "shaker_afeorz_slave_0", "id": "shaker_afeorz_master_0"}, "shaker_afeorz_slave_0": {"node": "node-2.domain.tld", "zone": "nova", "availability_zone": "nova:node-2.domain.tld", "ip": "10.0.0.4", "master": {"node": "node-3.domain.tld", "zone": "nova", "availability_zone": "nova:node-3.domain.tld", "ip": "10.0.0.3", "mode": "master", "slave_id": "shaker_afeorz_slave_0", "id": "shaker_afeorz_master_0"}, "mode": "slave", "master_id": "shaker_afeorz_master_0", "id": "shaker_afeorz_slave_0"}}, "sla": []};
  </script>

  <script type="text/javascript">
    "use strict";

    $(function () {

      var fields = ["scenario", "test", "concurrency", "node", "agent"];
      var state = {
        scenario: "",
        test: "",
        concurrency: "",
        node: "",
        agent: ""
      };
      var tablePageSize = 10;

      // compiled templates
      var scenario_source_template = Handlebars.compile($("#scenario_source_template").html());
      var test_specification_template = Handlebars.compile($("#test_specification_template").html());
      var agents_table_template = Handlebars.compile($("#agents_table_template").html());
      var records_table_template = Handlebars.compile($("#records_table_template").html());
      var executor_template = Handlebars.compile($("#executor_template").html());
      var concurrency_summary_template = Handlebars.compile($("#concurrency_summary_template").html());
      var test_summary_template = Handlebars.compile($("#test_summary_template").html());
      var sla_table_template = Handlebars.compile($("#sla_table_template").html());
      var errors_template = Handlebars.compile($("#errors_template").html());

      function concatenate(strings) {
        // returns strings concatenated via comma (like join() but omits empty strings)
        var f = false;
        var result = "";
        $.each(strings, function (_i, string) {
          if (string.length > 0) {
            if (f) result += ", ";
            result += string;
            f = true;
          }
        });
        return result;
      }

      function initSingleSelector(name, values) {
        var selectorId = "#" + name + "_selector";

        var selector_inst = $(selectorId);
        selector_inst.empty();
        selector_inst.append($("<option>", {
          style: "font-style: italic; text-decoration: underline;",
          value: "",
          text: selector_inst.data('placeholder')
        }));

        $.each(values, function (key, item) {
          selector_inst.append($('<option>', {
            value: item, //(key + 1),
            text: item
          }));
        });

        selector_inst.val(state[name]);

        selector_inst.
            on("change", function (e) {
              state[name] = this.value;

              // convert state -> url
              var tokens = [];
              $.each(fields.sort(), function (i, field) {
                if (state[field] != "") {
                  tokens.push(field + "=" + state[field]);
                }
              });
              window.location.href = "#" + tokens.join(":");
            });
      }

      function getFieldValues(field, records) {
        var values_set = {};

        $.each(records, function (j, record) {
          if (record[field]) {
            values_set["" + record[field]] = true;
          }
        });

        return $.map(values_set, function (_i, value) {
          return value;
        }).sort();
      }

      function updateSelectors() {
        $.each(fields, function (i, field) {
          var values = getFieldValues(field, filterRecords(report.records, null, field));
          console.log(values);
          initSingleSelector(field, values);
        });
      }

      function filterRecords(records, type, except_field) {
        var res = [];
        $.each(records, function(_i, record){
          if (!type || typeof type === 'undefined' || record.type == type) {
            var flag = true;
            $.each(state, function (key, value) {
              if (key != except_field && value) {
                flag &= record[key] == value;
              }
            });
            if (flag) {
              res.push(record);
            }
          }
        });
        return res;
      }

      function getAgentsByIds(agent_ids) {
        var agents = [];
        $.each(agent_ids, function(agent_id){
          agents.push(report.agents[agent_id]);
        });
        return agents;
      }

      /* Template Rendering Funcs */

      function showScenarioSource(contentArea, scenario) {
        contentArea.append(scenario_source_template(
            {data: jsyaml.safeDump(scenario)}));
      }

      function showTestSpecification(contentArea, test) {
        contentArea.append(test_specification_template(
            {data: jsyaml.safeDump(test)}
        ))
      }

      function showAgentRecord(contentArea, record) {
        var chart_id = "chart_" + Math.round(Math.random() * 10000);
        var ext_options = {
          command_yaml: jsyaml.safeDump(record["command"]),
          chart_id: chart_id};
        if (record["stats"]) {
          ext_options["stats_yaml"] = jsyaml.safeDump(record["stats"]);
        }
        if ((record["start"]) && (record["finish"])) {
          ext_options["time_info"] = jsyaml.safeDump({
            "start": new Date(record["start"] * 1000).toISOString(),
            "finish": new Date(record["finish"] * 1000).toISOString()
          });
        }
        contentArea.append(executor_template(
            {record: $.extend({}, record, ext_options)}
        ));
        if (record["samples"]) {
          var meta = record["meta"];
          var axes = [];
          axes[meta[1][0]] = 'y';
          var axis = {
            x: {label: concatenate(meta[0])},
            y: {label: concatenate(meta[1]), min: 0}
          };
          if (meta.length > 2) {
            axes[meta[2][0]] = 'y2';
            axis['y2'] = {label: concatenate(meta[2]), min: 0, show: true}
          }

          var chart = [];
          $.each(meta, function(_i, meta_item){  // row titles
            chart.push([meta_item[0]]);
          });
          var samples = record["samples"];
          for (var i=0; i < samples.length; i++) {
            var point = samples[i];
            for (var j=0; j < point.length; j++) {
              chart[j].push(point[j]);
            }
          }

          c3.generate({
            bindto: "#" + chart_id,
            data: {
              x: 'time',
              columns: chart,
              axes: axes
            },
            axis: axis
          });
        }
      }

      function showConcurrencySummary(contentArea, record) {
        var chart_id = "chart_" + Math.round(Math.random() * 10000);
        var node_chart_id = "node_chart_" + Math.round(Math.random() * 10000);
        var ext_options = { chart_id: chart_id, node_chart_id: node_chart_id };
        if (record["stats"]) {
          ext_options["stats_yaml"] = jsyaml.safeDump(record["stats"]);
        }
        console.log(record);
        contentArea.append(concurrency_summary_template(
            {record: $.extend({}, record, ext_options)}
        ));
        if (record["node_chart"]) {
          c3.generate({
            bindto: "#" + node_chart_id,
            data: {
              x: 'x',
              columns: record["node_chart"],
              type: 'step',
              order: null
            },
            axis: {
              x: { type: 'category' }
            }
          });
        }
      }

      function showTestSummary(contentArea, record) {
        console.log(record);
        var chart_id = "chart_" + Math.round(Math.random() * 10000);
        var ext_options = { chart_id: chart_id };
        if (record["stats"]) {
          ext_options["stats_yaml"] = jsyaml.safeDump(record["stats"]);
        }
        contentArea.append(test_summary_template(
            {record: $.extend({}, record, ext_options)}
        ));
        if (record["chart"]) {
          var meta = record["meta"];
          var axes = [];
          axes[meta[1][0]] = 'y';
          var axis = {
            x: {label: concatenate(meta[0])},
            y: {label: concatenate(meta[1]), min: 0}
          };
          if (meta.length > 2) {
            axes[meta[2][0]] = 'y2';
            axis['y2'] = {label: concatenate(meta[2]), min: 0, show: true}
          }

          c3.generate({
            bindto: "#" + chart_id,
            data: {
              x: 'concurrency',
              columns: record["chart"],
              axes: axes
            },
            axis: axis
          });
        }
      }

      function showAgentsTable(contentArea, filteredRecords) {
        var agent_ids = {};
        $.each(filteredRecords, function(_i, record){
          if (record.agent) {
            agent_ids[record.agent] = true;
          }
        });

        var agents = getAgentsByIds(agent_ids);
        if (agents.length == 0) return;

        // add slave agents
        var slave_agent_ids = {};
        $.each(agents, function(_i, agent){
          if (agent.slave_id) {
            slave_agent_ids[agent.slave_id] = true;
          }
        });
        agents = $.merge(agents, getAgentsByIds(slave_agent_ids));

        contentArea.append(agents_table_template({
          agents: agents,
          table_id: "agents_table"
        }));
        $("#agents_table").dataTable({
          "autoWidth": true,
          "paging": false,
          "ordering": true,
          "info": false
        });
      }

      function makeURL(record, s) {
        var extra = {};
        extra[s] = record[s];
        return "#" + $.map($.extend({}, state, extra), function (val, index) {
          return val? (index + "=" + val) : null;
        }).join(":")
      }

      function showRecordsTable(contentArea, filteredRecords) {
        $.each(filteredRecords, function(_i, record) {
          $.each(fields, function(_j, field){
            if (record[field]) {
              record[field + "_url"] = makeURL(record, field);
            }
          });
        });

        contentArea.append(records_table_template({
          records: filteredRecords,
          table_id: "records_table"
        }));
        $("#records_table").dataTable({
          autoWidth: true,
          paging: filteredRecords.length > tablePageSize,
          ordering: true,
          info: false,
          searching: filteredRecords.length > tablePageSize
        });
      }

      function showSlaTable(contentArea, records) {
        if (records.length == 0) return;

        contentArea.append(sla_table_template({
          records: records,
          table_id: "sla_table"
        }));
        $("#records_table").dataTable({
          autoWidth: true,
          paging: records.length > tablePageSize,
          ordering: true,
          info: false,
          searching: records.length > tablePageSize
        });
      }

      function showErrors(contentArea, records) {
        if (records.length == 0) return;

        contentArea.append(errors_template({
          records: records,
          table_id: "errors_list"
        }));
      }

      /* Update cycle */

      function update() {
        var filteredRecords = filterRecords(report.records);
        console.log(filteredRecords);
        var slaRecords = [];
        var errorRecords = [];
        $.each(filterRecords(report.records), function(_i, record) {
          if (record["sla_info"]) {
            slaRecords.push(record);
          }
          if (record["is_status_error"]) {
            errorRecords.push(record);
          }
        });

        var contentArea = $("#content_area");
        contentArea.empty();

        updateSelectors();

        showRecordsTable(contentArea, filteredRecords);
        showSlaTable(contentArea, slaRecords);
        showErrors(contentArea, errorRecords);

        if (state["scenario"] != "" && state["test"] != "" &&
                state["concurrency"] != "" &&
                state["agent"] != "") {
          showAgentRecord(contentArea, filteredRecords[0]);
        }
        if (state["scenario"] != "" && state["test"] != "" &&
                state["concurrency"] != "" && state["node"] == "" &&
                state["agent"] == "") {
          var agg_recs = filterRecords(report.records, "concurrency");
          if (agg_recs.length > 0) {
            showConcurrencySummary(contentArea, agg_recs[0]);
          }
        }
        if (state["scenario"] != "" && state["test"] != "" &&
                state["concurrency"] == "" && state["node"] == "" &&
                state["agent"] == "") {
          var test_recs = filterRecords(report.records, "test");
          if (test_recs.length > 0) {
            showTestSummary(contentArea, test_recs[0]);
          }
        }
        if (state["test"] != "") {
          showTestSpecification(contentArea, report.tests[state["test"]]);
        }
        if (state["agent"] == "") {
          showAgentsTable(contentArea, filteredRecords);
        }
        if (state["scenario"] != "") {
          showScenarioSource(contentArea, report.scenarios[state["scenario"]]);
        }
      }

      function parseUrlToState() {
        var hashUrl = window.location.hash.substr(1);

        $.each(hashUrl.split(":"), function (_i, pair) {
          var kv = pair.split("=");
          if (kv.length == 2) {
            state[kv[0]] = decodeURIComponent(kv[1]);
          }
        });
      }

      // entry-point
      parseUrlToState();
      console.log(state);

      // pre-process records
      $.each(report.records, function(_i, record) {
        if (record.status) {
          record["is_status_ok"] = record.status == "ok";
          record["is_status_lost"] = record.status == "lost";
          record["is_status_interrupted"] = record.status == "interrupted";
          record["is_status_error"] = record.status == "error";
        }
      });

      // auto-select filters with 1 option
      $.each(fields, function(_i, field) {
        var values = getFieldValues(field, report.records);
        if (values.length == 1) {
          state[field] = values[0];
        }
      });

      update();

      $(window).on('hashchange', function() {
        parseUrlToState();
        update()
      });

      $('[data-toggle="tooltip"]').tooltip();
    });
  </script>

  <style type="text/css">
  </style>

</head>

<body>

<div class="container" id="container">
  <div class="row text-center">
    <h1>Shaker | The Report</h1>
  </div>
  <hr>
  <div class="row">
    <div class="col-md-2">
      <label for="scenario_selector" title="Scenario name">Scenario</label>
      <select id="scenario_selector" class="form-control" data-placeholder="- Any scenario -"></select>
    </div>
    <div class="col-md-2">
      <label for="test_selector" title="Test name">Test Case</label>
      <select id="test_selector" class="form-control" data-placeholder="- Any test case -"></select>
    </div>
    <div class="col-md-2">
      <label for="concurrency_selector" title="Concurrency">Concurrency</label>
      <select id="concurrency_selector" class="form-control" data-placeholder="- Any concurrency -"></select>
    </div>
    <div class="col-md-2">
      <label for="node_selector" title="Host / Compute node">Host</label>
      <select id="node_selector" class="form-control" data-placeholder="- Any node -"></select>
    </div>
    <div class="col-md-2">
      <label for="agent_selector" title="Agent">Agent</label>
      <select id="agent_selector" class="form-control" data-placeholder="- Any agent -"></select>
    </div>
  </div>

  <div id="content_area" class="row">
    <!-- Container for the screen content -->
  </div>

  <div id="footer" class="row">&nbsp;</div>
</div>

<!-- TEMPLATES --------------------------------------------------------------->

<!-- Scenario File -->
<script id="scenario_source_template" type="text/x-handlebars-template">
  <h3>Scenario</h3>
  <pre>{{ data }}</pre>
</script>

<!-- Test Specification -->
<script id="test_specification_template" type="text/x-handlebars-template">
  <h3>Test Specification</h3>
  <pre>{{ data }}</pre>
</script>

<!-- Executor Result -->
<script id="executor_template" type="text/x-handlebars-template">
  <h3>Execution Summary</h3>
  {{#with record}}
  <div id="{{ chart_id }}"></div>
  {{#if is_status_ok}}<span class="label label-success"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span>success</span>{{/if}}
  {{#if is_status_lost}}<span class="label label-danger"><span class="glyphicon glyphicon-alert" aria-hidden="true"></span>lost</span>{{/if}}
  {{#if is_status_interrupted}}<span class="label label-warning"><span class="glyphicon glyphicon-stop" aria-hidden="true"></span>interrupted</span>{{/if}}
  {{#if is_status_error}}<span class="label label-danger"><span class="glyphicon glyphicon-alert" aria-hidden="true"></span>error</span>{{/if}}
  {{#if stats_yaml}}
    <h4>Stats</h4>
    <pre>{{ stats_yaml }}</pre>
  {{/if}}
  {{#if time_info}}
    <h4>Time Info</h4>
    <pre>{{ time_info }}</pre>
  {{/if}}
  <h4>Command</h4>
  <pre>{{ command_yaml }}</pre>
  {{#if stdout}}
    <h4>Stdout</h4>
    <pre>{{ stdout }}</pre>
  {{/if}}
  {{#if verbose}}
    <h4>Verbose Info</h4>
    <pre>{{ verbose }}</pre>
  {{/if}}
  {{#if stderr}}
    <h4>Stderr</h4>
    <pre>{{ stderr }}</pre>
  {{/if}}
  {{/with}}
</script>

<!-- Concurrency summary -->
<script id="concurrency_summary_template" type="text/x-handlebars-template">
  {{#with record}}
  <div id="{{ chart_id  }}"></div>
  <h3>Per-node chart</h3>
  <div id="{{ node_chart_id  }}"></div>
  <h3>Stats</h3>
  <pre>{{ stats_yaml }}</pre>
  {{/with}}
</script>

<!-- Test summary -->
<script id="test_summary_template" type="text/x-handlebars-template">
  {{#with record}}
  <div id="{{ chart_id   }}"></div>
  {{#if stats_yaml}}
    <h3>Stats</h3>
    <pre>{{ stats_yaml }}</pre>
  {{/if}}
  {{/with}}
</script>

<!-- Records Table -->
<script id="records_table_template" type="text/x-handlebars-template">
  <h3>Records</h3>
  <table class="table table-striped" id="{{ table_id  }}">
    <thead>
    <tr>
      <th>Scenario</th>
      <th>Test Case</th>
      <th>Concurrency</th>
      <th>Host / Compute Node</th>
      <th>Agent</th>
      <th>Status</th>
    </tr>
    </thead>
    <tbody>
    {{#records}}
    <tr>
      <td><a href="{{ scenario_url }}">{{ scenario }}</a></td>
      <td><a href="{{ test_url }}">{{ test }}</a></td>
      <td><a href="{{ concurrency_url }}">{{ concurrency }}</a></td>
      <td><a href="{{ node_url }}">{{ node }}</a></td>
      <td><a href="{{ agent_url }}">{{ agent }}</a></td>
      <td>
        {{#if is_status_ok }}
          <span class="label label-success">
            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
            success
          </span>
        {{/if}}
        {{#if is_status_lost }}
          <span class="label label-danger">
            <span class="glyphicon glyphicon-alert" aria-hidden="true"></span>
            lost
          </span>
        {{/if}}
        {{#if is_status_interrupted }}
          <span class="label label-warning">
            <span class="glyphicon glyphicon-stop" aria-hidden="true"></span>
            interrupted
          </span>
        {{/if}}
        {{#if is_status_error }}
          <span class="label label-danger">
            <span class="glyphicon glyphicon-stop" aria-hidden="true"></span>
            error
          </span>
        {{/if}}
      </td>
    </tr>
    {{/records}}
    </tbody>
  </table>
</script>

<!-- Agents List -->
<script id="agents_table_template" type="text/x-handlebars-template">
  <h3>Agents</h3>
  <table class="table table-striped" id="{{ table_id }}">
    <thead>
    <tr>
      <th>Agent</th>
      <th>Mode</th>
      <th>IP</th>
      <th>Node</th>
      <th>AZ</th>
    </tr>
    </thead>
    <tbody>
    {{#agents}}
    <tr>
      <td>{{ id }}</td>
      <td>{{ mode }}</td>
      <td>{{ ip }}</td>
      <td>{{ node }}</td>
      <td>{{ zone }}</td>
    </tr>
    {{/agents}}
    </tbody>
  </table>
</script>

<!-- SLA List -->
<script id="sla_table_template" type="text/x-handlebars-template">
  <h3>Agents</h3>
  <table class="table table-striped" id="{{  table_id }}">
    <thead>
    <tr>
      <th>Condition</th>
      <th>Location</th>
      <th>Status</th>
    </tr>
    </thead>
    <tbody>
    {{#records}}
    <tr>
      <td>{{ sla }}</td>
      <td>{{ location }}</td>
      <td>
        {{#if is_status_ok }}
          <span class="text-success">
            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
            {{ status }}
          </span>
        {{else}}
          <span class="text-danger">
            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
            {{ status }}
          </span>
        {{/if}}
      </td>
    </tr>
    {{/records}}
    </tbody>
  </table>
</script>

<!-- Errors -->
<script id="errors_template" type="text/x-handlebars-template">
  <h3>Errors</h3>
  <div class="text-danger">
    <ul>
    {{#records}}
      <li>{{ info }}<br/>{{ stderr }}{{ traceback }}</li>
    {{/records}}
    </ul>
  </div>
</script>

</body>
</html>