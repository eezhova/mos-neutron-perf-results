<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head profile="http://gmpg.org/xfn/11">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>

  <title>Shaker | The distributed data-plane testing tool for OpenStack</title>

  <!-- LIBS -->

  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.4/js/bootstrap.js"></script>
  <script type="text/javascript"
          src="https://cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/3.0.1/handlebars.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/3.2.7/js-yaml.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.js"></script>

  <!-- STYLES -->

  <link rel="stylesheet"
        href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.4/simplex/bootstrap.min.css">
  <link rel=stylesheet type=text/css
        href="https://cdn.datatables.net/1.10.2/css/jquery.dataTables.min.css">
  <link rel=stylesheet type=text/css
        href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.css">
  <link rel='stylesheet' type='text/css'
        href='http://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic&subset=latin,cyrillic'>

  <script type="application/javascript">
    var report = {"scenarios": {"OpenStack L2": {"file_name": "shaker/shaker/scenarios/openstack/full_l2.yaml", "title": "OpenStack L2", "execution": {"tests": [{"title": "Download", "method": "tcp_download", "class": "flent"}, {"title": "Upload", "method": "tcp_upload", "class": "flent"}, {"title": "Bi-directional", "method": "tcp_bidirectional", "class": "flent"}], "progression": "quadratic"}, "description": "In this scenario Shaker launches pairs of instances in the same tenant network. Every instance is hosted on a separate compute node, all available compute nodes are utilized. The traffic goes within the tenant network (L2 domain).", "deployment": {"accommodation": ["pair", "single_room"], "template": "l2.hot"}}}, "records": {"21ff7ecd-4934-403f-92de-5746455d249c": {"meta": [["concurrency", ""], ["ping_icmp", "ms"], ["tcp_upload", "Mbits/s"]], "scenario": "OpenStack L2", "test": "Upload", "type": "test", "chart": [["concurrency", 1], ["ping_icmp", 0.3817303375961426], ["tcp_upload", 2674.756861724384]], "id": "21ff7ecd-4934-403f-92de-5746455d249c"}, "51147673-8496-4dc2-95a1-b5da5ef6e12a": {"status": "ok", "node": "node-2.domain.tld", "finish": 1471442974.255865, "stats": {"ping_icmp": {"max": 3.783582907583198, "avg": 1.6168708142883634, "unit": "ms", "min": 0.33926635068536004}, "tcp_download": {"max": 1367.46, "avg": 1147.0088046424632, "unit": "Mbits/s", "min": 1055.4562953331656}, "tcp_upload": {"max": 1297.0006112748686, "avg": 1128.802600646906, "unit": "Mbits/s", "min": 632.65}}, "stderr": "", "scenario": "OpenStack L2", "concurrency": 1, "schedule": 1471442903.84028, "agent": "shaker_dftrpe_master_0", "start": 1471442903.84969, "meta": [["time", "s"], ["ping_icmp", "ms"], ["tcp_download", "Mbits/s"], ["tcp_upload", "Mbits/s"]], "command": {"data": "zcat `flent -H 10.0.0.5 -l 60 -s 1 tcp_bidirectional 2>&1 | grep \"se with\" | grep -Po '\\./\\S+'`", "type": "script"}, "samples": [[0.0, 1.01, null, null], [1.0, 0.42431572154845687, null, null], [2.0, 0.43599908326252595, null, null], [3.0, 0.43409056003554963, null, null], [4.0, 0.5058044174524258, null, null], [5.0, 0.34000232989230433, null, null], [6.0, 1.8178098746066227, 1367.46, 632.65], [7.0, 0.9653258598884037, 1250.102494649277, 930.5033980128132], [8.0, 1.2591265598955859, 1176.8625888442994, 1042.3356163570306], [9.0, 2.2344991577727917, 1093.413477948544, 1200.741313576999], [10.0, 1.7132846634277779, 1311.9756534273442, 1297.0006112748686], [11.0, 2.513043415903895, 1156.6577951025963, 1115.1886987993194], [12.0, 1.1117333120271702, 1161.9561612629889, 1097.0494454650864], [13.0, 2.1288846612410177, 1102.5946880527274, 1165.2033754714187], [14.0, 0.5844319329618903, 1085.4869892168044, 1171.5178226018452], [15.0, 1.9525509748309453, 1068.2964463704766, 1156.9225765213257], [16.0, 2.1771147425362494, 1149.5001189041138, 1203.110141774821], [17.0, 1.9928629246453535, 1154.8094662043427, 1149.2981179765466], [18.0, 1.6062561738275445, 1114.4956359434127, 1159.9585679842953], [19.0, 3.384139155568045, 1142.8189048685938, 1163.927128282458], [20.0, 1.0241609581710538, 1170.166169304792, 1165.8977085390407], [21.0, 1.7631362526784375, 1203.2021201558273, 1133.931364312394], [22.0, 2.46400599725126, 1121.1561670197295, 1154.703339755941], [23.0, 1.1905411042900915, 1219.0740889803712, 1094.7234186637588], [24.0, 3.6318826348374946, 1165.435280698002, 1078.9971922754282], [25.0, 1.6560535717948, 1184.82289867948, 1147.355784921179], [26.0, 0.6313630232570328, 1070.7550366523844, 1156.601914701462], [27.0, 2.2510741198044064, 1106.7776036644534, 1129.0268042519635], [28.0, 1.552833388205776, 1128.3277851507848, 1133.126871634623], [29.0, 2.1786438969272033, 1103.6263585257532, 1135.3800045068954], [30.0, 1.4549620169547506, 1255.0029670357703, 1051.7570443846007], [31.0, 1.3527056395424828, 1093.7881344566558, 1198.6225676870347], [32.0, 1.5910944473359736, 1202.9691964125634, 1086.4218574328065], [33.0, 3.6461884825483475, 1080.6926993861377, 1128.1931806127309], [34.0, 2.0877238055301737, 1127.6495915985108, 1148.5183451207508], [35.0, 0.7233023626797463, 1190.0743014954396, 1098.406439334698], [36.0, 1.9847724686507626, 1135.6616487324752, 1067.5820463148905], [37.0, 2.882592127930759, 1151.6075900173187, 1110.6324917523123], [38.0, 3.293165748418184, 1093.7144027996064, 1106.3774921602917], [39.0, 0.7356457052274483, 1138.2501424407958, 1154.6134697704256], [40.0, 0.9173275214118088, 1167.690471575675, 1092.4953789523477], [41.0, 1.9344764355993767, 1095.9183477829451, 1157.0117578223517], [42.0, 1.5783976698892144, 1225.584997801595, 1063.577312537461], [43.0, 2.4656702452285115, 1079.4785927637472, 1189.2218673719685], [44.0, 3.783582907583198, 1203.8306307983398, 1053.4096546298879], [45.0, 0.7174823400101324, 1116.3620197270548, 1193.2102025183258], [46.0, 2.1665258006945796, 1189.2961109816968, 1113.8223123721864], [47.0, 2.5061611488194737, 1109.1558014794816, 1232.1525450480585], [48.0, 1.9988956227048047, 1172.5448314039927, 1136.87566860241], [49.0, 1.9321424714657645, 1220.5882374048233, 1123.5817199527737], [50.0, 2.5528464294281563, 1122.0479414725305, 1148.3269805060131], [51.0, 0.47239165044277476, 1215.4775588055538, 1151.1937846861013], [52.0, 1.1618868719822804, 1132.5400555436597, 1180.26624847118], [53.0, 1.1817103719904969, 1184.2003787708281, 1130.9755110153208], [54.0, 2.402435988275217, 1129.1199790143967, 1188.9793288672927], [55.0, 2.311007167730025, 1139.14896482504, 1160.090985674858], [56.0, 2.5342922232816476, 1212.2397293306933, 1124.254262856184], [57.0, 2.2130832445550794, 1090.3478885102272, 1155.4793036659994], [58.0, 1.6002615271642866, 1174.1882596369185, 1145.5602023124695], [59.0, 1.550653814201823, 1055.4562953331656, 1221.3122803535932], [60.0, 1.9042347132313577, 1102.541151290649, 1097.4841794198355], [61.0, 0.5671993620122042, 1077.3788696289062, 1170.9462859178975], [62.0, 1.9499349395999956, 1091.6494943237306, 1132.9238257362929], [63.0, 1.3156087835101964, 1075.9209968279133, 1157.173295933549], [64.0, 0.5420739092132381, 1083.412459754944, 1137.044282949511], [65.0, 0.4051474937215944, 1110.9924143993835, 1116.7133090553418], [66.0, 0.5369013826265897, 1111.24, 1116.6], [67.0, 0.4826339928358049, null, null], [68.0, 0.46960134692966427, null, null], [69.0, 0.33926635068536004, null, null]], "executor": "flent", "test": "Bi-directional", "type": "agent", "id": "51147673-8496-4dc2-95a1-b5da5ef6e12a"}, "802150d8-1c59-44fe-a606-2d1c65df6b56": {"meta": [["concurrency", ""], ["ping_icmp", "ms"], ["tcp_download", "Mbits/s"]], "scenario": "OpenStack L2", "test": "Download", "type": "test", "chart": [["concurrency", 1], ["ping_icmp", 0.3693954537783273], ["tcp_download", 2740.0272303212764]], "id": "802150d8-1c59-44fe-a606-2d1c65df6b56"}, "b4e814e0-e766-4a57-81fc-e65bf75874b5": {"stats": {"ping_icmp": {"max": 1.5673865655830206, "avg": 0.3817303375961426, "unit": "ms", "min": 0.19716788702442584}, "tcp_upload": {"max": 2811.5140831831236, "avg": 2674.756861724384, "unit": "Mbits/s", "min": 2049.8705843584576}}, "scenario": "OpenStack L2", "concurrency": 1, "test": "Upload", "type": "concurrency", "id": "b4e814e0-e766-4a57-81fc-e65bf75874b5", "node_chart": [["x", "node-2.domain.tld"], ["Avg ping_icmp, ms", 0.3817303375961426], ["Max ping_icmp, ms", 1.5673865655830206], ["Min ping_icmp, ms", 0.19716788702442584], ["Avg tcp_upload, Mbits/s", 2674.756861724384], ["Max tcp_upload, Mbits/s", 2811.5140831831236], ["Min tcp_upload, Mbits/s", 2049.8705843584576]]}, "b64d9925-74f1-424f-b371-b2a236094434": {"stats": {"ping_icmp": {"max": 1.34, "avg": 0.3693954537783273, "unit": "ms", "min": 0.15517199619099545}, "tcp_download": {"max": 3024.2965871429446, "avg": 2740.0272303212764, "unit": "Mbits/s", "min": 2087.3293698486054}}, "scenario": "OpenStack L2", "concurrency": 1, "test": "Download", "type": "concurrency", "id": "b64d9925-74f1-424f-b371-b2a236094434", "node_chart": [["x", "node-2.domain.tld"], ["Avg ping_icmp, ms", 0.3693954537783273], ["Max ping_icmp, ms", 1.34], ["Min ping_icmp, ms", 0.15517199619099545], ["Avg tcp_download, Mbits/s", 2740.0272303212764], ["Max tcp_download, Mbits/s", 3024.2965871429446], ["Min tcp_download, Mbits/s", 2087.3293698486054]]}, "995a43d7-714d-487e-a865-a277920bbf7b": {"stats": {"ping_icmp": {"max": 3.783582907583198, "avg": 1.6168708142883634, "unit": "ms", "min": 0.33926635068536004}, "tcp_download": {"max": 1367.46, "avg": 1147.0088046424632, "unit": "Mbits/s", "min": 1055.4562953331656}, "tcp_upload": {"max": 1297.0006112748686, "avg": 1128.802600646906, "unit": "Mbits/s", "min": 632.65}}, "scenario": "OpenStack L2", "concurrency": 1, "test": "Bi-directional", "type": "concurrency", "id": "995a43d7-714d-487e-a865-a277920bbf7b", "node_chart": [["x", "node-2.domain.tld"], ["Avg ping_icmp, ms", 1.6168708142883634], ["Max ping_icmp, ms", 3.783582907583198], ["Min ping_icmp, ms", 0.33926635068536004], ["Avg tcp_download, Mbits/s", 1147.0088046424632], ["Max tcp_download, Mbits/s", 1367.46], ["Min tcp_download, Mbits/s", 1055.4562953331656], ["Avg tcp_upload, Mbits/s", 1128.802600646906], ["Max tcp_upload, Mbits/s", 1297.0006112748686], ["Min tcp_upload, Mbits/s", 632.65]]}, "e84d72d6-5d20-4f53-81dc-416dc240ca55": {"meta": [["concurrency", ""], ["ping_icmp", "ms"], ["tcp_download", "Mbits/s"], ["tcp_upload", "Mbits/s"]], "scenario": "OpenStack L2", "test": "Bi-directional", "type": "test", "chart": [["concurrency", 1], ["ping_icmp", 1.6168708142883634], ["tcp_download", 1147.0088046424632], ["tcp_upload", 1128.802600646906]], "id": "e84d72d6-5d20-4f53-81dc-416dc240ca55"}, "a91517e6-67ed-4002-824a-4e88bfc7d462": {"status": "ok", "node": "node-2.domain.tld", "finish": 1471442792.625889, "stats": {"ping_icmp": {"max": 1.34, "avg": 0.3693954537783273, "unit": "ms", "min": 0.15517199619099545}, "tcp_download": {"max": 3024.2965871429446, "avg": 2740.0272303212764, "unit": "Mbits/s", "min": 2087.3293698486054}}, "stderr": "", "scenario": "OpenStack L2", "concurrency": 1, "schedule": 1471442722.185275, "agent": "shaker_dftrpe_master_0", "start": 1471442722.197501, "meta": [["time", "s"], ["ping_icmp", "ms"], ["tcp_download", "Mbits/s"]], "command": {"data": "zcat `flent -H 10.0.0.5 -l 60 -s 1 tcp_download 2>&1 | grep \"se with\" | grep -Po '\\./\\S+'`", "type": "script"}, "samples": [[0.0, 1.34, null], [1.0, 0.4855186818685443, null], [2.0, 0.4959886306196595, null], [3.0, 0.39400376985432767, null], [4.0, 0.4449964895984925, null], [5.0, 0.42699077477357184, null], [6.0, 0.3740206983083464, 2512.06], [7.0, 0.4529558202131331, 2628.0396204137805], [8.0, 0.2239902938060845, 2545.7331957483293], [9.0, 0.20102727144637367, 2642.459122629166], [10.0, 0.263078758457774, 2733.5499170589446], [11.0, 0.46300060866071996, 2761.0443755647852], [12.0, 0.4659737927932805, 2930.4456247448493], [13.0, 0.3089878320820649, 2651.138218464851], [14.0, 0.2750241543440678, 2682.862428917885], [15.0, 0.3359767742018554, 2677.428320684433], [16.0, 0.2570232151588455, 2810.220942959785], [17.0, 0.31697219186663006, 2786.8939721918105], [18.0, 0.22402209955947264, 2875.5389030885694], [19.0, 0.2770815842121245, 2676.9283502578733], [20.0, 0.49999744006203944, 2173.48726939805], [21.0, 0.4049908823713846, 2209.1197277992064], [22.0, 0.364980472197863, 2575.7732294654847], [23.0, 0.2959974879865148, 2796.172212982178], [24.0, 0.2880488765432452, 2867.8405960273744], [25.0, 0.43697106554865506, 2758.485021095276], [26.0, 0.3090042826562672, 2804.3349353218077], [27.0, 0.32098588604685324, 3024.2965871429446], [28.0, 0.2720467509037319, 2456.782947985913], [29.0, 0.39096247764837677, 2657.931949119568], [30.0, 0.25103286663222574, 2989.3179774814707], [31.0, 0.3339810647687722, 2942.8028511524203], [32.0, 0.27501710942359314, 2945.9235696411133], [33.0, 0.3179914203940172, 2829.7987453365326], [34.0, 0.2920211431136484, 2696.9900673389434], [35.0, 0.34900340144245384, 2687.38628054142], [36.0, 0.36299185567764886, 2573.2856741577584], [37.0, 0.33500397552218963, 2705.473545475006], [38.0, 0.34899302908268226, 2799.8581136322023], [39.0, 0.32705631350017544, 2782.8584773254393], [40.0, 0.5019809333841776, 2859.7721432304384], [41.0, 0.2970522410670674, 2860.1387777900695], [42.0, 0.44297710213602287, 2845.4938777787015], [43.0, 0.3370026393043681, 2806.379983866215], [44.0, 0.34702518902016577, 2835.2716572093964], [45.0, 0.44102365304919794, 2883.122437758446], [46.0, 0.5509853846252897, 2886.411003432274], [47.0, 0.39694688264006206, 2881.380144736767], [48.0, 0.1820094604108746, 2827.5893790602686], [49.0, 0.20205861166574177, 2795.6872524023056], [50.0, 0.32696808546404094, 2810.53387540102], [51.0, 0.22308209254957673, 2777.250284895897], [52.0, 0.4329922286371573, 2750.8273864984512], [53.0, 0.38503563767678545, 2813.332665219307], [54.0, 0.5179605945281689, 2779.430405604839], [55.0, 0.2652411325661593, 2769.713594737053], [56.0, 0.218015003760598, 2753.706222978034], [57.0, 0.3809735015270432, 2087.3293698486054], [58.0, 0.2889881721788932, 2384.3015522527694], [59.0, 0.25495820196438845, 2780.874734535217], [60.0, 0.15517199619099545, 2815.1390586948396], [61.0, 0.5020003347483843, 2858.1983340168], [62.0, 0.6189888022206655, 2997.4294778704193], [63.0, 0.2310504287141579, 2855.8296576595308], [64.0, 0.3479964359095523, 2757.7542698955535], [65.0, 0.3370821045847963, 2738.270731079471], [66.0, 0.5969851901918745, 2738.23], [67.0, 0.4949935791128503, null], [68.0, 0.40702944752781167, null]], "executor": "flent", "test": "Download", "type": "agent", "id": "a91517e6-67ed-4002-824a-4e88bfc7d462"}, "361b8973-e9ef-454a-8abd-3eda81db07a4": {"status": "ok", "node": "node-2.domain.tld", "finish": 1471442883.460644, "stats": {"ping_icmp": {"max": 1.5673865655830206, "avg": 0.3817303375961426, "unit": "ms", "min": 0.19716788702442584}, "tcp_upload": {"max": 2811.5140831831236, "avg": 2674.756861724384, "unit": "Mbits/s", "min": 2049.8705843584576}}, "stderr": "", "scenario": "OpenStack L2", "concurrency": 1, "schedule": 1471442813.051692, "agent": "shaker_dftrpe_master_0", "start": 1471442813.062381, "meta": [["time", "s"], ["ping_icmp", "ms"], ["tcp_upload", "Mbits/s"]], "command": {"data": "zcat `flent -H 10.0.0.5 -l 60 -s 1 tcp_upload 2>&1 | grep \"se with\" | grep -Po '\\./\\S+'`", "type": "script"}, "samples": [[0.0, 0.811, null], [1.0, 0.5748180198751008, null], [2.0, 0.42417225541815906, null], [3.0, 0.49673200684751684, null], [4.0, 0.4099255040348057, null], [5.0, 0.3868213822112236, null], [6.0, 0.33193008974615085, 2528.48], [7.0, 0.30117139117279956, 2636.390302667618], [8.0, 0.3529402066496183, 2581.095723675272], [9.0, 0.3345428765878054, 2677.946194238987], [10.0, 0.19716788702442584, 2647.5247063304737], [11.0, 0.24523752746014926, 2681.1995682529196], [12.0, 0.3144347685125919, 2675.343988137245], [13.0, 0.44405159646347175, 2632.017355954439], [14.0, 0.4597950089313559, 2637.49944100842], [15.0, 0.3955715709875103, 2692.639964299202], [16.0, 0.26327503162942484, 2745.915644401668], [17.0, 0.3925158521706047, 2745.993842850287], [18.0, 0.23041108494659132, 2267.8172373723983], [19.0, 0.3489600294488731, 2049.8705843584576], [20.0, 0.3369536455120779, 2747.028656238149], [21.0, 0.322946463415332, 2767.295252091885], [22.0, 0.30690235510973957, 2744.0474624276812], [23.0, 0.2781973028508, 2797.2399615097047], [24.0, 0.33588654244918525, 2738.2974873109383], [25.0, 0.30206721798735603, 2743.746684678134], [26.0, 0.3221367323545007, 2797.09229090591], [27.0, 0.3640938254074819, 2751.642268300641], [28.0, 0.6918771597732497, 2753.695936264185], [29.0, 0.30882844307030016, 2706.032260809914], [30.0, 0.258121245991536, 2653.2892548147834], [31.0, 0.2943921300316993, 2742.8394026982983], [32.0, 0.40991474497260033, 2811.5140831831236], [33.0, 0.3838679995775147, 2804.132601134558], [34.0, 0.3439037789904762, 2787.407733704281], [35.0, 0.31487239529438693, 2710.9347294770655], [36.0, 0.27723437830786224, 2615.1329009215997], [37.0, 0.3459465932705613, 2520.4540622198792], [38.0, 0.32981876658446313, 2607.3681563123205], [39.0, 0.2759726886749268, 2642.183114885187], [40.0, 0.26891127213840604, 2711.575425860377], [41.0, 0.5341973302890307, 2664.627766739439], [42.0, 0.2807063263440546, 2698.863914091438], [43.0, 0.486393587474177, 2656.6218281173706], [44.0, 0.29719348685811847, 2634.520575786865], [45.0, 0.35368721747207466, 2693.493170003891], [46.0, 0.2591372479110018, 2697.0547451431735], [47.0, 0.3201025952101634, 2645.521584209793], [48.0, 0.3517420379067363, 2672.3944918910306], [49.0, 0.27420457438743545, 2703.2394962120056], [50.0, 0.3338337416078019, 2578.301273243137], [51.0, 0.28382761873243345, 2653.2925816232378], [52.0, 0.23403511793971196, 2698.713277202359], [53.0, 0.5332769056830908, 2676.8821145915986], [54.0, 0.3053451168955628, 2624.241211718584], [55.0, 0.4068167156005564, 2653.5260634517667], [56.0, 0.3509966772561197, 2626.197486560461], [57.0, 0.35401389663159805, 2679.878518303439], [58.0, 1.5673865655830206, 2791.360274505615], [59.0, 0.32810406584154733, 2760.459142901787], [60.0, 0.38794148785410615, 2723.408139607743], [61.0, 0.3654725370945531, 2790.4181365508507], [62.0, 0.2075234102929436, 2770.059511735823], [63.0, 0.3578180571815518, 2686.559805143328], [64.0, 0.3037193403905883, 2710.4844850646095], [65.0, 0.5157062942258578, 2658.8346914920367], [66.0, 0.4230334343943949, 2658.53], [67.0, 0.4399617463142489, null], [68.0, 0.4277122443969329, null], [69.0, 0.6489144820779328, null]], "executor": "flent", "test": "Upload", "type": "agent", "id": "361b8973-e9ef-454a-8abd-3eda81db07a4"}}, "tests": {"Download": {"class": "flent", "method": "tcp_download", "title": "Download"}, "Bi-directional": {"class": "flent", "method": "tcp_bidirectional", "title": "Bi-directional"}, "Upload": {"class": "flent", "method": "tcp_upload", "title": "Upload"}}, "agents": {"shaker_dftrpe_slave_0": {"node": "node-5.domain.tld", "zone": "nova", "availability_zone": "nova:node-5.domain.tld", "ip": "10.0.0.5", "master": {"node": "node-2.domain.tld", "zone": "nova", "availability_zone": "nova:node-2.domain.tld", "ip": "10.0.0.4", "mode": "master", "slave_id": "shaker_dftrpe_slave_0", "id": "shaker_dftrpe_master_0"}, "mode": "slave", "master_id": "shaker_dftrpe_master_0", "id": "shaker_dftrpe_slave_0"}, "shaker_dftrpe_master_0": {"node": "node-2.domain.tld", "slave": {"node": "node-5.domain.tld", "zone": "nova", "availability_zone": "nova:node-5.domain.tld", "ip": "10.0.0.5", "mode": "slave", "master_id": "shaker_dftrpe_master_0", "id": "shaker_dftrpe_slave_0"}, "zone": "nova", "availability_zone": "nova:node-2.domain.tld", "ip": "10.0.0.4", "mode": "master", "slave_id": "shaker_dftrpe_slave_0", "id": "shaker_dftrpe_master_0"}}, "sla": []};
  </script>

  <script type="text/javascript">
    "use strict";

    $(function () {

      var fields = ["scenario", "test", "concurrency", "node", "agent"];
      var state = {
        scenario: "",
        test: "",
        concurrency: "",
        node: "",
        agent: ""
      };
      var tablePageSize = 10;

      // compiled templates
      var scenario_source_template = Handlebars.compile($("#scenario_source_template").html());
      var test_specification_template = Handlebars.compile($("#test_specification_template").html());
      var agents_table_template = Handlebars.compile($("#agents_table_template").html());
      var records_table_template = Handlebars.compile($("#records_table_template").html());
      var executor_template = Handlebars.compile($("#executor_template").html());
      var concurrency_summary_template = Handlebars.compile($("#concurrency_summary_template").html());
      var test_summary_template = Handlebars.compile($("#test_summary_template").html());
      var sla_table_template = Handlebars.compile($("#sla_table_template").html());
      var errors_template = Handlebars.compile($("#errors_template").html());

      function concatenate(strings) {
        // returns strings concatenated via comma (like join() but omits empty strings)
        var f = false;
        var result = "";
        $.each(strings, function (_i, string) {
          if (string.length > 0) {
            if (f) result += ", ";
            result += string;
            f = true;
          }
        });
        return result;
      }

      function initSingleSelector(name, values) {
        var selectorId = "#" + name + "_selector";

        var selector_inst = $(selectorId);
        selector_inst.empty();
        selector_inst.append($("<option>", {
          style: "font-style: italic; text-decoration: underline;",
          value: "",
          text: selector_inst.data('placeholder')
        }));

        $.each(values, function (key, item) {
          selector_inst.append($('<option>', {
            value: item, //(key + 1),
            text: item
          }));
        });

        selector_inst.val(state[name]);

        selector_inst.
            on("change", function (e) {
              state[name] = this.value;

              // convert state -> url
              var tokens = [];
              $.each(fields.sort(), function (i, field) {
                if (state[field] != "") {
                  tokens.push(field + "=" + state[field]);
                }
              });
              window.location.href = "#" + tokens.join(":");
            });
      }

      function getFieldValues(field, records) {
        var values_set = {};

        $.each(records, function (j, record) {
          if (record[field]) {
            values_set["" + record[field]] = true;
          }
        });

        return $.map(values_set, function (_i, value) {
          return value;
        }).sort();
      }

      function updateSelectors() {
        $.each(fields, function (i, field) {
          var values = getFieldValues(field, filterRecords(report.records, null, field));
          console.log(values);
          initSingleSelector(field, values);
        });
      }

      function filterRecords(records, type, except_field) {
        var res = [];
        $.each(records, function(_i, record){
          if (!type || typeof type === 'undefined' || record.type == type) {
            var flag = true;
            $.each(state, function (key, value) {
              if (key != except_field && value) {
                flag &= record[key] == value;
              }
            });
            if (flag) {
              res.push(record);
            }
          }
        });
        return res;
      }

      function getAgentsByIds(agent_ids) {
        var agents = [];
        $.each(agent_ids, function(agent_id){
          agents.push(report.agents[agent_id]);
        });
        return agents;
      }

      /* Template Rendering Funcs */

      function showScenarioSource(contentArea, scenario) {
        contentArea.append(scenario_source_template(
            {data: jsyaml.safeDump(scenario)}));
      }

      function showTestSpecification(contentArea, test) {
        contentArea.append(test_specification_template(
            {data: jsyaml.safeDump(test)}
        ))
      }

      function showAgentRecord(contentArea, record) {
        var chart_id = "chart_" + Math.round(Math.random() * 10000);
        var ext_options = {
          command_yaml: jsyaml.safeDump(record["command"]),
          chart_id: chart_id};
        if (record["stats"]) {
          ext_options["stats_yaml"] = jsyaml.safeDump(record["stats"]);
        }
        if ((record["start"]) && (record["finish"])) {
          ext_options["time_info"] = jsyaml.safeDump({
            "start": new Date(record["start"] * 1000).toISOString(),
            "finish": new Date(record["finish"] * 1000).toISOString()
          });
        }
        contentArea.append(executor_template(
            {record: $.extend({}, record, ext_options)}
        ));
        if (record["samples"]) {
          var meta = record["meta"];
          var axes = [];
          axes[meta[1][0]] = 'y';
          var axis = {
            x: {label: concatenate(meta[0])},
            y: {label: concatenate(meta[1]), min: 0}
          };
          if (meta.length > 2) {
            axes[meta[2][0]] = 'y2';
            axis['y2'] = {label: concatenate(meta[2]), min: 0, show: true}
          }

          var chart = [];
          $.each(meta, function(_i, meta_item){  // row titles
            chart.push([meta_item[0]]);
          });
          var samples = record["samples"];
          for (var i=0; i < samples.length; i++) {
            var point = samples[i];
            for (var j=0; j < point.length; j++) {
              chart[j].push(point[j]);
            }
          }

          c3.generate({
            bindto: "#" + chart_id,
            data: {
              x: 'time',
              columns: chart,
              axes: axes
            },
            axis: axis
          });
        }
      }

      function showConcurrencySummary(contentArea, record) {
        var chart_id = "chart_" + Math.round(Math.random() * 10000);
        var node_chart_id = "node_chart_" + Math.round(Math.random() * 10000);
        var ext_options = { chart_id: chart_id, node_chart_id: node_chart_id };
        if (record["stats"]) {
          ext_options["stats_yaml"] = jsyaml.safeDump(record["stats"]);
        }
        console.log(record);
        contentArea.append(concurrency_summary_template(
            {record: $.extend({}, record, ext_options)}
        ));
        if (record["node_chart"]) {
          c3.generate({
            bindto: "#" + node_chart_id,
            data: {
              x: 'x',
              columns: record["node_chart"],
              type: 'step',
              order: null
            },
            axis: {
              x: { type: 'category' }
            }
          });
        }
      }

      function showTestSummary(contentArea, record) {
        console.log(record);
        var chart_id = "chart_" + Math.round(Math.random() * 10000);
        var ext_options = { chart_id: chart_id };
        if (record["stats"]) {
          ext_options["stats_yaml"] = jsyaml.safeDump(record["stats"]);
        }
        contentArea.append(test_summary_template(
            {record: $.extend({}, record, ext_options)}
        ));
        if (record["chart"]) {
          var meta = record["meta"];
          var axes = [];
          axes[meta[1][0]] = 'y';
          var axis = {
            x: {label: concatenate(meta[0])},
            y: {label: concatenate(meta[1]), min: 0}
          };
          if (meta.length > 2) {
            axes[meta[2][0]] = 'y2';
            axis['y2'] = {label: concatenate(meta[2]), min: 0, show: true}
          }

          c3.generate({
            bindto: "#" + chart_id,
            data: {
              x: 'concurrency',
              columns: record["chart"],
              axes: axes
            },
            axis: axis
          });
        }
      }

      function showAgentsTable(contentArea, filteredRecords) {
        var agent_ids = {};
        $.each(filteredRecords, function(_i, record){
          if (record.agent) {
            agent_ids[record.agent] = true;
          }
        });

        var agents = getAgentsByIds(agent_ids);
        if (agents.length == 0) return;

        // add slave agents
        var slave_agent_ids = {};
        $.each(agents, function(_i, agent){
          if (agent.slave_id) {
            slave_agent_ids[agent.slave_id] = true;
          }
        });
        agents = $.merge(agents, getAgentsByIds(slave_agent_ids));

        contentArea.append(agents_table_template({
          agents: agents,
          table_id: "agents_table"
        }));
        $("#agents_table").dataTable({
          "autoWidth": true,
          "paging": false,
          "ordering": true,
          "info": false
        });
      }

      function makeURL(record, s) {
        var extra = {};
        extra[s] = record[s];
        return "#" + $.map($.extend({}, state, extra), function (val, index) {
          return val? (index + "=" + val) : null;
        }).join(":")
      }

      function showRecordsTable(contentArea, filteredRecords) {
        $.each(filteredRecords, function(_i, record) {
          $.each(fields, function(_j, field){
            if (record[field]) {
              record[field + "_url"] = makeURL(record, field);
            }
          });
        });

        contentArea.append(records_table_template({
          records: filteredRecords,
          table_id: "records_table"
        }));
        $("#records_table").dataTable({
          autoWidth: true,
          paging: filteredRecords.length > tablePageSize,
          ordering: true,
          info: false,
          searching: filteredRecords.length > tablePageSize
        });
      }

      function showSlaTable(contentArea, records) {
        if (records.length == 0) return;

        contentArea.append(sla_table_template({
          records: records,
          table_id: "sla_table"
        }));
        $("#records_table").dataTable({
          autoWidth: true,
          paging: records.length > tablePageSize,
          ordering: true,
          info: false,
          searching: records.length > tablePageSize
        });
      }

      function showErrors(contentArea, records) {
        if (records.length == 0) return;

        contentArea.append(errors_template({
          records: records,
          table_id: "errors_list"
        }));
      }

      /* Update cycle */

      function update() {
        var filteredRecords = filterRecords(report.records);
        console.log(filteredRecords);
        var slaRecords = [];
        var errorRecords = [];
        $.each(filterRecords(report.records), function(_i, record) {
          if (record["sla_info"]) {
            slaRecords.push(record);
          }
          if (record["is_status_error"]) {
            errorRecords.push(record);
          }
        });

        var contentArea = $("#content_area");
        contentArea.empty();

        updateSelectors();

        showRecordsTable(contentArea, filteredRecords);
        showSlaTable(contentArea, slaRecords);
        showErrors(contentArea, errorRecords);

        if (state["scenario"] != "" && state["test"] != "" &&
                state["concurrency"] != "" &&
                state["agent"] != "") {
          showAgentRecord(contentArea, filteredRecords[0]);
        }
        if (state["scenario"] != "" && state["test"] != "" &&
                state["concurrency"] != "" && state["node"] == "" &&
                state["agent"] == "") {
          var agg_recs = filterRecords(report.records, "concurrency");
          if (agg_recs.length > 0) {
            showConcurrencySummary(contentArea, agg_recs[0]);
          }
        }
        if (state["scenario"] != "" && state["test"] != "" &&
                state["concurrency"] == "" && state["node"] == "" &&
                state["agent"] == "") {
          var test_recs = filterRecords(report.records, "test");
          if (test_recs.length > 0) {
            showTestSummary(contentArea, test_recs[0]);
          }
        }
        if (state["test"] != "") {
          showTestSpecification(contentArea, report.tests[state["test"]]);
        }
        if (state["agent"] == "") {
          showAgentsTable(contentArea, filteredRecords);
        }
        if (state["scenario"] != "") {
          showScenarioSource(contentArea, report.scenarios[state["scenario"]]);
        }
      }

      function parseUrlToState() {
        var hashUrl = window.location.hash.substr(1);

        $.each(hashUrl.split(":"), function (_i, pair) {
          var kv = pair.split("=");
          if (kv.length == 2) {
            state[kv[0]] = decodeURIComponent(kv[1]);
          }
        });
      }

      // entry-point
      parseUrlToState();
      console.log(state);

      // pre-process records
      $.each(report.records, function(_i, record) {
        if (record.status) {
          record["is_status_ok"] = record.status == "ok";
          record["is_status_lost"] = record.status == "lost";
          record["is_status_interrupted"] = record.status == "interrupted";
          record["is_status_error"] = record.status == "error";
        }
      });

      // auto-select filters with 1 option
      $.each(fields, function(_i, field) {
        var values = getFieldValues(field, report.records);
        if (values.length == 1) {
          state[field] = values[0];
        }
      });

      update();

      $(window).on('hashchange', function() {
        parseUrlToState();
        update()
      });

      $('[data-toggle="tooltip"]').tooltip();
    });
  </script>

  <style type="text/css">
  </style>

</head>

<body>

<div class="container" id="container">
  <div class="row text-center">
    <h1>Shaker | The Report</h1>
  </div>
  <hr>
  <div class="row">
    <div class="col-md-2">
      <label for="scenario_selector" title="Scenario name">Scenario</label>
      <select id="scenario_selector" class="form-control" data-placeholder="- Any scenario -"></select>
    </div>
    <div class="col-md-2">
      <label for="test_selector" title="Test name">Test Case</label>
      <select id="test_selector" class="form-control" data-placeholder="- Any test case -"></select>
    </div>
    <div class="col-md-2">
      <label for="concurrency_selector" title="Concurrency">Concurrency</label>
      <select id="concurrency_selector" class="form-control" data-placeholder="- Any concurrency -"></select>
    </div>
    <div class="col-md-2">
      <label for="node_selector" title="Host / Compute node">Host</label>
      <select id="node_selector" class="form-control" data-placeholder="- Any node -"></select>
    </div>
    <div class="col-md-2">
      <label for="agent_selector" title="Agent">Agent</label>
      <select id="agent_selector" class="form-control" data-placeholder="- Any agent -"></select>
    </div>
  </div>

  <div id="content_area" class="row">
    <!-- Container for the screen content -->
  </div>

  <div id="footer" class="row">&nbsp;</div>
</div>

<!-- TEMPLATES --------------------------------------------------------------->

<!-- Scenario File -->
<script id="scenario_source_template" type="text/x-handlebars-template">
  <h3>Scenario</h3>
  <pre>{{ data }}</pre>
</script>

<!-- Test Specification -->
<script id="test_specification_template" type="text/x-handlebars-template">
  <h3>Test Specification</h3>
  <pre>{{ data }}</pre>
</script>

<!-- Executor Result -->
<script id="executor_template" type="text/x-handlebars-template">
  <h3>Execution Summary</h3>
  {{#with record}}
  <div id="{{ chart_id }}"></div>
  {{#if is_status_ok}}<span class="label label-success"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span>success</span>{{/if}}
  {{#if is_status_lost}}<span class="label label-danger"><span class="glyphicon glyphicon-alert" aria-hidden="true"></span>lost</span>{{/if}}
  {{#if is_status_interrupted}}<span class="label label-warning"><span class="glyphicon glyphicon-stop" aria-hidden="true"></span>interrupted</span>{{/if}}
  {{#if is_status_error}}<span class="label label-danger"><span class="glyphicon glyphicon-alert" aria-hidden="true"></span>error</span>{{/if}}
  {{#if stats_yaml}}
    <h4>Stats</h4>
    <pre>{{ stats_yaml }}</pre>
  {{/if}}
  {{#if time_info}}
    <h4>Time Info</h4>
    <pre>{{ time_info }}</pre>
  {{/if}}
  <h4>Command</h4>
  <pre>{{ command_yaml }}</pre>
  {{#if stdout}}
    <h4>Stdout</h4>
    <pre>{{ stdout }}</pre>
  {{/if}}
  {{#if verbose}}
    <h4>Verbose Info</h4>
    <pre>{{ verbose }}</pre>
  {{/if}}
  {{#if stderr}}
    <h4>Stderr</h4>
    <pre>{{ stderr }}</pre>
  {{/if}}
  {{/with}}
</script>

<!-- Concurrency summary -->
<script id="concurrency_summary_template" type="text/x-handlebars-template">
  {{#with record}}
  <div id="{{ chart_id  }}"></div>
  <h3>Per-node chart</h3>
  <div id="{{ node_chart_id  }}"></div>
  <h3>Stats</h3>
  <pre>{{ stats_yaml }}</pre>
  {{/with}}
</script>

<!-- Test summary -->
<script id="test_summary_template" type="text/x-handlebars-template">
  {{#with record}}
  <div id="{{ chart_id   }}"></div>
  {{#if stats_yaml}}
    <h3>Stats</h3>
    <pre>{{ stats_yaml }}</pre>
  {{/if}}
  {{/with}}
</script>

<!-- Records Table -->
<script id="records_table_template" type="text/x-handlebars-template">
  <h3>Records</h3>
  <table class="table table-striped" id="{{ table_id  }}">
    <thead>
    <tr>
      <th>Scenario</th>
      <th>Test Case</th>
      <th>Concurrency</th>
      <th>Host / Compute Node</th>
      <th>Agent</th>
      <th>Status</th>
    </tr>
    </thead>
    <tbody>
    {{#records}}
    <tr>
      <td><a href="{{ scenario_url }}">{{ scenario }}</a></td>
      <td><a href="{{ test_url }}">{{ test }}</a></td>
      <td><a href="{{ concurrency_url }}">{{ concurrency }}</a></td>
      <td><a href="{{ node_url }}">{{ node }}</a></td>
      <td><a href="{{ agent_url }}">{{ agent }}</a></td>
      <td>
        {{#if is_status_ok }}
          <span class="label label-success">
            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
            success
          </span>
        {{/if}}
        {{#if is_status_lost }}
          <span class="label label-danger">
            <span class="glyphicon glyphicon-alert" aria-hidden="true"></span>
            lost
          </span>
        {{/if}}
        {{#if is_status_interrupted }}
          <span class="label label-warning">
            <span class="glyphicon glyphicon-stop" aria-hidden="true"></span>
            interrupted
          </span>
        {{/if}}
        {{#if is_status_error }}
          <span class="label label-danger">
            <span class="glyphicon glyphicon-stop" aria-hidden="true"></span>
            error
          </span>
        {{/if}}
      </td>
    </tr>
    {{/records}}
    </tbody>
  </table>
</script>

<!-- Agents List -->
<script id="agents_table_template" type="text/x-handlebars-template">
  <h3>Agents</h3>
  <table class="table table-striped" id="{{ table_id }}">
    <thead>
    <tr>
      <th>Agent</th>
      <th>Mode</th>
      <th>IP</th>
      <th>Node</th>
      <th>AZ</th>
    </tr>
    </thead>
    <tbody>
    {{#agents}}
    <tr>
      <td>{{ id }}</td>
      <td>{{ mode }}</td>
      <td>{{ ip }}</td>
      <td>{{ node }}</td>
      <td>{{ zone }}</td>
    </tr>
    {{/agents}}
    </tbody>
  </table>
</script>

<!-- SLA List -->
<script id="sla_table_template" type="text/x-handlebars-template">
  <h3>Agents</h3>
  <table class="table table-striped" id="{{  table_id }}">
    <thead>
    <tr>
      <th>Condition</th>
      <th>Location</th>
      <th>Status</th>
    </tr>
    </thead>
    <tbody>
    {{#records}}
    <tr>
      <td>{{ sla }}</td>
      <td>{{ location }}</td>
      <td>
        {{#if is_status_ok }}
          <span class="text-success">
            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
            {{ status }}
          </span>
        {{else}}
          <span class="text-danger">
            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
            {{ status }}
          </span>
        {{/if}}
      </td>
    </tr>
    {{/records}}
    </tbody>
  </table>
</script>

<!-- Errors -->
<script id="errors_template" type="text/x-handlebars-template">
  <h3>Errors</h3>
  <div class="text-danger">
    <ul>
    {{#records}}
      <li>{{ info }}<br/>{{ stderr }}{{ traceback }}</li>
    {{/records}}
    </ul>
  </div>
</script>

</body>
</html>