<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head profile="http://gmpg.org/xfn/11">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>

  <title>Shaker | The distributed data-plane testing tool for OpenStack</title>

  <!-- LIBS -->

  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.4/js/bootstrap.js"></script>
  <script type="text/javascript"
          src="https://cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/3.0.1/handlebars.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/3.2.7/js-yaml.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.js"></script>

  <!-- STYLES -->

  <link rel="stylesheet"
        href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.4/simplex/bootstrap.min.css">
  <link rel=stylesheet type=text/css
        href="https://cdn.datatables.net/1.10.2/css/jquery.dataTables.min.css">
  <link rel=stylesheet type=text/css
        href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.css">
  <link rel='stylesheet' type='text/css'
        href='http://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic&subset=latin,cyrillic'>

  <script type="application/javascript">
    var report = {"scenarios": {"OpenStack L3 East-West": {"file_name": "shaker/shaker/scenarios/openstack/full_l3_east_west.yaml", "title": "OpenStack L3 East-West", "execution": {"tests": [{"title": "Download", "method": "tcp_download", "class": "flent"}, {"title": "Upload", "method": "tcp_upload", "class": "flent"}, {"title": "Bi-directional", "method": "tcp_bidirectional", "class": "flent"}], "progression": "quadratic"}, "description": "In this scenario Shaker launches pairs of instances, each instance on its own compute node. All available compute nodes are utilized. Instances are connected to one of 2 tenant networks, which plugged into single router. The traffic goes from one network to the other (L3 east-west).", "deployment": {"accommodation": ["pair", "single_room"], "template": "l3_east_west.hot"}}}, "records": {"87091fb9-edd4-4e17-b0d0-0c5120087084": {"meta": [["concurrency", ""], ["ping_icmp", "ms"], ["tcp_download", "Mbits/s"]], "scenario": "OpenStack L3 East-West", "test": "Download", "type": "test", "chart": [["concurrency", 1], ["ping_icmp", 0.5499334186210856], ["tcp_download", 2783.420943588114]], "id": "87091fb9-edd4-4e17-b0d0-0c5120087084"}, "43e04c47-37f8-49d0-a124-367bfa01951a": {"stats": {"ping_icmp": {"max": 6.922503157749946, "avg": 2.36398271986479, "unit": "ms", "min": 0.43056946375748995}, "tcp_download": {"max": 1093.4639080585705, "avg": 1002.6320962649485, "unit": "Mbits/s", "min": 904.2000007050138}, "tcp_upload": {"max": 1213.5954858497505, "avg": 1053.9365566620856, "unit": "Mbits/s", "min": 855.94}}, "scenario": "OpenStack L3 East-West", "concurrency": 1, "test": "Bi-directional", "type": "concurrency", "id": "43e04c47-37f8-49d0-a124-367bfa01951a", "node_chart": [["x", "node-2.domain.tld"], ["Avg ping_icmp, ms", 2.36398271986479], ["Max ping_icmp, ms", 6.922503157749946], ["Min ping_icmp, ms", 0.43056946375748995], ["Avg tcp_download, Mbits/s", 1002.6320962649485], ["Max tcp_download, Mbits/s", 1093.4639080585705], ["Min tcp_download, Mbits/s", 904.2000007050138], ["Avg tcp_upload, Mbits/s", 1053.9365566620856], ["Max tcp_upload, Mbits/s", 1213.5954858497505], ["Min tcp_upload, Mbits/s", 855.94]]}, "927e1a34-ebcb-4833-9d34-0949f5ae925d": {"status": "ok", "node": "node-2.domain.tld", "finish": 1471443206.082957, "stats": {"ping_icmp": {"max": 1.8785504573276777, "avg": 0.5499334186210856, "unit": "ms", "min": 0.302175062143379}, "tcp_download": {"max": 2926.994801516533, "avg": 2783.420943588114, "unit": "Mbits/s", "min": 1612.7342268463087}}, "stderr": "", "scenario": "OpenStack L3 East-West", "concurrency": 1, "schedule": 1471443135.625835, "agent": "shaker_edarti_master_0", "start": 1471443135.648557, "meta": [["time", "s"], ["ping_icmp", "ms"], ["tcp_download", "Mbits/s"]], "command": {"data": "zcat `flent -H 10.2.0.5 -l 60 -s 1 tcp_download 2>&1 | grep \"se with\" | grep -Po '\\./\\S+'`", "type": "script"}, "samples": [[0.0, 0.857, null], [1.0, 0.46914162289940403, null], [2.0, 0.5700229957585548, null], [3.0, 0.5796095295231042, null], [4.0, 0.42535721210887373, null], [5.0, 0.5609350261296502, null], [6.0, 0.5354661712692516, 2735.64], [7.0, 0.7177118886787935, 2857.263950443268], [8.0, 0.47658364808853737, 2925.83182747735], [9.0, 0.30622898112890873, 2875.305705058575], [10.0, 0.38912673703110146, 2815.741179959774], [11.0, 0.43602780073528674, 2786.894528455734], [12.0, 0.4477983275996116, 2782.9505283617973], [13.0, 0.7461870838479772, 2867.2034729409215], [14.0, 0.4039104268032976, 2815.3712614308333], [15.0, 1.8785504573276777, 1612.7342268463087], [16.0, 0.6828842640159838, 2360.3044872903824], [17.0, 0.4350885005125351, 2869.3673330700644], [18.0, 0.3360195118132861, 2880.9471240711214], [19.0, 0.3708952945034519, 1952.5142949199676], [20.0, 0.302175062143379, 2871.733260793686], [21.0, 0.37012125940522, 2782.643520120767], [22.0, 0.41427407882868905, 2910.2210928344725], [23.0, 0.5811993336804642, 2904.225258417129], [24.0, 0.6617167228537155, 2823.342124738693], [25.0, 0.545794320724591, 2822.3950758361816], [26.0, 0.4647154988159746, 2919.5529801228918], [27.0, 0.7331123223034817, 2876.697037868932], [28.0, 0.3457825676571118, 2579.3182276439666], [29.0, 0.6328724906418792, 2872.700017825422], [30.0, 0.5807514458888496, 2836.3299965381625], [31.0, 0.4830575968269794, 2901.9447068262098], [32.0, 0.5046406128320473, 2724.6158811998366], [33.0, 0.3674695434890556, 2884.739266881943], [34.0, 0.5410998696136975, 2910.3887330961225], [35.0, 0.580085811116078, 2920.147985816002], [36.0, 0.6133580798866033, 2830.3435316526216], [37.0, 0.3587744360310833, 2895.761774084568], [38.0, 0.642975221552886, 2848.608004078865], [39.0, 0.6328128800096902, 2926.994801516533], [40.0, 0.5574877859014405, 2883.035338144736], [41.0, 0.7489415948360547, 2902.7583390784266], [42.0, 0.7237792346958749, 2910.967821969986], [43.0, 0.5393661407627248, 2899.0721682476997], [44.0, 0.6893724101549494, 2924.1398104393525], [45.0, 0.4233372481913499, 2911.6232457923893], [46.0, 0.5518809915003633, 2887.13886081934], [47.0, 0.8977574041621995, 2763.979022605076], [48.0, 0.784553989532006, 2695.0107978534697], [49.0, 0.4193153186443377, 2899.8298802661893], [50.0, 0.5388774102748909, 2817.453310127258], [51.0, 0.49115865166374845, 2782.9719788074494], [52.0, 0.5523877246005228, 2787.4907431888582], [53.0, 0.3131098144482611, 2773.950271129608], [54.0, 0.7064243525116459, 2846.2219220349753], [55.0, 0.46249604812851947, 2891.6898851490023], [56.0, 0.6498164942687806, 2896.3583176898956], [57.0, 0.5747047965282817, 2835.1617515009693], [58.0, 0.37982926324473704, 2579.5941161060337], [59.0, 0.31704758052845905, 2241.7694801282883], [60.0, 0.3344839887096071, 2814.8152753925324], [61.0, 0.5107069277530818, 2815.681446179086], [62.0, 0.39621715905788096, 2778.196457688807], [63.0, 0.5851395824612247, 2575.5489188538377], [64.0, 0.6534416892206074, 2795.7442578744885], [65.0, 0.4284043311902096, 2914.28], [66.0, 0.5819703859044801, null], [67.0, 0.5699656143993488, null], [68.0, 0.5560504559848776, null], [69.0, 0.575980280138758, null]], "executor": "flent", "test": "Download", "type": "agent", "id": "927e1a34-ebcb-4833-9d34-0949f5ae925d"}, "b18168a2-4dc9-4de9-8cca-20189cc92296": {"stats": {"ping_icmp": {"max": 1.8785504573276777, "avg": 0.5499334186210856, "unit": "ms", "min": 0.302175062143379}, "tcp_download": {"max": 2926.994801516533, "avg": 2783.420943588114, "unit": "Mbits/s", "min": 1612.7342268463087}}, "scenario": "OpenStack L3 East-West", "concurrency": 1, "test": "Download", "type": "concurrency", "id": "b18168a2-4dc9-4de9-8cca-20189cc92296", "node_chart": [["x", "node-2.domain.tld"], ["Avg ping_icmp, ms", 0.5499334186210856], ["Max ping_icmp, ms", 1.8785504573276777], ["Min ping_icmp, ms", 0.302175062143379], ["Avg tcp_download, Mbits/s", 2783.420943588114], ["Max tcp_download, Mbits/s", 2926.994801516533], ["Min tcp_download, Mbits/s", 1612.7342268463087]]}, "78d278c3-cc77-421c-a92b-33b0d35e9125": {"meta": [["concurrency", ""], ["ping_icmp", "ms"], ["tcp_upload", "Mbits/s"]], "scenario": "OpenStack L3 East-West", "test": "Upload", "type": "test", "chart": [["concurrency", 1], ["ping_icmp", 0.7597149749972906], ["tcp_upload", 2569.8181020072398]], "id": "78d278c3-cc77-421c-a92b-33b0d35e9125"}, "3fc72b00-ccc2-4839-8293-cffbfae4203c": {"stats": {"ping_icmp": {"max": 3.1763963321134305, "avg": 0.7597149749972906, "unit": "ms", "min": 0.21967351149339095}, "tcp_upload": {"max": 2895.8165109872816, "avg": 2569.8181020072398, "unit": "Mbits/s", "min": 1551.47}}, "scenario": "OpenStack L3 East-West", "concurrency": 1, "test": "Upload", "type": "concurrency", "id": "3fc72b00-ccc2-4839-8293-cffbfae4203c", "node_chart": [["x", "node-2.domain.tld"], ["Avg ping_icmp, ms", 0.7597149749972906], ["Max ping_icmp, ms", 3.1763963321134305], ["Min ping_icmp, ms", 0.21967351149339095], ["Avg tcp_upload, Mbits/s", 2569.8181020072398], ["Max tcp_upload, Mbits/s", 2895.8165109872816], ["Min tcp_upload, Mbits/s", 1551.47]]}, "22bc7fa8-f7a3-46dc-89be-d5ec3c80dcfd": {"status": "ok", "node": "node-2.domain.tld", "finish": 1471443386.678133, "stats": {"ping_icmp": {"max": 6.922503157749946, "avg": 2.36398271986479, "unit": "ms", "min": 0.43056946375748995}, "tcp_download": {"max": 1093.4639080585705, "avg": 1002.6320962649485, "unit": "Mbits/s", "min": 904.2000007050138}, "tcp_upload": {"max": 1213.5954858497505, "avg": 1053.9365566620856, "unit": "Mbits/s", "min": 855.94}}, "stderr": "", "scenario": "OpenStack L3 East-West", "concurrency": 1, "schedule": 1471443316.271293, "agent": "shaker_edarti_master_0", "start": 1471443316.280513, "meta": [["time", "s"], ["ping_icmp", "ms"], ["tcp_download", "Mbits/s"], ["tcp_upload", "Mbits/s"]], "command": {"data": "zcat `flent -H 10.2.0.5 -l 60 -s 1 tcp_bidirectional 2>&1 | grep \"se with\" | grep -Po '\\./\\S+'`", "type": "script"}, "samples": [[0.0, 0.904, null, null], [1.0, 0.5559680696443607, null, null], [2.0, 0.5331794828004446, null, null], [3.0, 0.6076177604437536, null, null], [4.0, 0.4729225193109246, null, null], [5.0, 0.4502317838277065, null, null], [6.0, 1.530980778125367, 1021.19, 855.94], [7.0, 2.946562889047235, 1037.5646668927793, 967.6382111559393], [8.0, 2.650944314150036, 1032.6315306472777, 1019.148102799053], [9.0, 2.998096873631496, 999.8043782742357, 1149.1610102096465], [10.0, 3.049653462706621, 1032.0738364886681, 1065.8296403026582], [11.0, 1.9979171602286172, 1024.3980893826483, 1062.2196557624536], [12.0, 2.9018382790242994, 985.2638723538752, 1004.3581744957733], [13.0, 6.922503157749946, 976.6943158114365, 1064.9312555092652], [14.0, 2.9258108501414704, 1005.6481266483482, 1075.0342067528215], [15.0, 3.561084742188842, 1039.5423762879009, 983.0811544696372], [16.0, 2.031029922894467, 1017.6613877388086, 1020.7128991318815], [17.0, 2.778038571481605, 1007.0772472072662, 1070.2756702918034], [18.0, 1.8061748131920803, 925.275694680214, 1087.3592789890865], [19.0, 3.524992012432337, 1051.5090245890617, 962.0247117966294], [20.0, 1.7175135461154374, 960.0464600587019, 1110.2851352912498], [21.0, 2.8728218633429274, 1038.315329139135, 1011.9073519204803], [22.0, 3.1048499822895677, 913.8503204717497, 1132.6687759432064], [23.0, 2.4374431589681036, 996.5916869211197, 1030.4188682524084], [24.0, 4.17809607804051, 1019.3796600142098, 1041.9918772009235], [25.0, 2.3836181998399297, 1079.1516501663214, 1040.9121694925489], [26.0, 1.1154845787832797, 1012.1282129680661, 1033.9613508539687], [27.0, 1.545528704184968, 982.0054738163948, 1036.2758711099625], [28.0, 2.3822454317842605, 1041.101932322979, 971.3879521942139], [29.0, 4.0876758560521065, 988.4832791099867, 1053.608162973753], [30.0, 2.9644455030664947, 984.4916239378939, 1080.5475186709734], [31.0, 2.1490570582138524, 1016.6482523940705, 1011.9527006881672], [32.0, 1.6578667428898097, 1006.5614261624038, 1071.3005682158803], [33.0, 3.462606292188749, 966.5763424348831, 1141.3080989446416], [34.0, 2.610259873996732, 941.7639343608275, 1213.5954858497505], [35.0, 2.1296455349563215, 985.9228673672676, 1131.2725279307365], [36.0, 2.912477414454749, 1016.9046240782737, 1074.4023520896417], [37.0, 1.154402135926959, 991.5196942573273, 1075.408709324144], [38.0, 2.6130276315448464, 1073.1180640743428, 1015.5443075899038], [39.0, 1.3764238158885862, 983.0812089819551, 1098.6386379619894], [40.0, 2.7144592798701797, 1045.976484861374, 972.7387267595288], [41.0, 2.6195452910034778, 1071.7962885441414, 1006.3192072938011], [42.0, 3.3749886888131138, 1034.033119430542, 1112.5303966004656], [43.0, 1.8432676640345869, 989.171709060669, 1041.590631423428], [44.0, 1.6840506645927165, 976.9566608090176, 1122.1920361590385], [45.0, 2.2538479820551998, 1012.9340463851596, 1039.3286341213848], [46.0, 4.202172824107566, 965.4429885816573, 1120.7589883763192], [47.0, 1.2410930852054873, 1062.9801726436615, 1010.4182994320055], [48.0, 2.33307412610705, 959.0993399596215, 1155.0633407912499], [49.0, 5.950965301522919, 1012.3100250934401, 1060.7481160503792], [50.0, 1.9682698227303463, 904.2000007050138, 1064.0370704519762], [51.0, 1.4460561358469977, 1005.1515391349792, 983.0475195147363], [52.0, 3.576444090806449, 947.5126278731108, 1005.6639133919663], [53.0, 2.9411910917252104, 1013.8976429666038, 1015.8055958622135], [54.0, 3.9550657109545853, 1093.4639080585705, 913.818776097182], [55.0, 2.6589676486194826, 971.1440717609012, 1055.5436413060954], [56.0, 0.9271817556356563, 981.9132944774628, 1040.653753314173], [57.0, 2.2332926767995764, 957.4908303675762, 1080.8087558344355], [58.0, 3.6496374718793336, 1059.3829965877533, 1009.9497945421153], [59.0, 3.594245246066622, 906.3091263753935, 1125.666556447145], [60.0, 2.282161817425238, 976.5055014221753, 1040.0955330155052], [61.0, 1.7559098780425306, 1016.2338010640948, 1090.125961511135], [62.0, 2.536744349557076, 980.7716428922914, 1082.816700275049], [63.0, 2.380978153225, 1044.2309292650223, 1090.094452910433], [64.0, 4.477039524157663, 958.9204375362397, 1065.0889008902147], [65.0, 0.8293157784165088, 1056.12, 1109.8722598500497], [66.0, 0.43056946375748995, null, 1110.25], [67.0, 0.6026563444259996, null, null], [68.0, 0.48540784443147755, null, null], [69.0, 0.5251538331699063, null, null]], "executor": "flent", "test": "Bi-directional", "type": "agent", "id": "22bc7fa8-f7a3-46dc-89be-d5ec3c80dcfd"}, "6280590f-17e6-4132-86eb-1476f42a2e4b": {"status": "ok", "node": "node-2.domain.tld", "finish": 1471443296.367443, "stats": {"ping_icmp": {"max": 3.1763963321134305, "avg": 0.7597149749972906, "unit": "ms", "min": 0.21967351149339095}, "tcp_upload": {"max": 2895.8165109872816, "avg": 2569.8181020072398, "unit": "Mbits/s", "min": 1551.47}}, "stderr": "", "scenario": "OpenStack L3 East-West", "concurrency": 1, "schedule": 1471443225.941583, "agent": "shaker_edarti_master_0", "start": 1471443225.951507, "meta": [["time", "s"], ["ping_icmp", "ms"], ["tcp_upload", "Mbits/s"]], "command": {"data": "zcat `flent -H 10.2.0.5 -l 60 -s 1 tcp_upload 2>&1 | grep \"se with\" | grep -Po '\\./\\S+'`", "type": "script"}, "samples": [[0.0, 0.886, null], [1.0, 0.38819125202488386, null], [2.0, 0.5136788149503372, null], [3.0, 0.2893147424556425, null], [4.0, 0.4801235096945842, null], [5.0, 0.5646534888656775, null], [6.0, 0.3186011664280589, 2563.85], [7.0, 3.1763963321134305, 2706.0167042233365], [8.0, 0.6729914658760369, 2707.151037006699], [9.0, 0.42345289746762116, 2694.0299476193004], [10.0, 0.7758440024112633, 2734.5210466527938], [11.0, 0.6399672974469192, 2719.344119288205], [12.0, 0.36172857520801405, 2796.9596543263806], [13.0, 0.8828833448858235, 2776.338178234765], [14.0, 0.7746129334223077, 2779.6340908025554], [15.0, 0.4482003697334644, 2816.944780168335], [16.0, 1.9198985956222336, 2875.385434457831], [17.0, 0.700012714321509, 2465.7257074507415], [18.0, 0.7894328411977685, 2687.1409942388536], [19.0, 0.2433633074077994, 2847.712550912606], [20.0, 0.4600752738972873, 2752.244667742802], [21.0, 2.496487273974286, 2716.897511053032], [22.0, 0.8536682167123089, 2591.686152113931], [23.0, 0.3690704333437596, 2703.527711143494], [24.0, 0.21967351149339095, 2606.9554129603744], [25.0, 0.8887566563460119, 2497.0399452113074], [26.0, 0.6619988222063857, 2701.0060590334924], [27.0, 0.6152303304653028, 2765.68934434428], [28.0, 0.8359457525086961, 2749.5729937658657], [29.0, 0.7882187130527312, 2765.012369298935], [30.0, 0.9738024194968871, 2548.205534776665], [31.0, 0.7701374663072776, 2706.4865258160553], [32.0, 0.7700125184587975, 2558.325025327226], [33.0, 0.8068730080797542, 2554.017816433415], [34.0, 0.6917486866683693, 2717.089134158189], [35.0, 0.49139778160095987, 2753.6555175065996], [36.0, 0.7599566538901346, 2739.8757896424986], [37.0, 0.7236970725162605, 2718.510794296265], [38.0, 0.48096265483449097, 2523.5071212848025], [39.0, 1.129715215257661, 2507.2373088541085], [40.0, 0.7760066621245617, 2684.669001235355], [41.0, 0.6151704456411197, 2788.264702686532], [42.0, 0.6399977507233483, 2800.8069612209692], [43.0, 0.3956172970620011, 2838.5999784113274], [44.0, 0.9239291348325992, 2796.2362255748585], [45.0, 0.8556939989206126, 2839.607927030589], [46.0, 0.5640022763349433, 2797.859786947618], [47.0, 0.9307308960845079, 2811.3871457113064], [48.0, 0.480005863197779, 2831.824762152449], [49.0, 0.5700298030358499, 2806.5100184405574], [50.0, 0.601095866769576, 2200.5240574150907], [51.0, 0.6749567152552627, 2592.324856693989], [52.0, 0.3645157714479679, 2803.956005625725], [53.0, 0.723315517771899, 2730.408603891201], [54.0, 1.7898589271459475, 2803.2360910345824], [55.0, 0.8036882004063527, 2871.918732638359], [56.0, 0.9457105527827236, 2895.8165109872816], [57.0, 2.353738530941597, 2793.579552894084], [58.0, 0.6630698548061178, 1822.4405282335013], [59.0, 0.3259336415737306, 2312.68875510982], [60.0, 0.7059456453345382, 2135.0921210103897], [61.0, 0.48387458262118066, 1677.633409628872], [62.0, 1.0679395064095867, 1566.5586445928043], [63.0, 0.892792762759079, 1554.8479358761158], [64.0, 0.5550565979898299, 1551.8738766717147], [65.0, 0.7644075571019486, 1551.4710505808102], [66.0, 0.4731312490741274, 1551.47], [67.0, 0.39421746232613025, null], [68.0, 0.35409727107227856, null], [69.0, 0.45474179561899025, null]], "executor": "flent", "test": "Upload", "type": "agent", "id": "6280590f-17e6-4132-86eb-1476f42a2e4b"}, "c3bee2e1-78e1-4836-b4c9-484866951537": {"meta": [["concurrency", ""], ["ping_icmp", "ms"], ["tcp_download", "Mbits/s"], ["tcp_upload", "Mbits/s"]], "scenario": "OpenStack L3 East-West", "test": "Bi-directional", "type": "test", "chart": [["concurrency", 1], ["ping_icmp", 2.36398271986479], ["tcp_download", 1002.6320962649485], ["tcp_upload", 1053.9365566620856]], "id": "c3bee2e1-78e1-4836-b4c9-484866951537"}}, "tests": {"Download": {"class": "flent", "method": "tcp_download", "title": "Download"}, "Bi-directional": {"class": "flent", "method": "tcp_bidirectional", "title": "Bi-directional"}, "Upload": {"class": "flent", "method": "tcp_upload", "title": "Upload"}}, "agents": {"shaker_edarti_slave_0": {"node": "node-5.domain.tld", "zone": "nova", "availability_zone": "nova:node-5.domain.tld", "ip": "10.2.0.5", "master": {"node": "node-2.domain.tld", "zone": "nova", "availability_zone": "nova:node-2.domain.tld", "ip": "10.1.0.4", "mode": "master", "slave_id": "shaker_edarti_slave_0", "id": "shaker_edarti_master_0"}, "mode": "slave", "master_id": "shaker_edarti_master_0", "id": "shaker_edarti_slave_0"}, "shaker_edarti_master_0": {"node": "node-2.domain.tld", "slave": {"node": "node-5.domain.tld", "zone": "nova", "availability_zone": "nova:node-5.domain.tld", "ip": "10.2.0.5", "mode": "slave", "master_id": "shaker_edarti_master_0", "id": "shaker_edarti_slave_0"}, "zone": "nova", "availability_zone": "nova:node-2.domain.tld", "ip": "10.1.0.4", "mode": "master", "slave_id": "shaker_edarti_slave_0", "id": "shaker_edarti_master_0"}}, "sla": []};
  </script>

  <script type="text/javascript">
    "use strict";

    $(function () {

      var fields = ["scenario", "test", "concurrency", "node", "agent"];
      var state = {
        scenario: "",
        test: "",
        concurrency: "",
        node: "",
        agent: ""
      };
      var tablePageSize = 10;

      // compiled templates
      var scenario_source_template = Handlebars.compile($("#scenario_source_template").html());
      var test_specification_template = Handlebars.compile($("#test_specification_template").html());
      var agents_table_template = Handlebars.compile($("#agents_table_template").html());
      var records_table_template = Handlebars.compile($("#records_table_template").html());
      var executor_template = Handlebars.compile($("#executor_template").html());
      var concurrency_summary_template = Handlebars.compile($("#concurrency_summary_template").html());
      var test_summary_template = Handlebars.compile($("#test_summary_template").html());
      var sla_table_template = Handlebars.compile($("#sla_table_template").html());
      var errors_template = Handlebars.compile($("#errors_template").html());

      function concatenate(strings) {
        // returns strings concatenated via comma (like join() but omits empty strings)
        var f = false;
        var result = "";
        $.each(strings, function (_i, string) {
          if (string.length > 0) {
            if (f) result += ", ";
            result += string;
            f = true;
          }
        });
        return result;
      }

      function initSingleSelector(name, values) {
        var selectorId = "#" + name + "_selector";

        var selector_inst = $(selectorId);
        selector_inst.empty();
        selector_inst.append($("<option>", {
          style: "font-style: italic; text-decoration: underline;",
          value: "",
          text: selector_inst.data('placeholder')
        }));

        $.each(values, function (key, item) {
          selector_inst.append($('<option>', {
            value: item, //(key + 1),
            text: item
          }));
        });

        selector_inst.val(state[name]);

        selector_inst.
            on("change", function (e) {
              state[name] = this.value;

              // convert state -> url
              var tokens = [];
              $.each(fields.sort(), function (i, field) {
                if (state[field] != "") {
                  tokens.push(field + "=" + state[field]);
                }
              });
              window.location.href = "#" + tokens.join(":");
            });
      }

      function getFieldValues(field, records) {
        var values_set = {};

        $.each(records, function (j, record) {
          if (record[field]) {
            values_set["" + record[field]] = true;
          }
        });

        return $.map(values_set, function (_i, value) {
          return value;
        }).sort();
      }

      function updateSelectors() {
        $.each(fields, function (i, field) {
          var values = getFieldValues(field, filterRecords(report.records, null, field));
          console.log(values);
          initSingleSelector(field, values);
        });
      }

      function filterRecords(records, type, except_field) {
        var res = [];
        $.each(records, function(_i, record){
          if (!type || typeof type === 'undefined' || record.type == type) {
            var flag = true;
            $.each(state, function (key, value) {
              if (key != except_field && value) {
                flag &= record[key] == value;
              }
            });
            if (flag) {
              res.push(record);
            }
          }
        });
        return res;
      }

      function getAgentsByIds(agent_ids) {
        var agents = [];
        $.each(agent_ids, function(agent_id){
          agents.push(report.agents[agent_id]);
        });
        return agents;
      }

      /* Template Rendering Funcs */

      function showScenarioSource(contentArea, scenario) {
        contentArea.append(scenario_source_template(
            {data: jsyaml.safeDump(scenario)}));
      }

      function showTestSpecification(contentArea, test) {
        contentArea.append(test_specification_template(
            {data: jsyaml.safeDump(test)}
        ))
      }

      function showAgentRecord(contentArea, record) {
        var chart_id = "chart_" + Math.round(Math.random() * 10000);
        var ext_options = {
          command_yaml: jsyaml.safeDump(record["command"]),
          chart_id: chart_id};
        if (record["stats"]) {
          ext_options["stats_yaml"] = jsyaml.safeDump(record["stats"]);
        }
        if ((record["start"]) && (record["finish"])) {
          ext_options["time_info"] = jsyaml.safeDump({
            "start": new Date(record["start"] * 1000).toISOString(),
            "finish": new Date(record["finish"] * 1000).toISOString()
          });
        }
        contentArea.append(executor_template(
            {record: $.extend({}, record, ext_options)}
        ));
        if (record["samples"]) {
          var meta = record["meta"];
          var axes = [];
          axes[meta[1][0]] = 'y';
          var axis = {
            x: {label: concatenate(meta[0])},
            y: {label: concatenate(meta[1]), min: 0}
          };
          if (meta.length > 2) {
            axes[meta[2][0]] = 'y2';
            axis['y2'] = {label: concatenate(meta[2]), min: 0, show: true}
          }

          var chart = [];
          $.each(meta, function(_i, meta_item){  // row titles
            chart.push([meta_item[0]]);
          });
          var samples = record["samples"];
          for (var i=0; i < samples.length; i++) {
            var point = samples[i];
            for (var j=0; j < point.length; j++) {
              chart[j].push(point[j]);
            }
          }

          c3.generate({
            bindto: "#" + chart_id,
            data: {
              x: 'time',
              columns: chart,
              axes: axes
            },
            axis: axis
          });
        }
      }

      function showConcurrencySummary(contentArea, record) {
        var chart_id = "chart_" + Math.round(Math.random() * 10000);
        var node_chart_id = "node_chart_" + Math.round(Math.random() * 10000);
        var ext_options = { chart_id: chart_id, node_chart_id: node_chart_id };
        if (record["stats"]) {
          ext_options["stats_yaml"] = jsyaml.safeDump(record["stats"]);
        }
        console.log(record);
        contentArea.append(concurrency_summary_template(
            {record: $.extend({}, record, ext_options)}
        ));
        if (record["node_chart"]) {
          c3.generate({
            bindto: "#" + node_chart_id,
            data: {
              x: 'x',
              columns: record["node_chart"],
              type: 'step',
              order: null
            },
            axis: {
              x: { type: 'category' }
            }
          });
        }
      }

      function showTestSummary(contentArea, record) {
        console.log(record);
        var chart_id = "chart_" + Math.round(Math.random() * 10000);
        var ext_options = { chart_id: chart_id };
        if (record["stats"]) {
          ext_options["stats_yaml"] = jsyaml.safeDump(record["stats"]);
        }
        contentArea.append(test_summary_template(
            {record: $.extend({}, record, ext_options)}
        ));
        if (record["chart"]) {
          var meta = record["meta"];
          var axes = [];
          axes[meta[1][0]] = 'y';
          var axis = {
            x: {label: concatenate(meta[0])},
            y: {label: concatenate(meta[1]), min: 0}
          };
          if (meta.length > 2) {
            axes[meta[2][0]] = 'y2';
            axis['y2'] = {label: concatenate(meta[2]), min: 0, show: true}
          }

          c3.generate({
            bindto: "#" + chart_id,
            data: {
              x: 'concurrency',
              columns: record["chart"],
              axes: axes
            },
            axis: axis
          });
        }
      }

      function showAgentsTable(contentArea, filteredRecords) {
        var agent_ids = {};
        $.each(filteredRecords, function(_i, record){
          if (record.agent) {
            agent_ids[record.agent] = true;
          }
        });

        var agents = getAgentsByIds(agent_ids);
        if (agents.length == 0) return;

        // add slave agents
        var slave_agent_ids = {};
        $.each(agents, function(_i, agent){
          if (agent.slave_id) {
            slave_agent_ids[agent.slave_id] = true;
          }
        });
        agents = $.merge(agents, getAgentsByIds(slave_agent_ids));

        contentArea.append(agents_table_template({
          agents: agents,
          table_id: "agents_table"
        }));
        $("#agents_table").dataTable({
          "autoWidth": true,
          "paging": false,
          "ordering": true,
          "info": false
        });
      }

      function makeURL(record, s) {
        var extra = {};
        extra[s] = record[s];
        return "#" + $.map($.extend({}, state, extra), function (val, index) {
          return val? (index + "=" + val) : null;
        }).join(":")
      }

      function showRecordsTable(contentArea, filteredRecords) {
        $.each(filteredRecords, function(_i, record) {
          $.each(fields, function(_j, field){
            if (record[field]) {
              record[field + "_url"] = makeURL(record, field);
            }
          });
        });

        contentArea.append(records_table_template({
          records: filteredRecords,
          table_id: "records_table"
        }));
        $("#records_table").dataTable({
          autoWidth: true,
          paging: filteredRecords.length > tablePageSize,
          ordering: true,
          info: false,
          searching: filteredRecords.length > tablePageSize
        });
      }

      function showSlaTable(contentArea, records) {
        if (records.length == 0) return;

        contentArea.append(sla_table_template({
          records: records,
          table_id: "sla_table"
        }));
        $("#records_table").dataTable({
          autoWidth: true,
          paging: records.length > tablePageSize,
          ordering: true,
          info: false,
          searching: records.length > tablePageSize
        });
      }

      function showErrors(contentArea, records) {
        if (records.length == 0) return;

        contentArea.append(errors_template({
          records: records,
          table_id: "errors_list"
        }));
      }

      /* Update cycle */

      function update() {
        var filteredRecords = filterRecords(report.records);
        console.log(filteredRecords);
        var slaRecords = [];
        var errorRecords = [];
        $.each(filterRecords(report.records), function(_i, record) {
          if (record["sla_info"]) {
            slaRecords.push(record);
          }
          if (record["is_status_error"]) {
            errorRecords.push(record);
          }
        });

        var contentArea = $("#content_area");
        contentArea.empty();

        updateSelectors();

        showRecordsTable(contentArea, filteredRecords);
        showSlaTable(contentArea, slaRecords);
        showErrors(contentArea, errorRecords);

        if (state["scenario"] != "" && state["test"] != "" &&
                state["concurrency"] != "" &&
                state["agent"] != "") {
          showAgentRecord(contentArea, filteredRecords[0]);
        }
        if (state["scenario"] != "" && state["test"] != "" &&
                state["concurrency"] != "" && state["node"] == "" &&
                state["agent"] == "") {
          var agg_recs = filterRecords(report.records, "concurrency");
          if (agg_recs.length > 0) {
            showConcurrencySummary(contentArea, agg_recs[0]);
          }
        }
        if (state["scenario"] != "" && state["test"] != "" &&
                state["concurrency"] == "" && state["node"] == "" &&
                state["agent"] == "") {
          var test_recs = filterRecords(report.records, "test");
          if (test_recs.length > 0) {
            showTestSummary(contentArea, test_recs[0]);
          }
        }
        if (state["test"] != "") {
          showTestSpecification(contentArea, report.tests[state["test"]]);
        }
        if (state["agent"] == "") {
          showAgentsTable(contentArea, filteredRecords);
        }
        if (state["scenario"] != "") {
          showScenarioSource(contentArea, report.scenarios[state["scenario"]]);
        }
      }

      function parseUrlToState() {
        var hashUrl = window.location.hash.substr(1);

        $.each(hashUrl.split(":"), function (_i, pair) {
          var kv = pair.split("=");
          if (kv.length == 2) {
            state[kv[0]] = decodeURIComponent(kv[1]);
          }
        });
      }

      // entry-point
      parseUrlToState();
      console.log(state);

      // pre-process records
      $.each(report.records, function(_i, record) {
        if (record.status) {
          record["is_status_ok"] = record.status == "ok";
          record["is_status_lost"] = record.status == "lost";
          record["is_status_interrupted"] = record.status == "interrupted";
          record["is_status_error"] = record.status == "error";
        }
      });

      // auto-select filters with 1 option
      $.each(fields, function(_i, field) {
        var values = getFieldValues(field, report.records);
        if (values.length == 1) {
          state[field] = values[0];
        }
      });

      update();

      $(window).on('hashchange', function() {
        parseUrlToState();
        update()
      });

      $('[data-toggle="tooltip"]').tooltip();
    });
  </script>

  <style type="text/css">
  </style>

</head>

<body>

<div class="container" id="container">
  <div class="row text-center">
    <h1>Shaker | The Report</h1>
  </div>
  <hr>
  <div class="row">
    <div class="col-md-2">
      <label for="scenario_selector" title="Scenario name">Scenario</label>
      <select id="scenario_selector" class="form-control" data-placeholder="- Any scenario -"></select>
    </div>
    <div class="col-md-2">
      <label for="test_selector" title="Test name">Test Case</label>
      <select id="test_selector" class="form-control" data-placeholder="- Any test case -"></select>
    </div>
    <div class="col-md-2">
      <label for="concurrency_selector" title="Concurrency">Concurrency</label>
      <select id="concurrency_selector" class="form-control" data-placeholder="- Any concurrency -"></select>
    </div>
    <div class="col-md-2">
      <label for="node_selector" title="Host / Compute node">Host</label>
      <select id="node_selector" class="form-control" data-placeholder="- Any node -"></select>
    </div>
    <div class="col-md-2">
      <label for="agent_selector" title="Agent">Agent</label>
      <select id="agent_selector" class="form-control" data-placeholder="- Any agent -"></select>
    </div>
  </div>

  <div id="content_area" class="row">
    <!-- Container for the screen content -->
  </div>

  <div id="footer" class="row">&nbsp;</div>
</div>

<!-- TEMPLATES --------------------------------------------------------------->

<!-- Scenario File -->
<script id="scenario_source_template" type="text/x-handlebars-template">
  <h3>Scenario</h3>
  <pre>{{ data }}</pre>
</script>

<!-- Test Specification -->
<script id="test_specification_template" type="text/x-handlebars-template">
  <h3>Test Specification</h3>
  <pre>{{ data }}</pre>
</script>

<!-- Executor Result -->
<script id="executor_template" type="text/x-handlebars-template">
  <h3>Execution Summary</h3>
  {{#with record}}
  <div id="{{ chart_id }}"></div>
  {{#if is_status_ok}}<span class="label label-success"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span>success</span>{{/if}}
  {{#if is_status_lost}}<span class="label label-danger"><span class="glyphicon glyphicon-alert" aria-hidden="true"></span>lost</span>{{/if}}
  {{#if is_status_interrupted}}<span class="label label-warning"><span class="glyphicon glyphicon-stop" aria-hidden="true"></span>interrupted</span>{{/if}}
  {{#if is_status_error}}<span class="label label-danger"><span class="glyphicon glyphicon-alert" aria-hidden="true"></span>error</span>{{/if}}
  {{#if stats_yaml}}
    <h4>Stats</h4>
    <pre>{{ stats_yaml }}</pre>
  {{/if}}
  {{#if time_info}}
    <h4>Time Info</h4>
    <pre>{{ time_info }}</pre>
  {{/if}}
  <h4>Command</h4>
  <pre>{{ command_yaml }}</pre>
  {{#if stdout}}
    <h4>Stdout</h4>
    <pre>{{ stdout }}</pre>
  {{/if}}
  {{#if verbose}}
    <h4>Verbose Info</h4>
    <pre>{{ verbose }}</pre>
  {{/if}}
  {{#if stderr}}
    <h4>Stderr</h4>
    <pre>{{ stderr }}</pre>
  {{/if}}
  {{/with}}
</script>

<!-- Concurrency summary -->
<script id="concurrency_summary_template" type="text/x-handlebars-template">
  {{#with record}}
  <div id="{{ chart_id  }}"></div>
  <h3>Per-node chart</h3>
  <div id="{{ node_chart_id  }}"></div>
  <h3>Stats</h3>
  <pre>{{ stats_yaml }}</pre>
  {{/with}}
</script>

<!-- Test summary -->
<script id="test_summary_template" type="text/x-handlebars-template">
  {{#with record}}
  <div id="{{ chart_id   }}"></div>
  {{#if stats_yaml}}
    <h3>Stats</h3>
    <pre>{{ stats_yaml }}</pre>
  {{/if}}
  {{/with}}
</script>

<!-- Records Table -->
<script id="records_table_template" type="text/x-handlebars-template">
  <h3>Records</h3>
  <table class="table table-striped" id="{{ table_id  }}">
    <thead>
    <tr>
      <th>Scenario</th>
      <th>Test Case</th>
      <th>Concurrency</th>
      <th>Host / Compute Node</th>
      <th>Agent</th>
      <th>Status</th>
    </tr>
    </thead>
    <tbody>
    {{#records}}
    <tr>
      <td><a href="{{ scenario_url }}">{{ scenario }}</a></td>
      <td><a href="{{ test_url }}">{{ test }}</a></td>
      <td><a href="{{ concurrency_url }}">{{ concurrency }}</a></td>
      <td><a href="{{ node_url }}">{{ node }}</a></td>
      <td><a href="{{ agent_url }}">{{ agent }}</a></td>
      <td>
        {{#if is_status_ok }}
          <span class="label label-success">
            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
            success
          </span>
        {{/if}}
        {{#if is_status_lost }}
          <span class="label label-danger">
            <span class="glyphicon glyphicon-alert" aria-hidden="true"></span>
            lost
          </span>
        {{/if}}
        {{#if is_status_interrupted }}
          <span class="label label-warning">
            <span class="glyphicon glyphicon-stop" aria-hidden="true"></span>
            interrupted
          </span>
        {{/if}}
        {{#if is_status_error }}
          <span class="label label-danger">
            <span class="glyphicon glyphicon-stop" aria-hidden="true"></span>
            error
          </span>
        {{/if}}
      </td>
    </tr>
    {{/records}}
    </tbody>
  </table>
</script>

<!-- Agents List -->
<script id="agents_table_template" type="text/x-handlebars-template">
  <h3>Agents</h3>
  <table class="table table-striped" id="{{ table_id }}">
    <thead>
    <tr>
      <th>Agent</th>
      <th>Mode</th>
      <th>IP</th>
      <th>Node</th>
      <th>AZ</th>
    </tr>
    </thead>
    <tbody>
    {{#agents}}
    <tr>
      <td>{{ id }}</td>
      <td>{{ mode }}</td>
      <td>{{ ip }}</td>
      <td>{{ node }}</td>
      <td>{{ zone }}</td>
    </tr>
    {{/agents}}
    </tbody>
  </table>
</script>

<!-- SLA List -->
<script id="sla_table_template" type="text/x-handlebars-template">
  <h3>Agents</h3>
  <table class="table table-striped" id="{{  table_id }}">
    <thead>
    <tr>
      <th>Condition</th>
      <th>Location</th>
      <th>Status</th>
    </tr>
    </thead>
    <tbody>
    {{#records}}
    <tr>
      <td>{{ sla }}</td>
      <td>{{ location }}</td>
      <td>
        {{#if is_status_ok }}
          <span class="text-success">
            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
            {{ status }}
          </span>
        {{else}}
          <span class="text-danger">
            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
            {{ status }}
          </span>
        {{/if}}
      </td>
    </tr>
    {{/records}}
    </tbody>
  </table>
</script>

<!-- Errors -->
<script id="errors_template" type="text/x-handlebars-template">
  <h3>Errors</h3>
  <div class="text-danger">
    <ul>
    {{#records}}
      <li>{{ info }}<br/>{{ stderr }}{{ traceback }}</li>
    {{/records}}
    </ul>
  </div>
</script>

</body>
</html>