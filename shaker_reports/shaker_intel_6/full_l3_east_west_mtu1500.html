<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head profile="http://gmpg.org/xfn/11">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>

  <title>Shaker | The distributed data-plane testing tool for OpenStack</title>

  <!-- LIBS -->

  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.4/js/bootstrap.js"></script>
  <script type="text/javascript"
          src="https://cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/3.0.1/handlebars.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/3.2.7/js-yaml.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.js"></script>

  <!-- STYLES -->

  <link rel="stylesheet"
        href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.4/simplex/bootstrap.min.css">
  <link rel=stylesheet type=text/css
        href="https://cdn.datatables.net/1.10.2/css/jquery.dataTables.min.css">
  <link rel=stylesheet type=text/css
        href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.css">
  <link rel='stylesheet' type='text/css'
        href='http://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic&subset=latin,cyrillic'>

  <script type="application/javascript">
    var report = {"scenarios": {"OpenStack L3 East-West": {"file_name": "shaker/shaker/scenarios/openstack/full_l3_east_west.yaml", "title": "OpenStack L3 East-West", "execution": {"tests": [{"title": "Download", "method": "tcp_download", "class": "flent"}, {"title": "Upload", "method": "tcp_upload", "class": "flent"}, {"title": "Bi-directional", "method": "tcp_bidirectional", "class": "flent"}], "progression": "quadratic"}, "description": "In this scenario Shaker launches pairs of instances, each instance on its own compute node. All available compute nodes are utilized. Instances are connected to one of 2 tenant networks, which plugged into single router. The traffic goes from one network to the other (L3 east-west).", "deployment": {"accommodation": ["pair", "single_room"], "template": "l3_east_west.hot"}}}, "records": {"8b607a71-a54c-4e86-8a04-c1176e0cad7a": {"stats": {"ping_icmp": {"max": 4.106660719101958, "avg": 2.2590886291481316, "unit": "ms", "min": 0.38010830187040995}, "tcp_download": {"max": 4419.792371356487, "avg": 3572.518661493673, "unit": "Mbits/s", "min": 1869.415626426403}, "tcp_upload": {"max": 4703.761560648594, "avg": 4226.455307923521, "unit": "Mbits/s", "min": 3714.2024773049793}}, "scenario": "OpenStack L3 East-West", "concurrency": 1, "test": "Bi-directional", "type": "concurrency", "id": "8b607a71-a54c-4e86-8a04-c1176e0cad7a", "node_chart": [["x", "node-2.domain.tld"], ["Avg ping_icmp, ms", 2.2590886291481316], ["Max ping_icmp, ms", 4.106660719101958], ["Min ping_icmp, ms", 0.38010830187040995], ["Avg tcp_download, Mbits/s", 3572.518661493673], ["Max tcp_download, Mbits/s", 4419.792371356487], ["Min tcp_download, Mbits/s", 1869.415626426403], ["Avg tcp_upload, Mbits/s", 4226.455307923521], ["Max tcp_upload, Mbits/s", 4703.761560648594], ["Min tcp_upload, Mbits/s", 3714.2024773049793]]}, "4d810b99-6943-431e-b7de-55daca122652": {"stats": {"ping_icmp": {"max": 3.1675264745841134, "avg": 2.067411343034852, "unit": "ms", "min": 0.26452595112233057}, "tcp_upload": {"max": 7717.715008848403, "avg": 7161.253212546517, "unit": "Mbits/s", "min": 6257.036176287442}}, "scenario": "OpenStack L3 East-West", "concurrency": 1, "test": "Upload", "type": "concurrency", "id": "4d810b99-6943-431e-b7de-55daca122652", "node_chart": [["x", "node-2.domain.tld"], ["Avg ping_icmp, ms", 2.067411343034852], ["Max ping_icmp, ms", 3.1675264745841134], ["Min ping_icmp, ms", 0.26452595112233057], ["Avg tcp_upload, Mbits/s", 7161.253212546517], ["Max tcp_upload, Mbits/s", 7717.715008848403], ["Min tcp_upload, Mbits/s", 6257.036176287442]]}, "74cb1be9-c317-4187-b6f2-0cde8f4a003e": {"stats": {"ping_icmp": {"max": 2.8323346471748834, "avg": 1.703575624623216, "unit": "ms", "min": 0.4047213901368843}, "tcp_download": {"max": 7825.426030898186, "avg": 6959.381420398204, "unit": "Mbits/s", "min": 5872.353351898193}}, "scenario": "OpenStack L3 East-West", "concurrency": 1, "test": "Download", "type": "concurrency", "id": "74cb1be9-c317-4187-b6f2-0cde8f4a003e", "node_chart": [["x", "node-2.domain.tld"], ["Avg ping_icmp, ms", 1.703575624623216], ["Max ping_icmp, ms", 2.8323346471748834], ["Min ping_icmp, ms", 0.4047213901368843], ["Avg tcp_download, Mbits/s", 6959.381420398204], ["Max tcp_download, Mbits/s", 7825.426030898186], ["Min tcp_download, Mbits/s", 5872.353351898193]]}, "61f41cdb-aa4a-47f5-b00b-e26401a5bdaf": {"meta": [["concurrency", ""], ["ping_icmp", "ms"], ["tcp_download", "Mbits/s"]], "scenario": "OpenStack L3 East-West", "test": "Download", "type": "test", "chart": [["concurrency", 1], ["ping_icmp", 1.703575624623216], ["tcp_download", 6959.381420398204]], "id": "61f41cdb-aa4a-47f5-b00b-e26401a5bdaf"}, "746e7496-204a-4bec-a0a6-28f48fbffe3a": {"meta": [["concurrency", ""], ["ping_icmp", "ms"], ["tcp_upload", "Mbits/s"]], "scenario": "OpenStack L3 East-West", "test": "Upload", "type": "test", "chart": [["concurrency", 1], ["ping_icmp", 2.067411343034852], ["tcp_upload", 7161.253212546517]], "id": "746e7496-204a-4bec-a0a6-28f48fbffe3a"}, "0fe7fb50-7f84-4cef-a429-bb7d08e25405": {"meta": [["concurrency", ""], ["ping_icmp", "ms"], ["tcp_download", "Mbits/s"], ["tcp_upload", "Mbits/s"]], "scenario": "OpenStack L3 East-West", "test": "Bi-directional", "type": "test", "chart": [["concurrency", 1], ["ping_icmp", 2.2590886291481316], ["tcp_download", 3572.518661493673], ["tcp_upload", 4226.455307923521]], "id": "0fe7fb50-7f84-4cef-a429-bb7d08e25405"}, "a82a300b-2fe5-43a6-8177-30f8945604a9": {"status": "ok", "node": "node-2.domain.tld", "finish": 1471431510.3362, "stats": {"ping_icmp": {"max": 2.8323346471748834, "avg": 1.703575624623216, "unit": "ms", "min": 0.4047213901368843}, "tcp_download": {"max": 7825.426030898186, "avg": 6959.381420398204, "unit": "Mbits/s", "min": 5872.353351898193}}, "stderr": "", "scenario": "OpenStack L3 East-West", "concurrency": 1, "schedule": 1471431439.894315, "agent": "shaker_rztpse_master_0", "start": 1471431439.905615, "meta": [["time", "s"], ["ping_icmp", "ms"], ["tcp_download", "Mbits/s"]], "command": {"data": "zcat `flent -H 10.2.0.3 -l 60 -s 1 tcp_download 2>&1 | grep \"se with\" | grep -Po '\\./\\S+'`", "type": "script"}, "samples": [[0.0, 0.944, null], [1.0, 0.6199989724703198, null], [2.0, 0.514964219365457, null], [3.0, 0.48339356331811456, null], [4.0, 0.6660385335123264, null], [5.0, 0.6842863788806719, null], [6.0, 2.3989671077960493, 5962.12], [7.0, 1.6702428227394002, 7021.1647454524045], [8.0, 2.0294923420188975, 7752.104278326035], [9.0, 0.7745817206188208, 7250.703252925872], [10.0, 0.8309412845148132, 6607.899800577164], [11.0, 0.7841053938634249, 7009.137738156319], [12.0, 0.6961021197212529, 6681.93298151493], [13.0, 0.8468430878916495, 6683.267815754413], [14.0, 0.9179204123921721, 6675.882447650433], [15.0, 0.9559567125534644, 6871.501818602085], [16.0, 1.1295208790853049, 6703.69978896141], [17.0, 1.1499202567936981, 6839.66039536953], [18.0, 1.1699139861626597, 6884.486012835503], [19.0, 1.3887490283068933, 6877.889783711433], [20.0, 1.697699129808935, 6885.8549320817], [21.0, 1.8487391298134295, 6878.850875489711], [22.0, 2.1962752423431464, 6892.888292691708], [23.0, 2.101179256909541, 6866.870583232384], [24.0, 1.991410530828545, 6957.3907942461965], [25.0, 2.05907659634102, 7146.611604039669], [26.0, 2.2078344640802516, 7025.180736372471], [27.0, 2.121403826085797, 7072.809430177212], [28.0, 2.1101676156592104, 7208.877184271812], [29.0, 2.1983790568286405, 7216.43318210125], [30.0, 2.2294210255495663, 7191.544498038292], [31.0, 2.1810266390124493, 7071.6362990331645], [32.0, 2.5124905328908844, 6589.736842610836], [33.0, 2.8323346471748834, 5897.083545451163], [34.0, 2.4989218765808285, 5872.353351898193], [35.0, 1.8376726847585, 7262.050580451489], [36.0, 1.9851764968450967, 6467.577444863319], [37.0, 2.1452671773903558, 7783.525790262222], [38.0, 1.868709650743355, 7798.209210491181], [39.0, 1.937442665001041, 7825.426030898186], [40.0, 1.9496691406573747, 7796.228214626312], [41.0, 1.7954312393070975, 7780.718182325363], [42.0, 1.9635306624536626, 7769.13360490799], [43.0, 2.027776520290908, 7475.183165016175], [44.0, 2.6259621734757363, 6924.317881631851], [45.0, 2.035512026234293, 6195.895195555687], [46.0, 1.9908018455720715, 7389.849366054535], [47.0, 1.9804018362354694, 7257.358221831321], [48.0, 2.056765538382917, 7344.307075266838], [49.0, 2.1655245658670714, 7269.473143634796], [50.0, 1.978335494768612, 7465.351712636947], [51.0, 2.123145279361405, 7280.840412940978], [52.0, 2.579106014641177, 7051.868847535476], [53.0, 2.4568917325491793, 6009.771714258194], [54.0, 2.240207616876843, 6061.885909156799], [55.0, 2.353793837333606, 6084.485565567016], [56.0, 1.8176984746926768, 6231.748264398575], [57.0, 2.093781854049305, 7643.857692556381], [58.0, 1.9772455140593375, 7413.130139913559], [59.0, 2.0362356710720535, 7395.745737676621], [60.0, 2.2006375733290406, 6915.572893390656], [61.0, 2.2194365102193796, 6688.081951780319], [62.0, 2.1446037962840148, 6738.433962173462], [63.0, 2.1494126662605653, 6975.761465091706], [64.0, 2.1311984927040357, 6881.542328195572], [65.0, 0.5510325395080005, 6375.791927627405], [66.0, 0.7248595969609236, 6373.57], [67.0, 0.7335214066136109, null], [68.0, 0.4047213901368843, null], [69.0, 0.5264856470769963, null]], "executor": "flent", "test": "Download", "type": "agent", "id": "a82a300b-2fe5-43a6-8177-30f8945604a9"}, "caec3ea3-065d-4a1d-8ae6-18ef77a0747a": {"status": "ok", "node": "node-2.domain.tld", "finish": 1471431691.169668, "stats": {"ping_icmp": {"max": 4.106660719101958, "avg": 2.2590886291481316, "unit": "ms", "min": 0.38010830187040995}, "tcp_download": {"max": 4419.792371356487, "avg": 3572.518661493673, "unit": "Mbits/s", "min": 1869.415626426403}, "tcp_upload": {"max": 4703.761560648594, "avg": 4226.455307923521, "unit": "Mbits/s", "min": 3714.2024773049793}}, "stderr": "", "scenario": "OpenStack L3 East-West", "concurrency": 1, "schedule": 1471431620.759303, "agent": "shaker_rztpse_master_0", "start": 1471431620.769467, "meta": [["time", "s"], ["ping_icmp", "ms"], ["tcp_download", "Mbits/s"], ["tcp_upload", "Mbits/s"]], "command": {"data": "zcat `flent -H 10.2.0.3 -l 60 -s 1 tcp_bidirectional 2>&1 | grep \"se with\" | grep -Po '\\./\\S+'`", "type": "script"}, "samples": [[0.0, 1.2, null, null], [1.0, 0.6395106043769541, null, null], [2.0, 0.38010830187040995, null, null], [3.0, 0.5349237677173633, null, null], [4.0, 0.5140098485816631, null, null], [5.0, 0.4630236622087732, null, null], [6.0, 0.5517985258944232, 2339.0, 4163.6], [7.0, 0.5460077051711231, 2295.272370355129, 4344.771180970669], [8.0, 0.4860252703136096, 2038.9449561595916, 4366.4632624095575], [9.0, 0.6678841245134333, 2550.8281136822698, 4422.82012016058], [10.0, 0.8968056182860673, 2426.7750375407973, 4417.765135602951], [11.0, 0.9748261571618226, 2034.4863094854354, 4475.449325177718], [12.0, 0.7108020112220013, 2366.58463285923, 4541.203990595211], [13.0, 1.388148616652071, 2314.246425164428, 4582.513509321667], [14.0, 1.4099144555300156, 2078.572622013092, 4532.913398748791], [15.0, 1.0221186869336352, 2194.1508508491515, 4648.9787592363355], [16.0, 0.9604148187860921, 1869.415626426403, 4703.761560648594], [17.0, 1.6837449104578575, 2098.708366723061, 4699.432070673352], [18.0, 1.1351244165665086, 2475.641450109482, 4570.703358580643], [19.0, 1.3971104338422213, 3154.232345814705, 4576.708917794193], [20.0, 1.9826934175850959, 3693.9608322238923, 4287.086136171768], [21.0, 1.1806503910256976, 3835.0591835641862, 4117.433985981656], [22.0, 1.8003406925097896, 3906.256512743367, 3769.8289113583], [23.0, 1.3571581156404078, 4174.515600041825, 3916.0515230595056], [24.0, 3.019402956322044, 4419.792371356487, 4158.035318374496], [25.0, 3.1382644047762485, 4319.776698276383, 4159.318437936614], [26.0, 3.2477341429220434, 4019.376765909195, 4376.806902126803], [27.0, 3.6019844106805974, 4112.913805248738, 4449.982069026338], [28.0, 3.424509480287007, 4112.075980563163, 4094.7232794884803], [29.0, 3.7707872523260133, 4105.7725678969, 4135.678292808533], [30.0, 3.643820280505563, 4123.5373005485535, 4351.097460200382], [31.0, 1.5875308189536983, 3808.485919668675, 3917.040119025707], [32.0, 3.1781810502052528, 3881.912509241104, 4201.162711293419], [33.0, 3.6561106354194823, 3698.7122507786753, 4000.0181943178177], [34.0, 2.4212870364765475, 3644.795483226267, 3753.0249554281186], [35.0, 2.5056395417759085, 3624.6451181970315, 3714.2024773049793], [36.0, 2.7607250110209898, 4024.230215072632, 4150.450968036665], [37.0, 3.895900563628542, 4056.2356029510497, 4044.024664261246], [38.0, 3.006952072702486, 4066.1851242468138, 4080.305347146988], [39.0, 3.987718863039257, 4082.897864527702, 4023.5306009051346], [40.0, 3.1661341100449523, 4074.4488389182843, 4016.243363507637], [41.0, 4.106660719101958, 4084.2837524414062, 4234.887789347524], [42.0, 3.7865098930479375, 4010.247730981413, 4395.40067923353], [43.0, 3.5311879271271294, 3827.4466687631607, 4066.6169806630846], [44.0, 2.794664056421693, 3738.0173209681175, 3885.4286597902824], [45.0, 2.9504884705344883, 4039.057896200523, 4391.6743882050205], [46.0, 3.330879846013199, 3990.778099470139, 4399.062571027279], [47.0, 2.447125890492957, 3939.9722041072782, 4351.517989728451], [48.0, 2.418978001513525, 3978.5921765899657, 4364.946217917892], [49.0, 3.2908271266841433, 3616.430121181432, 4455.389451332092], [50.0, 2.715828953293071, 3203.5361865466684, 4130.200282897949], [51.0, 2.2077674330447077, 3653.9327955508234, 4461.179178808268], [52.0, 2.6984767967313896, 3844.419072654247, 4341.067750393652], [53.0, 2.0240594988164897, 4039.290970744776, 4170.031693484194], [54.0, 3.209110317104365, 4003.445854079723, 4238.694706189633], [55.0, 3.3087292687890266, 4038.0930120277408, 4122.591793566648], [56.0, 3.823775032312418, 3966.5595632290842, 3947.1943802496116], [57.0, 3.9066547284557216, 3822.86230126107, 3729.2608733335414], [58.0, 3.313651484450709, 3992.4758714985846, 4038.2540715894115], [59.0, 3.6511993245935916, 3993.350156667232, 4044.6399146071135], [60.0, 3.466520425091572, 3851.34498742342, 4264.064938006401], [61.0, 3.8297569627698884, 3854.5427502069297, 4263.103850205627], [62.0, 3.397628067702834, 3978.2296176784744, 4160.654130297154], [63.0, 3.5170394005337435, 3954.762822747564, 4131.535699548721], [64.0, 3.760719467955029, 4023.860096683502, 4060.5103717899324], [65.0, 0.6734624197987884, 4226.880669027092, 4200.8051134408925], [66.0, 0.6116738467832279, 4228.78, 4201.93], [67.0, 0.5548258967658252, null, null], [68.0, 0.48237278252673627, null, null], [69.0, 0.42980281797938946, null, null]], "executor": "flent", "test": "Bi-directional", "type": "agent", "id": "caec3ea3-065d-4a1d-8ae6-18ef77a0747a"}, "9e84958b-606a-42da-b37b-55cf8894126d": {"status": "ok", "node": "node-2.domain.tld", "finish": 1471431600.75205, "stats": {"ping_icmp": {"max": 3.1675264745841134, "avg": 2.067411343034852, "unit": "ms", "min": 0.26452595112233057}, "tcp_upload": {"max": 7717.715008848403, "avg": 7161.253212546517, "unit": "Mbits/s", "min": 6257.036176287442}}, "stderr": "", "scenario": "OpenStack L3 East-West", "concurrency": 1, "schedule": 1471431530.343917, "agent": "shaker_rztpse_master_0", "start": 1471431530.354095, "meta": [["time", "s"], ["ping_icmp", "ms"], ["tcp_upload", "Mbits/s"]], "command": {"data": "zcat `flent -H 10.2.0.3 -l 60 -s 1 tcp_upload 2>&1 | grep \"se with\" | grep -Po '\\./\\S+'`", "type": "script"}, "samples": [[0.0, 1.25, null], [1.0, 0.626482544341342, null], [2.0, 0.42195776771240107, null], [3.0, 0.328977322600057, null], [4.0, 0.30100808928395173, null], [5.0, 0.312550182828907, null], [6.0, 2.30762168943095, 6719.51], [7.0, 3.1675264745841134, 6257.036176287442], [8.0, 2.1132239827660637, 6589.216838648012], [9.0, 2.468329072487696, 7603.232566263676], [10.0, 2.340730291849971, 7622.581693829556], [11.0, 2.300299076327336, 7446.505169315338], [12.0, 3.0032250009576513, 6473.474725183929], [13.0, 2.237101987658532, 6708.940780074207], [14.0, 1.9527434584062877, 7258.466944278644], [15.0, 2.1574797270357893, 7486.349683380126], [16.0, 2.4164237413510126, 7388.851280645774], [17.0, 1.9372253198168168, 7407.538171388911], [18.0, 2.2150716036155536, 7410.92434317463], [19.0, 2.043259835599996, 7388.286671640873], [20.0, 2.2362676247808633, 7400.269699949911], [21.0, 1.9949786623653272, 7387.378134175602], [22.0, 2.2640556288918225, 6937.74331436147], [23.0, 2.92445418193975, 6947.1904063691345], [24.0, 2.393803205134462, 6952.250946669274], [25.0, 3.0223257157294663, 6832.847265117168], [26.0, 2.4564126794098753, 7013.468078701002], [27.0, 2.5759438868959537, 7055.310853641033], [28.0, 2.647851553918695, 6986.3926301278725], [29.0, 2.475800950263633, 6954.463548064232], [30.0, 2.402358078613016, 6988.308423521936], [31.0, 2.621866211229442, 7017.709913358688], [32.0, 2.5818191817469223, 6964.462299458943], [33.0, 2.33928695227488, 7065.831069226265], [34.0, 2.435748208592424, 7361.277695692602], [35.0, 2.324805917507173, 7395.136117070915], [36.0, 2.444589485045101, 7607.20423195839], [37.0, 2.5456735506856565, 7634.38412781043], [38.0, 2.3302764435839576, 7647.505564074517], [39.0, 2.0051093575251353, 7627.238193615907], [40.0, 1.9709364678971735, 7584.577240591049], [41.0, 2.2270076334532836, 7601.338596469499], [42.0, 2.040333070322493, 7118.6482495390455], [43.0, 2.504615001005716, 6928.110879823961], [44.0, 2.7005435957581603, 6963.163214817047], [45.0, 2.350202665060317, 6974.422099346004], [46.0, 2.2449004802529604, 6412.691513232111], [47.0, 2.466566728861969, 6905.957993363341], [48.0, 2.2348927314548046, 6934.799134962559], [49.0, 2.8409244560098874, 6942.537670359856], [50.0, 2.795496500221436, 6841.3957754993435], [51.0, 2.180516835947295, 6816.164089701176], [52.0, 2.0557100353208275, 7174.800541807361], [53.0, 1.9938714641935968, 7310.912488466113], [54.0, 2.2798057385138937, 7369.438269243241], [55.0, 2.085238381919272, 7549.287531801633], [56.0, 1.9580734345265174, 7520.971688024997], [57.0, 2.8612344495515014, 7717.715008848403], [58.0, 2.1864586686397303, 6725.357095153332], [59.0, 2.046406501035384, 7197.619555710267], [60.0, 2.401971978368364, 7567.710729756355], [61.0, 2.114842200412239, 7543.951988477706], [62.0, 2.940901994932372, 7085.191446056367], [63.0, 2.409178187508326, 6492.702783328705], [64.0, 2.0922595988519577, 7283.688718603653], [65.0, 0.4544212324959911, 7367.844105278047], [66.0, 0.40606334047329956, 7368.16], [67.0, 0.28167125012459804, null], [68.0, 0.26452595112233057, null], [69.0, 0.4045587934159365, null]], "executor": "flent", "test": "Upload", "type": "agent", "id": "9e84958b-606a-42da-b37b-55cf8894126d"}}, "tests": {"Download": {"class": "flent", "method": "tcp_download", "title": "Download"}, "Bi-directional": {"class": "flent", "method": "tcp_bidirectional", "title": "Bi-directional"}, "Upload": {"class": "flent", "method": "tcp_upload", "title": "Upload"}}, "agents": {"shaker_rztpse_slave_0": {"node": "node-5.domain.tld", "zone": "nova", "availability_zone": "nova:node-5.domain.tld", "ip": "10.2.0.3", "master": {"node": "node-2.domain.tld", "zone": "nova", "availability_zone": "nova:node-2.domain.tld", "ip": "10.1.0.5", "mode": "master", "slave_id": "shaker_rztpse_slave_0", "id": "shaker_rztpse_master_0"}, "mode": "slave", "master_id": "shaker_rztpse_master_0", "id": "shaker_rztpse_slave_0"}, "shaker_rztpse_master_0": {"node": "node-2.domain.tld", "slave": {"node": "node-5.domain.tld", "zone": "nova", "availability_zone": "nova:node-5.domain.tld", "ip": "10.2.0.3", "mode": "slave", "master_id": "shaker_rztpse_master_0", "id": "shaker_rztpse_slave_0"}, "zone": "nova", "availability_zone": "nova:node-2.domain.tld", "ip": "10.1.0.5", "mode": "master", "slave_id": "shaker_rztpse_slave_0", "id": "shaker_rztpse_master_0"}}, "sla": []};
  </script>

  <script type="text/javascript">
    "use strict";

    $(function () {

      var fields = ["scenario", "test", "concurrency", "node", "agent"];
      var state = {
        scenario: "",
        test: "",
        concurrency: "",
        node: "",
        agent: ""
      };
      var tablePageSize = 10;

      // compiled templates
      var scenario_source_template = Handlebars.compile($("#scenario_source_template").html());
      var test_specification_template = Handlebars.compile($("#test_specification_template").html());
      var agents_table_template = Handlebars.compile($("#agents_table_template").html());
      var records_table_template = Handlebars.compile($("#records_table_template").html());
      var executor_template = Handlebars.compile($("#executor_template").html());
      var concurrency_summary_template = Handlebars.compile($("#concurrency_summary_template").html());
      var test_summary_template = Handlebars.compile($("#test_summary_template").html());
      var sla_table_template = Handlebars.compile($("#sla_table_template").html());
      var errors_template = Handlebars.compile($("#errors_template").html());

      function concatenate(strings) {
        // returns strings concatenated via comma (like join() but omits empty strings)
        var f = false;
        var result = "";
        $.each(strings, function (_i, string) {
          if (string.length > 0) {
            if (f) result += ", ";
            result += string;
            f = true;
          }
        });
        return result;
      }

      function initSingleSelector(name, values) {
        var selectorId = "#" + name + "_selector";

        var selector_inst = $(selectorId);
        selector_inst.empty();
        selector_inst.append($("<option>", {
          style: "font-style: italic; text-decoration: underline;",
          value: "",
          text: selector_inst.data('placeholder')
        }));

        $.each(values, function (key, item) {
          selector_inst.append($('<option>', {
            value: item, //(key + 1),
            text: item
          }));
        });

        selector_inst.val(state[name]);

        selector_inst.
            on("change", function (e) {
              state[name] = this.value;

              // convert state -> url
              var tokens = [];
              $.each(fields.sort(), function (i, field) {
                if (state[field] != "") {
                  tokens.push(field + "=" + state[field]);
                }
              });
              window.location.href = "#" + tokens.join(":");
            });
      }

      function getFieldValues(field, records) {
        var values_set = {};

        $.each(records, function (j, record) {
          if (record[field]) {
            values_set["" + record[field]] = true;
          }
        });

        return $.map(values_set, function (_i, value) {
          return value;
        }).sort();
      }

      function updateSelectors() {
        $.each(fields, function (i, field) {
          var values = getFieldValues(field, filterRecords(report.records, null, field));
          console.log(values);
          initSingleSelector(field, values);
        });
      }

      function filterRecords(records, type, except_field) {
        var res = [];
        $.each(records, function(_i, record){
          if (!type || typeof type === 'undefined' || record.type == type) {
            var flag = true;
            $.each(state, function (key, value) {
              if (key != except_field && value) {
                flag &= record[key] == value;
              }
            });
            if (flag) {
              res.push(record);
            }
          }
        });
        return res;
      }

      function getAgentsByIds(agent_ids) {
        var agents = [];
        $.each(agent_ids, function(agent_id){
          agents.push(report.agents[agent_id]);
        });
        return agents;
      }

      /* Template Rendering Funcs */

      function showScenarioSource(contentArea, scenario) {
        contentArea.append(scenario_source_template(
            {data: jsyaml.safeDump(scenario)}));
      }

      function showTestSpecification(contentArea, test) {
        contentArea.append(test_specification_template(
            {data: jsyaml.safeDump(test)}
        ))
      }

      function showAgentRecord(contentArea, record) {
        var chart_id = "chart_" + Math.round(Math.random() * 10000);
        var ext_options = {
          command_yaml: jsyaml.safeDump(record["command"]),
          chart_id: chart_id};
        if (record["stats"]) {
          ext_options["stats_yaml"] = jsyaml.safeDump(record["stats"]);
        }
        if ((record["start"]) && (record["finish"])) {
          ext_options["time_info"] = jsyaml.safeDump({
            "start": new Date(record["start"] * 1000).toISOString(),
            "finish": new Date(record["finish"] * 1000).toISOString()
          });
        }
        contentArea.append(executor_template(
            {record: $.extend({}, record, ext_options)}
        ));
        if (record["samples"]) {
          var meta = record["meta"];
          var axes = [];
          axes[meta[1][0]] = 'y';
          var axis = {
            x: {label: concatenate(meta[0])},
            y: {label: concatenate(meta[1]), min: 0}
          };
          if (meta.length > 2) {
            axes[meta[2][0]] = 'y2';
            axis['y2'] = {label: concatenate(meta[2]), min: 0, show: true}
          }

          var chart = [];
          $.each(meta, function(_i, meta_item){  // row titles
            chart.push([meta_item[0]]);
          });
          var samples = record["samples"];
          for (var i=0; i < samples.length; i++) {
            var point = samples[i];
            for (var j=0; j < point.length; j++) {
              chart[j].push(point[j]);
            }
          }

          c3.generate({
            bindto: "#" + chart_id,
            data: {
              x: 'time',
              columns: chart,
              axes: axes
            },
            axis: axis
          });
        }
      }

      function showConcurrencySummary(contentArea, record) {
        var chart_id = "chart_" + Math.round(Math.random() * 10000);
        var node_chart_id = "node_chart_" + Math.round(Math.random() * 10000);
        var ext_options = { chart_id: chart_id, node_chart_id: node_chart_id };
        if (record["stats"]) {
          ext_options["stats_yaml"] = jsyaml.safeDump(record["stats"]);
        }
        console.log(record);
        contentArea.append(concurrency_summary_template(
            {record: $.extend({}, record, ext_options)}
        ));
        if (record["node_chart"]) {
          c3.generate({
            bindto: "#" + node_chart_id,
            data: {
              x: 'x',
              columns: record["node_chart"],
              type: 'step',
              order: null
            },
            axis: {
              x: { type: 'category' }
            }
          });
        }
      }

      function showTestSummary(contentArea, record) {
        console.log(record);
        var chart_id = "chart_" + Math.round(Math.random() * 10000);
        var ext_options = { chart_id: chart_id };
        if (record["stats"]) {
          ext_options["stats_yaml"] = jsyaml.safeDump(record["stats"]);
        }
        contentArea.append(test_summary_template(
            {record: $.extend({}, record, ext_options)}
        ));
        if (record["chart"]) {
          var meta = record["meta"];
          var axes = [];
          axes[meta[1][0]] = 'y';
          var axis = {
            x: {label: concatenate(meta[0])},
            y: {label: concatenate(meta[1]), min: 0}
          };
          if (meta.length > 2) {
            axes[meta[2][0]] = 'y2';
            axis['y2'] = {label: concatenate(meta[2]), min: 0, show: true}
          }

          c3.generate({
            bindto: "#" + chart_id,
            data: {
              x: 'concurrency',
              columns: record["chart"],
              axes: axes
            },
            axis: axis
          });
        }
      }

      function showAgentsTable(contentArea, filteredRecords) {
        var agent_ids = {};
        $.each(filteredRecords, function(_i, record){
          if (record.agent) {
            agent_ids[record.agent] = true;
          }
        });

        var agents = getAgentsByIds(agent_ids);
        if (agents.length == 0) return;

        // add slave agents
        var slave_agent_ids = {};
        $.each(agents, function(_i, agent){
          if (agent.slave_id) {
            slave_agent_ids[agent.slave_id] = true;
          }
        });
        agents = $.merge(agents, getAgentsByIds(slave_agent_ids));

        contentArea.append(agents_table_template({
          agents: agents,
          table_id: "agents_table"
        }));
        $("#agents_table").dataTable({
          "autoWidth": true,
          "paging": false,
          "ordering": true,
          "info": false
        });
      }

      function makeURL(record, s) {
        var extra = {};
        extra[s] = record[s];
        return "#" + $.map($.extend({}, state, extra), function (val, index) {
          return val? (index + "=" + val) : null;
        }).join(":")
      }

      function showRecordsTable(contentArea, filteredRecords) {
        $.each(filteredRecords, function(_i, record) {
          $.each(fields, function(_j, field){
            if (record[field]) {
              record[field + "_url"] = makeURL(record, field);
            }
          });
        });

        contentArea.append(records_table_template({
          records: filteredRecords,
          table_id: "records_table"
        }));
        $("#records_table").dataTable({
          autoWidth: true,
          paging: filteredRecords.length > tablePageSize,
          ordering: true,
          info: false,
          searching: filteredRecords.length > tablePageSize
        });
      }

      function showSlaTable(contentArea, records) {
        if (records.length == 0) return;

        contentArea.append(sla_table_template({
          records: records,
          table_id: "sla_table"
        }));
        $("#records_table").dataTable({
          autoWidth: true,
          paging: records.length > tablePageSize,
          ordering: true,
          info: false,
          searching: records.length > tablePageSize
        });
      }

      function showErrors(contentArea, records) {
        if (records.length == 0) return;

        contentArea.append(errors_template({
          records: records,
          table_id: "errors_list"
        }));
      }

      /* Update cycle */

      function update() {
        var filteredRecords = filterRecords(report.records);
        console.log(filteredRecords);
        var slaRecords = [];
        var errorRecords = [];
        $.each(filterRecords(report.records), function(_i, record) {
          if (record["sla_info"]) {
            slaRecords.push(record);
          }
          if (record["is_status_error"]) {
            errorRecords.push(record);
          }
        });

        var contentArea = $("#content_area");
        contentArea.empty();

        updateSelectors();

        showRecordsTable(contentArea, filteredRecords);
        showSlaTable(contentArea, slaRecords);
        showErrors(contentArea, errorRecords);

        if (state["scenario"] != "" && state["test"] != "" &&
                state["concurrency"] != "" &&
                state["agent"] != "") {
          showAgentRecord(contentArea, filteredRecords[0]);
        }
        if (state["scenario"] != "" && state["test"] != "" &&
                state["concurrency"] != "" && state["node"] == "" &&
                state["agent"] == "") {
          var agg_recs = filterRecords(report.records, "concurrency");
          if (agg_recs.length > 0) {
            showConcurrencySummary(contentArea, agg_recs[0]);
          }
        }
        if (state["scenario"] != "" && state["test"] != "" &&
                state["concurrency"] == "" && state["node"] == "" &&
                state["agent"] == "") {
          var test_recs = filterRecords(report.records, "test");
          if (test_recs.length > 0) {
            showTestSummary(contentArea, test_recs[0]);
          }
        }
        if (state["test"] != "") {
          showTestSpecification(contentArea, report.tests[state["test"]]);
        }
        if (state["agent"] == "") {
          showAgentsTable(contentArea, filteredRecords);
        }
        if (state["scenario"] != "") {
          showScenarioSource(contentArea, report.scenarios[state["scenario"]]);
        }
      }

      function parseUrlToState() {
        var hashUrl = window.location.hash.substr(1);

        $.each(hashUrl.split(":"), function (_i, pair) {
          var kv = pair.split("=");
          if (kv.length == 2) {
            state[kv[0]] = decodeURIComponent(kv[1]);
          }
        });
      }

      // entry-point
      parseUrlToState();
      console.log(state);

      // pre-process records
      $.each(report.records, function(_i, record) {
        if (record.status) {
          record["is_status_ok"] = record.status == "ok";
          record["is_status_lost"] = record.status == "lost";
          record["is_status_interrupted"] = record.status == "interrupted";
          record["is_status_error"] = record.status == "error";
        }
      });

      // auto-select filters with 1 option
      $.each(fields, function(_i, field) {
        var values = getFieldValues(field, report.records);
        if (values.length == 1) {
          state[field] = values[0];
        }
      });

      update();

      $(window).on('hashchange', function() {
        parseUrlToState();
        update()
      });

      $('[data-toggle="tooltip"]').tooltip();
    });
  </script>

  <style type="text/css">
  </style>

</head>

<body>

<div class="container" id="container">
  <div class="row text-center">
    <h1>Shaker | The Report</h1>
  </div>
  <hr>
  <div class="row">
    <div class="col-md-2">
      <label for="scenario_selector" title="Scenario name">Scenario</label>
      <select id="scenario_selector" class="form-control" data-placeholder="- Any scenario -"></select>
    </div>
    <div class="col-md-2">
      <label for="test_selector" title="Test name">Test Case</label>
      <select id="test_selector" class="form-control" data-placeholder="- Any test case -"></select>
    </div>
    <div class="col-md-2">
      <label for="concurrency_selector" title="Concurrency">Concurrency</label>
      <select id="concurrency_selector" class="form-control" data-placeholder="- Any concurrency -"></select>
    </div>
    <div class="col-md-2">
      <label for="node_selector" title="Host / Compute node">Host</label>
      <select id="node_selector" class="form-control" data-placeholder="- Any node -"></select>
    </div>
    <div class="col-md-2">
      <label for="agent_selector" title="Agent">Agent</label>
      <select id="agent_selector" class="form-control" data-placeholder="- Any agent -"></select>
    </div>
  </div>

  <div id="content_area" class="row">
    <!-- Container for the screen content -->
  </div>

  <div id="footer" class="row">&nbsp;</div>
</div>

<!-- TEMPLATES --------------------------------------------------------------->

<!-- Scenario File -->
<script id="scenario_source_template" type="text/x-handlebars-template">
  <h3>Scenario</h3>
  <pre>{{ data }}</pre>
</script>

<!-- Test Specification -->
<script id="test_specification_template" type="text/x-handlebars-template">
  <h3>Test Specification</h3>
  <pre>{{ data }}</pre>
</script>

<!-- Executor Result -->
<script id="executor_template" type="text/x-handlebars-template">
  <h3>Execution Summary</h3>
  {{#with record}}
  <div id="{{ chart_id }}"></div>
  {{#if is_status_ok}}<span class="label label-success"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span>success</span>{{/if}}
  {{#if is_status_lost}}<span class="label label-danger"><span class="glyphicon glyphicon-alert" aria-hidden="true"></span>lost</span>{{/if}}
  {{#if is_status_interrupted}}<span class="label label-warning"><span class="glyphicon glyphicon-stop" aria-hidden="true"></span>interrupted</span>{{/if}}
  {{#if is_status_error}}<span class="label label-danger"><span class="glyphicon glyphicon-alert" aria-hidden="true"></span>error</span>{{/if}}
  {{#if stats_yaml}}
    <h4>Stats</h4>
    <pre>{{ stats_yaml }}</pre>
  {{/if}}
  {{#if time_info}}
    <h4>Time Info</h4>
    <pre>{{ time_info }}</pre>
  {{/if}}
  <h4>Command</h4>
  <pre>{{ command_yaml }}</pre>
  {{#if stdout}}
    <h4>Stdout</h4>
    <pre>{{ stdout }}</pre>
  {{/if}}
  {{#if verbose}}
    <h4>Verbose Info</h4>
    <pre>{{ verbose }}</pre>
  {{/if}}
  {{#if stderr}}
    <h4>Stderr</h4>
    <pre>{{ stderr }}</pre>
  {{/if}}
  {{/with}}
</script>

<!-- Concurrency summary -->
<script id="concurrency_summary_template" type="text/x-handlebars-template">
  {{#with record}}
  <div id="{{ chart_id  }}"></div>
  <h3>Per-node chart</h3>
  <div id="{{ node_chart_id  }}"></div>
  <h3>Stats</h3>
  <pre>{{ stats_yaml }}</pre>
  {{/with}}
</script>

<!-- Test summary -->
<script id="test_summary_template" type="text/x-handlebars-template">
  {{#with record}}
  <div id="{{ chart_id   }}"></div>
  {{#if stats_yaml}}
    <h3>Stats</h3>
    <pre>{{ stats_yaml }}</pre>
  {{/if}}
  {{/with}}
</script>

<!-- Records Table -->
<script id="records_table_template" type="text/x-handlebars-template">
  <h3>Records</h3>
  <table class="table table-striped" id="{{ table_id  }}">
    <thead>
    <tr>
      <th>Scenario</th>
      <th>Test Case</th>
      <th>Concurrency</th>
      <th>Host / Compute Node</th>
      <th>Agent</th>
      <th>Status</th>
    </tr>
    </thead>
    <tbody>
    {{#records}}
    <tr>
      <td><a href="{{ scenario_url }}">{{ scenario }}</a></td>
      <td><a href="{{ test_url }}">{{ test }}</a></td>
      <td><a href="{{ concurrency_url }}">{{ concurrency }}</a></td>
      <td><a href="{{ node_url }}">{{ node }}</a></td>
      <td><a href="{{ agent_url }}">{{ agent }}</a></td>
      <td>
        {{#if is_status_ok }}
          <span class="label label-success">
            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
            success
          </span>
        {{/if}}
        {{#if is_status_lost }}
          <span class="label label-danger">
            <span class="glyphicon glyphicon-alert" aria-hidden="true"></span>
            lost
          </span>
        {{/if}}
        {{#if is_status_interrupted }}
          <span class="label label-warning">
            <span class="glyphicon glyphicon-stop" aria-hidden="true"></span>
            interrupted
          </span>
        {{/if}}
        {{#if is_status_error }}
          <span class="label label-danger">
            <span class="glyphicon glyphicon-stop" aria-hidden="true"></span>
            error
          </span>
        {{/if}}
      </td>
    </tr>
    {{/records}}
    </tbody>
  </table>
</script>

<!-- Agents List -->
<script id="agents_table_template" type="text/x-handlebars-template">
  <h3>Agents</h3>
  <table class="table table-striped" id="{{ table_id }}">
    <thead>
    <tr>
      <th>Agent</th>
      <th>Mode</th>
      <th>IP</th>
      <th>Node</th>
      <th>AZ</th>
    </tr>
    </thead>
    <tbody>
    {{#agents}}
    <tr>
      <td>{{ id }}</td>
      <td>{{ mode }}</td>
      <td>{{ ip }}</td>
      <td>{{ node }}</td>
      <td>{{ zone }}</td>
    </tr>
    {{/agents}}
    </tbody>
  </table>
</script>

<!-- SLA List -->
<script id="sla_table_template" type="text/x-handlebars-template">
  <h3>Agents</h3>
  <table class="table table-striped" id="{{  table_id }}">
    <thead>
    <tr>
      <th>Condition</th>
      <th>Location</th>
      <th>Status</th>
    </tr>
    </thead>
    <tbody>
    {{#records}}
    <tr>
      <td>{{ sla }}</td>
      <td>{{ location }}</td>
      <td>
        {{#if is_status_ok }}
          <span class="text-success">
            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
            {{ status }}
          </span>
        {{else}}
          <span class="text-danger">
            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
            {{ status }}
          </span>
        {{/if}}
      </td>
    </tr>
    {{/records}}
    </tbody>
  </table>
</script>

<!-- Errors -->
<script id="errors_template" type="text/x-handlebars-template">
  <h3>Errors</h3>
  <div class="text-danger">
    <ul>
    {{#records}}
      <li>{{ info }}<br/>{{ stderr }}{{ traceback }}</li>
    {{/records}}
    </ul>
  </div>
</script>

</body>
</html>