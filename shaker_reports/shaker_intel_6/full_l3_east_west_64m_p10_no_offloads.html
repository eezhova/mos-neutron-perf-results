<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head profile="http://gmpg.org/xfn/11">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>

  <title>Shaker | The distributed data-plane testing tool for OpenStack</title>

  <!-- LIBS -->

  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.4/js/bootstrap.js"></script>
  <script type="text/javascript"
          src="https://cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/3.0.1/handlebars.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/3.2.7/js-yaml.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.js"></script>

  <!-- STYLES -->

  <link rel="stylesheet"
        href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.4/simplex/bootstrap.min.css">
  <link rel=stylesheet type=text/css
        href="https://cdn.datatables.net/1.10.2/css/jquery.dataTables.min.css">
  <link rel=stylesheet type=text/css
        href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.css">
  <link rel='stylesheet' type='text/css'
        href='http://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic&subset=latin,cyrillic'>

  <script type="application/javascript">
    var report = {"scenarios": {"OpenStack L3 East-West": {"file_name": "shaker/shaker/scenarios/openstack/full_l3_east_west_iperf3_64m.yaml", "title": "OpenStack L3 East-West", "execution": {"tests": [{"buffer_size": 64000, "title": "Download", "threads": 10, "method": "tcp_download", "class": "iperf3"}, {"buffer_size": 64000, "title": "Upload", "threads": 10, "method": "tcp_upload", "class": "iperf3"}], "progression": "quadratic"}, "description": "In this scenario Shaker launches pairs of instances, each instance on its own compute node. All available compute nodes are utilized. Instances are connected to one of 2 tenant networks, which plugged into single router. The traffic goes from one network to the other (L3 east-west).", "deployment": {"accommodation": ["pair", "single_room"], "template": "l3_east_west.hot"}}}, "records": {"858f0002-c5c3-4277-9553-d9a72e2c4869": {"stats": {"bandwidth": {"max": 9780.120849609375, "avg": 8934.044996897379, "unit": "Mbit/s", "min": 8036.909103393555}, "retransmits": {"max": 212, "avg": 75, "unit": "", "min": 23}}, "scenario": "OpenStack L3 East-West", "concurrency": 1, "test": "Upload", "type": "concurrency", "id": "858f0002-c5c3-4277-9553-d9a72e2c4869", "node_chart": [["x", "node-2.domain.tld"], ["Avg bandwidth, Mbit/s", 8934.044996897379], ["Max bandwidth, Mbit/s", 9780.120849609375], ["Min bandwidth, Mbit/s", 8036.909103393555], ["Avg retransmits, ", 75], ["Max retransmits, ", 212], ["Min retransmits, ", 23]]}, "f09fac01-5da0-4db6-9517-d45b8a6e33e7": {"meta": [["concurrency", ""], ["bandwidth", "Mbit/s"], ["retransmits", ""]], "scenario": "OpenStack L3 East-West", "test": "Download", "type": "test", "chart": [["concurrency", 1], ["bandwidth", 8379.491329193115], ["retransmits", 119]], "id": "f09fac01-5da0-4db6-9517-d45b8a6e33e7"}, "bb8f2d6e-4fe0-49fb-b3dd-2f0fe268bb91": {"status": "ok", "node": "node-2.domain.tld", "finish": 1471350000.289737, "stats": {"bandwidth": {"max": 9469.25163269043, "avg": 8379.491329193115, "unit": "Mbit/s", "min": 7245.8648681640625}, "retransmits": {"max": 462, "avg": 119, "unit": "", "min": 0}}, "verbose": "end:\n  cpu_utilization_percent:\n    host_system: 18.4512\n    host_total: 19.0192\n    host_user: 0.568055\n    remote_system: 42.5872\n    remote_total: 43.4076\n    remote_user: 0.820336\n  streams:\n  - receiver:\n      bits_per_second: 913870000.0\n      bytes: 6854048706\n      end: 60.0002\n      seconds: 60.0002\n      socket: 4\n      start: 0\n    sender:\n      bits_per_second: 914195000.0\n      bytes: 6856488692\n      end: 60.0002\n      retransmits: 688\n      seconds: 60.0002\n      socket: 4\n      start: 0\n  - receiver:\n      bits_per_second: 802561000.0\n      bytes: 6019228684\n      end: 60.0002\n      seconds: 60.0002\n      socket: 6\n      start: 0\n    sender:\n      bits_per_second: 802762000.0\n      bytes: 6020738498\n      end: 60.0002\n      retransmits: 799\n      seconds: 60.0002\n      socket: 6\n      start: 0\n  - receiver:\n      bits_per_second: 879592000.0\n      bytes: 6596968248\n      end: 60.0002\n      seconds: 60.0002\n      socket: 8\n      start: 0\n    sender:\n      bits_per_second: 879879000.0\n      bytes: 6599114684\n      end: 60.0002\n      retransmits: 826\n      seconds: 60.0002\n      socket: 8\n      start: 0\n  - receiver:\n      bits_per_second: 944728000.0\n      bytes: 7085484828\n      end: 60.0002\n      seconds: 60.0002\n      socket: 10\n      start: 0\n    sender:\n      bits_per_second: 945032000.0\n      bytes: 7087764666\n      end: 60.0002\n      retransmits: 600\n      seconds: 60.0002\n      socket: 10\n      start: 0\n  - receiver:\n      bits_per_second: 878074000.0\n      bytes: 6585580472\n      end: 60.0002\n      seconds: 60.0002\n      socket: 12\n      start: 0\n    sender:\n      bits_per_second: 878392000.0\n      bytes: 6587962562\n      end: 60.0002\n      retransmits: 671\n      seconds: 60.0002\n      socket: 12\n      start: 0\n  - receiver:\n      bits_per_second: 873897000.0\n      bytes: 6554250462\n      end: 60.0002\n      seconds: 60.0002\n      socket: 14\n      start: 0\n    sender:\n      bits_per_second: 874189000.0\n      bytes: 6556441288\n      end: 60.0002\n      retransmits: 658\n      seconds: 60.0002\n      socket: 14\n      start: 0\n  - receiver:\n      bits_per_second: 937128000.0\n      bytes: 7028490600\n      end: 60.0002\n      seconds: 60.0002\n      socket: 16\n      start: 0\n    sender:\n      bits_per_second: 937411000.0\n      bytes: 7030607346\n      end: 60.0002\n      retransmits: 741\n      seconds: 60.0002\n      socket: 16\n      start: 0\n  - receiver:\n      bits_per_second: 748185000.0\n      bytes: 5611407204\n      end: 60.0002\n      seconds: 60.0002\n      socket: 18\n      start: 0\n    sender:\n      bits_per_second: 748500000.0\n      bytes: 5613773280\n      end: 60.0002\n      retransmits: 657\n      seconds: 60.0002\n      socket: 18\n      start: 0\n  - receiver:\n      bits_per_second: 885862000.0\n      bytes: 6643987166\n      end: 60.0002\n      seconds: 60.0002\n      socket: 20\n      start: 0\n    sender:\n      bits_per_second: 886194000.0\n      bytes: 6646481344\n      end: 60.0002\n      retransmits: 839\n      seconds: 60.0002\n      socket: 20\n      start: 0\n  - receiver:\n      bits_per_second: 919628000.0\n      bytes: 6897238452\n      end: 60.0002\n      seconds: 60.0002\n      socket: 22\n      start: 0\n    sender:\n      bits_per_second: 919988000.0\n      bytes: 6899936852\n      end: 60.0002\n      retransmits: 672\n      seconds: 60.0002\n      socket: 22\n      start: 0\n  sum_received:\n    bits_per_second: 8783520000.0\n    bytes: 65876684822\n    end: 60.0002\n    seconds: 60.0002\n    start: 0\n  sum_sent:\n    bits_per_second: 8786540000.0\n    bytes: 65899309212\n    end: 60.0002\n    retransmits: 7151\n    seconds: 60.0002\n    start: 0\nstart:\n  connected:\n  - local_host: 10.1.0.5\n    local_port: 57732\n    remote_host: 10.2.0.4\n    remote_port: 5201\n    socket: 4\n  - local_host: 10.1.0.5\n    local_port: 57733\n    remote_host: 10.2.0.4\n    remote_port: 5201\n    socket: 6\n  - local_host: 10.1.0.5\n    local_port: 57734\n    remote_host: 10.2.0.4\n    remote_port: 5201\n    socket: 8\n  - local_host: 10.1.0.5\n    local_port: 57735\n    remote_host: 10.2.0.4\n    remote_port: 5201\n    socket: 10\n  - local_host: 10.1.0.5\n    local_port: 57736\n    remote_host: 10.2.0.4\n    remote_port: 5201\n    socket: 12\n  - local_host: 10.1.0.5\n    local_port: 57737\n    remote_host: 10.2.0.4\n    remote_port: 5201\n    socket: 14\n  - local_host: 10.1.0.5\n    local_port: 57738\n    remote_host: 10.2.0.4\n    remote_port: 5201\n    socket: 16\n  - local_host: 10.1.0.5\n    local_port: 57739\n    remote_host: 10.2.0.4\n    remote_port: 5201\n    socket: 18\n  - local_host: 10.1.0.5\n    local_port: 57740\n    remote_host: 10.2.0.4\n    remote_port: 5201\n    socket: 20\n  - local_host: 10.1.0.5\n    local_port: 57741\n    remote_host: 10.2.0.4\n    remote_port: 5201\n    socket: 22\n  connecting_to:\n    host: 10.2.0.4\n    port: 5201\n  cookie: shaker-kdzroa-master-0.1471349940.11\n  system_info: 'Linux shaker-kdzroa-master-0 3.13.0-93-generic #140-Ubuntu SMP Mon\n    Jul 18 21:21:05 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\n\n    '\n  tcp_mss_default: 8898\n  test_start:\n    blksize: 64000\n    blocks: 0\n    bytes: 0\n    duration: 60\n    num_streams: 10\n    omit: 0\n    protocol: TCP\n    reverse: 0\n  timestamp:\n    time: Tue, 16 Aug 2016 12:19:00 GMT\n    timesecs: 1471349940\n  version: iperf 3.0.7\n", "scenario": "OpenStack L3 East-West", "concurrency": 1, "schedule": 1471349940.100621, "agent": "shaker_kdzroa_master_0", "id": "bb8f2d6e-4fe0-49fb-b3dd-2f0fe268bb91", "start": 1471349940.11182, "meta": [["time", "s"], ["bandwidth", "Mbit/s"], ["retransmits", ""]], "command": {"data": "iperf3 --client 10.2.0.4 --format m --len 64000 --time 60 --parallel 10 --interval 1 --json", "type": "program"}, "samples": [[1.0, 9127.874374389648, 152], [2.0, 9469.25163269043, 160], [3.0, 8643.817901611328, 75], [4.0, 8516.607284545898, 54], [5.0, 8825.082778930664, 116], [6.0, 8495.893478393555, 43], [7.0, 8944.644927978516, 67], [8.0, 8609.352111816406, 58], [9.0, 8901.090621948242, 52], [10.0, 8989.524841308594, 130], [11.0, 8374.061584472656, 73], [12.0, 8701.047897338867, 50], [13.0, 8852.567672729492, 63], [14.0, 9168.252944946289, 92], [15.0, 8898.143768310547, 68], [16.0, 8852.577209472656, 66], [17.0, 8349.609375, 57], [18.0, 8811.90299987793, 47], [19.0, 9010.26725769043, 72], [20.0, 9159.088134765625, 55], [21.0, 8931.827545166016, 99], [22.0, 8525.428771972656, 71], [23.0, 8730.325698852539, 51], [24.0, 9106.569290161133, 90], [25.0, 9243.135452270508, 88], [26.0, 9335.851669311523, 70], [27.0, 8686.628341674805, 61], [28.0, 8710.527420043945, 69], [29.0, 8676.80549621582, 45], [30.0, 8637.857437133789, 90], [31.0, 8105.764389038086, 39], [32.0, 8007.841110229492, 213], [33.0, 8412.752151489258, 115], [34.0, 8237.485885620117, 116], [35.0, 8147.821426391602, 80], [36.0, 7828.693389892578, 147], [37.0, 8022.451400756836, 114], [38.0, 7978.382110595703, 70], [39.0, 8252.096176147461, 150], [40.0, 7573.223114013672, 462], [41.0, 7534.170150756836, 310], [42.0, 7890.644073486328, 40], [43.0, 7957.3822021484375, 188], [44.0, 7853.584289550781, 77], [45.0, 8045.902252197266, 164], [46.0, 7947.978973388672, 78], [47.0, 7897.672653198242, 94], [48.0, 8089.504241943359, 0], [49.0, 7972.822189331055, 333], [50.0, 7696.905136108398, 337], [51.0, 8163.156509399414, 180], [52.0, 7671.298980712891, 157], [53.0, 7245.8648681640625, 11], [54.0, 7689.56184387207, 151], [55.0, 7826.328277587891, 227], [56.0, 8189.9261474609375, 302], [57.0, 7778.415679931641, 119], [58.0, 7822.437286376953, 144], [59.0, 7983.865737915039, 0], [60.0, 7659.931182861328, 449]], "executor": "iperf3", "test": "Download", "type": "agent", "stderr": ""}, "a8fb9d9e-b4d2-42dd-bb0d-4e6d841e224b": {"meta": [["concurrency", ""], ["bandwidth", "Mbit/s"], ["retransmits", ""]], "scenario": "OpenStack L3 East-West", "test": "Upload", "type": "test", "chart": [["concurrency", 1], ["bandwidth", 8934.044996897379], ["retransmits", 75]], "id": "a8fb9d9e-b4d2-42dd-bb0d-4e6d841e224b"}, "c885d0ba-43c8-4a6c-ae14-a22749d5e665": {"status": "ok", "node": "node-2.domain.tld", "finish": 1471350080.834249, "stats": {"bandwidth": {"max": 9780.120849609375, "avg": 8934.044996897379, "unit": "Mbit/s", "min": 8036.909103393555}, "retransmits": {"max": 212, "avg": 75, "unit": "", "min": 23}}, "verbose": "end:\n  cpu_utilization_percent:\n    host_system: 19.3558\n    host_total: 19.7445\n    host_user: 0.388626\n    remote_system: 49.4979\n    remote_total: 50.2208\n    remote_user: 0.722901\n  streams:\n  - receiver:\n      bits_per_second: 1090170000.0\n      bytes: 8176265074\n      end: 60.0001\n      seconds: 60.0001\n      socket: 4\n      start: 0\n    sender:\n      bits_per_second: 1090510000.0\n      bytes: 8178869092\n      end: 60.0001\n      retransmits: 638\n      seconds: 60.0001\n      socket: 4\n      start: 0\n  - receiver:\n      bits_per_second: 946511000.0\n      bytes: 7098841234\n      end: 60.0001\n      seconds: 60.0001\n      socket: 6\n      start: 0\n    sender:\n      bits_per_second: 946728000.0\n      bytes: 7100469076\n      end: 60.0001\n      retransmits: 410\n      seconds: 60.0001\n      socket: 6\n      start: 0\n  - receiver:\n      bits_per_second: 946063000.0\n      bytes: 7095480666\n      end: 60.0001\n      seconds: 60.0001\n      socket: 8\n      start: 0\n    sender:\n      bits_per_second: 946285000.0\n      bytes: 7097144520\n      end: 60.0001\n      retransmits: 445\n      seconds: 60.0001\n      socket: 8\n      start: 0\n  - receiver:\n      bits_per_second: 912881000.0\n      bytes: 6846618658\n      end: 60.0001\n      seconds: 60.0001\n      socket: 10\n      start: 0\n    sender:\n      bits_per_second: 913240000.0\n      bytes: 6849308208\n      end: 60.0001\n      retransmits: 497\n      seconds: 60.0001\n      socket: 10\n      start: 0\n  - receiver:\n      bits_per_second: 938482000.0\n      bytes: 7038622928\n      end: 60.0001\n      seconds: 60.0001\n      socket: 12\n      start: 0\n    sender:\n      bits_per_second: 938828000.0\n      bytes: 7041221768\n      end: 60.0001\n      retransmits: 488\n      seconds: 60.0001\n      socket: 12\n      start: 0\n  - receiver:\n      bits_per_second: 897307000.0\n      bytes: 6729808978\n      end: 60.0001\n      seconds: 60.0001\n      socket: 14\n      start: 0\n    sender:\n      bits_per_second: 897620000.0\n      bytes: 6732159496\n      end: 60.0001\n      retransmits: 395\n      seconds: 60.0001\n      socket: 14\n      start: 0\n  - receiver:\n      bits_per_second: 913283000.0\n      bytes: 6849635184\n      end: 60.0001\n      seconds: 60.0001\n      socket: 16\n      start: 0\n    sender:\n      bits_per_second: 913563000.0\n      bytes: 6851731542\n      end: 60.0001\n      retransmits: 516\n      seconds: 60.0001\n      socket: 16\n      start: 0\n  - receiver:\n      bits_per_second: 853689000.0\n      bytes: 6402676938\n      end: 60.0001\n      seconds: 60.0001\n      socket: 18\n      start: 0\n    sender:\n      bits_per_second: 853942000.0\n      bytes: 6404575002\n      end: 60.0001\n      retransmits: 397\n      seconds: 60.0001\n      socket: 18\n      start: 0\n  - receiver:\n      bits_per_second: 994326000.0\n      bytes: 7457454934\n      end: 60.0001\n      seconds: 60.0001\n      socket: 20\n      start: 0\n    sender:\n      bits_per_second: 994648000.0\n      bytes: 7459868528\n      end: 60.0001\n      retransmits: 384\n      seconds: 60.0001\n      socket: 20\n      start: 0\n  - receiver:\n      bits_per_second: 872376000.0\n      bytes: 6542827870\n      end: 60.0001\n      seconds: 60.0001\n      socket: 22\n      start: 0\n    sender:\n      bits_per_second: 872653000.0\n      bytes: 6544906570\n      end: 60.0001\n      retransmits: 375\n      seconds: 60.0001\n      socket: 22\n      start: 0\n  sum_received:\n    bits_per_second: 9365090000.0\n    bytes: 70238232464\n    end: 60.0001\n    seconds: 60.0001\n    start: 0\n  sum_sent:\n    bits_per_second: 9368020000.0\n    bytes: 70260253802\n    end: 60.0001\n    retransmits: 4545\n    seconds: 60.0001\n    start: 0\nstart:\n  connected:\n  - local_host: 10.1.0.5\n    local_port: 57743\n    remote_host: 10.2.0.4\n    remote_port: 5201\n    socket: 4\n  - local_host: 10.1.0.5\n    local_port: 57744\n    remote_host: 10.2.0.4\n    remote_port: 5201\n    socket: 6\n  - local_host: 10.1.0.5\n    local_port: 57745\n    remote_host: 10.2.0.4\n    remote_port: 5201\n    socket: 8\n  - local_host: 10.1.0.5\n    local_port: 57746\n    remote_host: 10.2.0.4\n    remote_port: 5201\n    socket: 10\n  - local_host: 10.1.0.5\n    local_port: 57747\n    remote_host: 10.2.0.4\n    remote_port: 5201\n    socket: 12\n  - local_host: 10.1.0.5\n    local_port: 57748\n    remote_host: 10.2.0.4\n    remote_port: 5201\n    socket: 14\n  - local_host: 10.1.0.5\n    local_port: 57749\n    remote_host: 10.2.0.4\n    remote_port: 5201\n    socket: 16\n  - local_host: 10.1.0.5\n    local_port: 57750\n    remote_host: 10.2.0.4\n    remote_port: 5201\n    socket: 18\n  - local_host: 10.1.0.5\n    local_port: 57751\n    remote_host: 10.2.0.4\n    remote_port: 5201\n    socket: 20\n  - local_host: 10.1.0.5\n    local_port: 57752\n    remote_host: 10.2.0.4\n    remote_port: 5201\n    socket: 22\n  connecting_to:\n    host: 10.2.0.4\n    port: 5201\n  cookie: shaker-kdzroa-master-0.1471350020.65\n  system_info: 'Linux shaker-kdzroa-master-0 3.13.0-93-generic #140-Ubuntu SMP Mon\n    Jul 18 21:21:05 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\n\n    '\n  tcp_mss_default: 8898\n  test_start:\n    blksize: 64000\n    blocks: 0\n    bytes: 0\n    duration: 60\n    num_streams: 10\n    omit: 0\n    protocol: TCP\n    reverse: 0\n  timestamp:\n    time: Tue, 16 Aug 2016 12:20:20 GMT\n    timesecs: 1471350020\n  version: iperf 3.0.7\n", "scenario": "OpenStack L3 East-West", "concurrency": 1, "schedule": 1471350020.646118, "agent": "shaker_kdzroa_master_0", "id": "c885d0ba-43c8-4a6c-ae14-a22749d5e665", "start": 1471350020.656598, "meta": [["time", "s"], ["bandwidth", "Mbit/s"], ["retransmits", ""]], "command": {"data": "iperf3 --client 10.2.0.4 --format m --len 64000 --time 60 --parallel 10 --interval 1 --json", "type": "program"}, "samples": [[1.0, 8606.624603271484, 65], [2.0, 9099.712371826172, 94], [3.0, 9536.933898925781, 29], [4.0, 8724.62272644043, 104], [5.0, 8896.589279174805, 58], [6.0, 8736.724853515625, 81], [7.0, 8451.967239379883, 81], [8.0, 8906.440734863281, 52], [9.0, 8251.791000366211, 84], [10.0, 8613.367080688477, 23], [11.0, 8666.753768920898, 124], [12.0, 8036.909103393555, 138], [13.0, 8569.793701171875, 34], [14.0, 8691.349029541016, 77], [15.0, 9282.369613647461, 35], [16.0, 8964.624404907227, 117], [17.0, 8979.692459106445, 52], [18.0, 8593.616485595703, 67], [19.0, 9126.014709472656, 122], [20.0, 8379.00161743164, 69], [21.0, 8825.416564941406, 80], [22.0, 9641.647338867188, 46], [23.0, 9501.686096191406, 72], [24.0, 9004.106521606445, 56], [25.0, 9096.72737121582, 46], [26.0, 9482.402801513672, 70], [27.0, 9467.7734375, 68], [28.0, 9286.947250366211, 64], [29.0, 9042.587280273438, 52], [30.0, 9097.232818603516, 50], [31.0, 9394.292831420898, 53], [32.0, 9057.693481445312, 69], [33.0, 9243.545532226562, 50], [34.0, 9325.91438293457, 59], [35.0, 9482.402801513672, 123], [36.0, 9067.411422729492, 76], [37.0, 8818.368911743164, 59], [38.0, 8940.439224243164, 58], [39.0, 8588.647842407227, 81], [40.0, 8325.29067993164, 69], [41.0, 8964.958190917969, 58], [42.0, 8217.754364013672, 36], [43.0, 9062.528610229492, 212], [44.0, 8700.847625732422, 91], [45.0, 9121.389389038086, 108], [46.0, 8891.363143920898, 58], [47.0, 8696.537017822266, 47], [48.0, 8701.457977294922, 72], [49.0, 9404.001235961914, 83], [50.0, 9208.993911743164, 57], [51.0, 9233.35075378418, 208], [52.0, 8812.589645385742, 101], [53.0, 9127.340316772461, 48], [54.0, 8325.052261352539, 93], [55.0, 9154.977798461914, 50], [56.0, 8895.77865600586, 195], [57.0, 8540.74478149414, 65], [58.0, 8442.373275756836, 72], [59.0, 8955.106735229492, 40], [60.0, 9780.120849609375, 44]], "executor": "iperf3", "test": "Upload", "type": "agent", "stderr": ""}, "41858c05-f980-4dbd-86ba-97e12a11091d": {"stats": {"bandwidth": {"max": 9469.25163269043, "avg": 8379.491329193115, "unit": "Mbit/s", "min": 7245.8648681640625}, "retransmits": {"max": 462, "avg": 119, "unit": "", "min": 0}}, "scenario": "OpenStack L3 East-West", "concurrency": 1, "test": "Download", "type": "concurrency", "id": "41858c05-f980-4dbd-86ba-97e12a11091d", "node_chart": [["x", "node-2.domain.tld"], ["Avg bandwidth, Mbit/s", 8379.491329193115], ["Max bandwidth, Mbit/s", 9469.25163269043], ["Min bandwidth, Mbit/s", 7245.8648681640625], ["Avg retransmits, ", 119], ["Max retransmits, ", 462], ["Min retransmits, ", 0]]}}, "tests": {"Download": {"title": "Download", "interval": 1, "method": "tcp_download", "threads": 10, "buffer_size": 64000, "class": "iperf3"}, "Upload": {"title": "Upload", "interval": 1, "method": "tcp_upload", "threads": 10, "buffer_size": 64000, "class": "iperf3"}}, "agents": {"shaker_kdzroa_master_0": {"node": "node-2.domain.tld", "slave": {"node": "node-5.domain.tld", "zone": "nova", "availability_zone": "nova:node-5.domain.tld", "ip": "10.2.0.4", "mode": "slave", "master_id": "shaker_kdzroa_master_0", "id": "shaker_kdzroa_slave_0"}, "zone": "nova", "availability_zone": "nova:node-2.domain.tld", "ip": "10.1.0.5", "mode": "master", "slave_id": "shaker_kdzroa_slave_0", "id": "shaker_kdzroa_master_0"}, "shaker_kdzroa_slave_0": {"node": "node-5.domain.tld", "zone": "nova", "availability_zone": "nova:node-5.domain.tld", "ip": "10.2.0.4", "master": {"node": "node-2.domain.tld", "zone": "nova", "availability_zone": "nova:node-2.domain.tld", "ip": "10.1.0.5", "mode": "master", "slave_id": "shaker_kdzroa_slave_0", "id": "shaker_kdzroa_master_0"}, "mode": "slave", "master_id": "shaker_kdzroa_master_0", "id": "shaker_kdzroa_slave_0"}}, "sla": []};
  </script>

  <script type="text/javascript">
    "use strict";

    $(function () {

      var fields = ["scenario", "test", "concurrency", "node", "agent"];
      var state = {
        scenario: "",
        test: "",
        concurrency: "",
        node: "",
        agent: ""
      };
      var tablePageSize = 10;

      // compiled templates
      var scenario_source_template = Handlebars.compile($("#scenario_source_template").html());
      var test_specification_template = Handlebars.compile($("#test_specification_template").html());
      var agents_table_template = Handlebars.compile($("#agents_table_template").html());
      var records_table_template = Handlebars.compile($("#records_table_template").html());
      var executor_template = Handlebars.compile($("#executor_template").html());
      var concurrency_summary_template = Handlebars.compile($("#concurrency_summary_template").html());
      var test_summary_template = Handlebars.compile($("#test_summary_template").html());
      var sla_table_template = Handlebars.compile($("#sla_table_template").html());
      var errors_template = Handlebars.compile($("#errors_template").html());

      function concatenate(strings) {
        // returns strings concatenated via comma (like join() but omits empty strings)
        var f = false;
        var result = "";
        $.each(strings, function (_i, string) {
          if (string.length > 0) {
            if (f) result += ", ";
            result += string;
            f = true;
          }
        });
        return result;
      }

      function initSingleSelector(name, values) {
        var selectorId = "#" + name + "_selector";

        var selector_inst = $(selectorId);
        selector_inst.empty();
        selector_inst.append($("<option>", {
          style: "font-style: italic; text-decoration: underline;",
          value: "",
          text: selector_inst.data('placeholder')
        }));

        $.each(values, function (key, item) {
          selector_inst.append($('<option>', {
            value: item, //(key + 1),
            text: item
          }));
        });

        selector_inst.val(state[name]);

        selector_inst.
            on("change", function (e) {
              state[name] = this.value;

              // convert state -> url
              var tokens = [];
              $.each(fields.sort(), function (i, field) {
                if (state[field] != "") {
                  tokens.push(field + "=" + state[field]);
                }
              });
              window.location.href = "#" + tokens.join(":");
            });
      }

      function getFieldValues(field, records) {
        var values_set = {};

        $.each(records, function (j, record) {
          if (record[field]) {
            values_set["" + record[field]] = true;
          }
        });

        return $.map(values_set, function (_i, value) {
          return value;
        }).sort();
      }

      function updateSelectors() {
        $.each(fields, function (i, field) {
          var values = getFieldValues(field, filterRecords(report.records, null, field));
          console.log(values);
          initSingleSelector(field, values);
        });
      }

      function filterRecords(records, type, except_field) {
        var res = [];
        $.each(records, function(_i, record){
          if (!type || typeof type === 'undefined' || record.type == type) {
            var flag = true;
            $.each(state, function (key, value) {
              if (key != except_field && value) {
                flag &= record[key] == value;
              }
            });
            if (flag) {
              res.push(record);
            }
          }
        });
        return res;
      }

      function getAgentsByIds(agent_ids) {
        var agents = [];
        $.each(agent_ids, function(agent_id){
          agents.push(report.agents[agent_id]);
        });
        return agents;
      }

      /* Template Rendering Funcs */

      function showScenarioSource(contentArea, scenario) {
        contentArea.append(scenario_source_template(
            {data: jsyaml.safeDump(scenario)}));
      }

      function showTestSpecification(contentArea, test) {
        contentArea.append(test_specification_template(
            {data: jsyaml.safeDump(test)}
        ))
      }

      function showAgentRecord(contentArea, record) {
        var chart_id = "chart_" + Math.round(Math.random() * 10000);
        var ext_options = {
          command_yaml: jsyaml.safeDump(record["command"]),
          chart_id: chart_id};
        if (record["stats"]) {
          ext_options["stats_yaml"] = jsyaml.safeDump(record["stats"]);
        }
        if ((record["start"]) && (record["finish"])) {
          ext_options["time_info"] = jsyaml.safeDump({
            "start": new Date(record["start"] * 1000).toISOString(),
            "finish": new Date(record["finish"] * 1000).toISOString()
          });
        }
        contentArea.append(executor_template(
            {record: $.extend({}, record, ext_options)}
        ));
        if (record["samples"]) {
          var meta = record["meta"];
          var axes = [];
          axes[meta[1][0]] = 'y';
          var axis = {
            x: {label: concatenate(meta[0])},
            y: {label: concatenate(meta[1]), min: 0}
          };
          if (meta.length > 2) {
            axes[meta[2][0]] = 'y2';
            axis['y2'] = {label: concatenate(meta[2]), min: 0, show: true}
          }

          var chart = [];
          $.each(meta, function(_i, meta_item){  // row titles
            chart.push([meta_item[0]]);
          });
          var samples = record["samples"];
          for (var i=0; i < samples.length; i++) {
            var point = samples[i];
            for (var j=0; j < point.length; j++) {
              chart[j].push(point[j]);
            }
          }

          c3.generate({
            bindto: "#" + chart_id,
            data: {
              x: 'time',
              columns: chart,
              axes: axes
            },
            axis: axis
          });
        }
      }

      function showConcurrencySummary(contentArea, record) {
        var chart_id = "chart_" + Math.round(Math.random() * 10000);
        var node_chart_id = "node_chart_" + Math.round(Math.random() * 10000);
        var ext_options = { chart_id: chart_id, node_chart_id: node_chart_id };
        if (record["stats"]) {
          ext_options["stats_yaml"] = jsyaml.safeDump(record["stats"]);
        }
        console.log(record);
        contentArea.append(concurrency_summary_template(
            {record: $.extend({}, record, ext_options)}
        ));
        if (record["node_chart"]) {
          c3.generate({
            bindto: "#" + node_chart_id,
            data: {
              x: 'x',
              columns: record["node_chart"],
              type: 'step',
              order: null
            },
            axis: {
              x: { type: 'category' }
            }
          });
        }
      }

      function showTestSummary(contentArea, record) {
        console.log(record);
        var chart_id = "chart_" + Math.round(Math.random() * 10000);
        var ext_options = { chart_id: chart_id };
        if (record["stats"]) {
          ext_options["stats_yaml"] = jsyaml.safeDump(record["stats"]);
        }
        contentArea.append(test_summary_template(
            {record: $.extend({}, record, ext_options)}
        ));
        if (record["chart"]) {
          var meta = record["meta"];
          var axes = [];
          axes[meta[1][0]] = 'y';
          var axis = {
            x: {label: concatenate(meta[0])},
            y: {label: concatenate(meta[1]), min: 0}
          };
          if (meta.length > 2) {
            axes[meta[2][0]] = 'y2';
            axis['y2'] = {label: concatenate(meta[2]), min: 0, show: true}
          }

          c3.generate({
            bindto: "#" + chart_id,
            data: {
              x: 'concurrency',
              columns: record["chart"],
              axes: axes
            },
            axis: axis
          });
        }
      }

      function showAgentsTable(contentArea, filteredRecords) {
        var agent_ids = {};
        $.each(filteredRecords, function(_i, record){
          if (record.agent) {
            agent_ids[record.agent] = true;
          }
        });

        var agents = getAgentsByIds(agent_ids);
        if (agents.length == 0) return;

        // add slave agents
        var slave_agent_ids = {};
        $.each(agents, function(_i, agent){
          if (agent.slave_id) {
            slave_agent_ids[agent.slave_id] = true;
          }
        });
        agents = $.merge(agents, getAgentsByIds(slave_agent_ids));

        contentArea.append(agents_table_template({
          agents: agents,
          table_id: "agents_table"
        }));
        $("#agents_table").dataTable({
          "autoWidth": true,
          "paging": false,
          "ordering": true,
          "info": false
        });
      }

      function makeURL(record, s) {
        var extra = {};
        extra[s] = record[s];
        return "#" + $.map($.extend({}, state, extra), function (val, index) {
          return val? (index + "=" + val) : null;
        }).join(":")
      }

      function showRecordsTable(contentArea, filteredRecords) {
        $.each(filteredRecords, function(_i, record) {
          $.each(fields, function(_j, field){
            if (record[field]) {
              record[field + "_url"] = makeURL(record, field);
            }
          });
        });

        contentArea.append(records_table_template({
          records: filteredRecords,
          table_id: "records_table"
        }));
        $("#records_table").dataTable({
          autoWidth: true,
          paging: filteredRecords.length > tablePageSize,
          ordering: true,
          info: false,
          searching: filteredRecords.length > tablePageSize
        });
      }

      function showSlaTable(contentArea, records) {
        if (records.length == 0) return;

        contentArea.append(sla_table_template({
          records: records,
          table_id: "sla_table"
        }));
        $("#records_table").dataTable({
          autoWidth: true,
          paging: records.length > tablePageSize,
          ordering: true,
          info: false,
          searching: records.length > tablePageSize
        });
      }

      function showErrors(contentArea, records) {
        if (records.length == 0) return;

        contentArea.append(errors_template({
          records: records,
          table_id: "errors_list"
        }));
      }

      /* Update cycle */

      function update() {
        var filteredRecords = filterRecords(report.records);
        console.log(filteredRecords);
        var slaRecords = [];
        var errorRecords = [];
        $.each(filterRecords(report.records), function(_i, record) {
          if (record["sla_info"]) {
            slaRecords.push(record);
          }
          if (record["is_status_error"]) {
            errorRecords.push(record);
          }
        });

        var contentArea = $("#content_area");
        contentArea.empty();

        updateSelectors();

        showRecordsTable(contentArea, filteredRecords);
        showSlaTable(contentArea, slaRecords);
        showErrors(contentArea, errorRecords);

        if (state["scenario"] != "" && state["test"] != "" &&
                state["concurrency"] != "" &&
                state["agent"] != "") {
          showAgentRecord(contentArea, filteredRecords[0]);
        }
        if (state["scenario"] != "" && state["test"] != "" &&
                state["concurrency"] != "" && state["node"] == "" &&
                state["agent"] == "") {
          var agg_recs = filterRecords(report.records, "concurrency");
          if (agg_recs.length > 0) {
            showConcurrencySummary(contentArea, agg_recs[0]);
          }
        }
        if (state["scenario"] != "" && state["test"] != "" &&
                state["concurrency"] == "" && state["node"] == "" &&
                state["agent"] == "") {
          var test_recs = filterRecords(report.records, "test");
          if (test_recs.length > 0) {
            showTestSummary(contentArea, test_recs[0]);
          }
        }
        if (state["test"] != "") {
          showTestSpecification(contentArea, report.tests[state["test"]]);
        }
        if (state["agent"] == "") {
          showAgentsTable(contentArea, filteredRecords);
        }
        if (state["scenario"] != "") {
          showScenarioSource(contentArea, report.scenarios[state["scenario"]]);
        }
      }

      function parseUrlToState() {
        var hashUrl = window.location.hash.substr(1);

        $.each(hashUrl.split(":"), function (_i, pair) {
          var kv = pair.split("=");
          if (kv.length == 2) {
            state[kv[0]] = decodeURIComponent(kv[1]);
          }
        });
      }

      // entry-point
      parseUrlToState();
      console.log(state);

      // pre-process records
      $.each(report.records, function(_i, record) {
        if (record.status) {
          record["is_status_ok"] = record.status == "ok";
          record["is_status_lost"] = record.status == "lost";
          record["is_status_interrupted"] = record.status == "interrupted";
          record["is_status_error"] = record.status == "error";
        }
      });

      // auto-select filters with 1 option
      $.each(fields, function(_i, field) {
        var values = getFieldValues(field, report.records);
        if (values.length == 1) {
          state[field] = values[0];
        }
      });

      update();

      $(window).on('hashchange', function() {
        parseUrlToState();
        update()
      });

      $('[data-toggle="tooltip"]').tooltip();
    });
  </script>

  <style type="text/css">
  </style>

</head>

<body>

<div class="container" id="container">
  <div class="row text-center">
    <h1>Shaker | The Report</h1>
  </div>
  <hr>
  <div class="row">
    <div class="col-md-2">
      <label for="scenario_selector" title="Scenario name">Scenario</label>
      <select id="scenario_selector" class="form-control" data-placeholder="- Any scenario -"></select>
    </div>
    <div class="col-md-2">
      <label for="test_selector" title="Test name">Test Case</label>
      <select id="test_selector" class="form-control" data-placeholder="- Any test case -"></select>
    </div>
    <div class="col-md-2">
      <label for="concurrency_selector" title="Concurrency">Concurrency</label>
      <select id="concurrency_selector" class="form-control" data-placeholder="- Any concurrency -"></select>
    </div>
    <div class="col-md-2">
      <label for="node_selector" title="Host / Compute node">Host</label>
      <select id="node_selector" class="form-control" data-placeholder="- Any node -"></select>
    </div>
    <div class="col-md-2">
      <label for="agent_selector" title="Agent">Agent</label>
      <select id="agent_selector" class="form-control" data-placeholder="- Any agent -"></select>
    </div>
  </div>

  <div id="content_area" class="row">
    <!-- Container for the screen content -->
  </div>

  <div id="footer" class="row">&nbsp;</div>
</div>

<!-- TEMPLATES --------------------------------------------------------------->

<!-- Scenario File -->
<script id="scenario_source_template" type="text/x-handlebars-template">
  <h3>Scenario</h3>
  <pre>{{ data }}</pre>
</script>

<!-- Test Specification -->
<script id="test_specification_template" type="text/x-handlebars-template">
  <h3>Test Specification</h3>
  <pre>{{ data }}</pre>
</script>

<!-- Executor Result -->
<script id="executor_template" type="text/x-handlebars-template">
  <h3>Execution Summary</h3>
  {{#with record}}
  <div id="{{ chart_id }}"></div>
  {{#if is_status_ok}}<span class="label label-success"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span>success</span>{{/if}}
  {{#if is_status_lost}}<span class="label label-danger"><span class="glyphicon glyphicon-alert" aria-hidden="true"></span>lost</span>{{/if}}
  {{#if is_status_interrupted}}<span class="label label-warning"><span class="glyphicon glyphicon-stop" aria-hidden="true"></span>interrupted</span>{{/if}}
  {{#if is_status_error}}<span class="label label-danger"><span class="glyphicon glyphicon-alert" aria-hidden="true"></span>error</span>{{/if}}
  {{#if stats_yaml}}
    <h4>Stats</h4>
    <pre>{{ stats_yaml }}</pre>
  {{/if}}
  {{#if time_info}}
    <h4>Time Info</h4>
    <pre>{{ time_info }}</pre>
  {{/if}}
  <h4>Command</h4>
  <pre>{{ command_yaml }}</pre>
  {{#if stdout}}
    <h4>Stdout</h4>
    <pre>{{ stdout }}</pre>
  {{/if}}
  {{#if verbose}}
    <h4>Verbose Info</h4>
    <pre>{{ verbose }}</pre>
  {{/if}}
  {{#if stderr}}
    <h4>Stderr</h4>
    <pre>{{ stderr }}</pre>
  {{/if}}
  {{/with}}
</script>

<!-- Concurrency summary -->
<script id="concurrency_summary_template" type="text/x-handlebars-template">
  {{#with record}}
  <div id="{{ chart_id  }}"></div>
  <h3>Per-node chart</h3>
  <div id="{{ node_chart_id  }}"></div>
  <h3>Stats</h3>
  <pre>{{ stats_yaml }}</pre>
  {{/with}}
</script>

<!-- Test summary -->
<script id="test_summary_template" type="text/x-handlebars-template">
  {{#with record}}
  <div id="{{ chart_id   }}"></div>
  {{#if stats_yaml}}
    <h3>Stats</h3>
    <pre>{{ stats_yaml }}</pre>
  {{/if}}
  {{/with}}
</script>

<!-- Records Table -->
<script id="records_table_template" type="text/x-handlebars-template">
  <h3>Records</h3>
  <table class="table table-striped" id="{{ table_id  }}">
    <thead>
    <tr>
      <th>Scenario</th>
      <th>Test Case</th>
      <th>Concurrency</th>
      <th>Host / Compute Node</th>
      <th>Agent</th>
      <th>Status</th>
    </tr>
    </thead>
    <tbody>
    {{#records}}
    <tr>
      <td><a href="{{ scenario_url }}">{{ scenario }}</a></td>
      <td><a href="{{ test_url }}">{{ test }}</a></td>
      <td><a href="{{ concurrency_url }}">{{ concurrency }}</a></td>
      <td><a href="{{ node_url }}">{{ node }}</a></td>
      <td><a href="{{ agent_url }}">{{ agent }}</a></td>
      <td>
        {{#if is_status_ok }}
          <span class="label label-success">
            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
            success
          </span>
        {{/if}}
        {{#if is_status_lost }}
          <span class="label label-danger">
            <span class="glyphicon glyphicon-alert" aria-hidden="true"></span>
            lost
          </span>
        {{/if}}
        {{#if is_status_interrupted }}
          <span class="label label-warning">
            <span class="glyphicon glyphicon-stop" aria-hidden="true"></span>
            interrupted
          </span>
        {{/if}}
        {{#if is_status_error }}
          <span class="label label-danger">
            <span class="glyphicon glyphicon-stop" aria-hidden="true"></span>
            error
          </span>
        {{/if}}
      </td>
    </tr>
    {{/records}}
    </tbody>
  </table>
</script>

<!-- Agents List -->
<script id="agents_table_template" type="text/x-handlebars-template">
  <h3>Agents</h3>
  <table class="table table-striped" id="{{ table_id }}">
    <thead>
    <tr>
      <th>Agent</th>
      <th>Mode</th>
      <th>IP</th>
      <th>Node</th>
      <th>AZ</th>
    </tr>
    </thead>
    <tbody>
    {{#agents}}
    <tr>
      <td>{{ id }}</td>
      <td>{{ mode }}</td>
      <td>{{ ip }}</td>
      <td>{{ node }}</td>
      <td>{{ zone }}</td>
    </tr>
    {{/agents}}
    </tbody>
  </table>
</script>

<!-- SLA List -->
<script id="sla_table_template" type="text/x-handlebars-template">
  <h3>Agents</h3>
  <table class="table table-striped" id="{{  table_id }}">
    <thead>
    <tr>
      <th>Condition</th>
      <th>Location</th>
      <th>Status</th>
    </tr>
    </thead>
    <tbody>
    {{#records}}
    <tr>
      <td>{{ sla }}</td>
      <td>{{ location }}</td>
      <td>
        {{#if is_status_ok }}
          <span class="text-success">
            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
            {{ status }}
          </span>
        {{else}}
          <span class="text-danger">
            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
            {{ status }}
          </span>
        {{/if}}
      </td>
    </tr>
    {{/records}}
    </tbody>
  </table>
</script>

<!-- Errors -->
<script id="errors_template" type="text/x-handlebars-template">
  <h3>Errors</h3>
  <div class="text-danger">
    <ul>
    {{#records}}
      <li>{{ info }}<br/>{{ stderr }}{{ traceback }}</li>
    {{/records}}
    </ul>
  </div>
</script>

</body>
</html>