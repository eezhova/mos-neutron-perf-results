<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head profile="http://gmpg.org/xfn/11">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>

  <title>Shaker | The distributed data-plane testing tool for OpenStack</title>

  <!-- LIBS -->

  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.4/js/bootstrap.js"></script>
  <script type="text/javascript"
          src="https://cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/3.0.1/handlebars.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/3.2.7/js-yaml.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.js"></script>

  <!-- STYLES -->

  <link rel="stylesheet"
        href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.4/simplex/bootstrap.min.css">
  <link rel=stylesheet type=text/css
        href="https://cdn.datatables.net/1.10.2/css/jquery.dataTables.min.css">
  <link rel=stylesheet type=text/css
        href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.css">
  <link rel='stylesheet' type='text/css'
        href='http://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic&subset=latin,cyrillic'>

  <script type="application/javascript">
    var report = {"scenarios": {"OpenStack L2": {"file_name": "shaker/shaker/scenarios/openstack/full_l2.yaml", "title": "OpenStack L2", "execution": {"tests": [{"title": "Download", "method": "tcp_download", "class": "flent"}, {"title": "Upload", "method": "tcp_upload", "class": "flent"}, {"title": "Bi-directional", "method": "tcp_bidirectional", "class": "flent"}], "progression": "quadratic"}, "description": "In this scenario Shaker launches pairs of instances in the same tenant network. Every instance is hosted on a separate compute node, all available compute nodes are utilized. The traffic goes within the tenant network (L2 domain).", "deployment": {"accommodation": ["pair", "single_room"], "template": "l2.hot"}}}, "records": {"6a9e66a7-5167-40e6-86d7-11aa2a298870": {"meta": [["concurrency", ""], ["ping_icmp", "ms"], ["tcp_download", "Mbits/s"], ["tcp_upload", "Mbits/s"]], "scenario": "OpenStack L2", "test": "Bi-directional", "type": "test", "chart": [["concurrency", 1], ["ping_icmp", 2.6919296755790825], ["tcp_download", 4244.3446550834915], ["tcp_upload", 4172.959787324155]], "id": "6a9e66a7-5167-40e6-86d7-11aa2a298870"}, "e2214ed6-6056-4e1f-bfbc-1a3040a08555": {"stats": {"ping_icmp": {"max": 4.721678343761847, "avg": 2.6919296755790825, "unit": "ms", "min": 0.37902597248228675}, "tcp_download": {"max": 4643.94538351059, "avg": 4244.3446550834915, "unit": "Mbits/s", "min": 2646.63}, "tcp_upload": {"max": 4900.47, "avg": 4172.959787324155, "unit": "Mbits/s", "min": 3470.0246925695888}}, "scenario": "OpenStack L2", "concurrency": 1, "test": "Bi-directional", "type": "concurrency", "id": "e2214ed6-6056-4e1f-bfbc-1a3040a08555", "node_chart": [["x", "node-2.domain.tld"], ["Avg ping_icmp, ms", 2.6919296755790825], ["Max ping_icmp, ms", 4.721678343761847], ["Min ping_icmp, ms", 0.37902597248228675], ["Avg tcp_download, Mbits/s", 4244.3446550834915], ["Max tcp_download, Mbits/s", 4643.94538351059], ["Min tcp_download, Mbits/s", 2646.63], ["Avg tcp_upload, Mbits/s", 4172.959787324155], ["Max tcp_upload, Mbits/s", 4900.47], ["Min tcp_upload, Mbits/s", 3470.0246925695888]]}, "e0910991-e511-4aa6-bbf9-6ab5106f8f73": {"meta": [["concurrency", ""], ["ping_icmp", "ms"], ["tcp_download", "Mbits/s"]], "scenario": "OpenStack L2", "test": "Download", "type": "test", "chart": [["concurrency", 1], ["ping_icmp", 1.8637709689234798], ["tcp_download", 7000.644505134189]], "id": "e0910991-e511-4aa6-bbf9-6ab5106f8f73"}, "81624e4e-85ca-4778-bf30-2981be006e19": {"stats": {"ping_icmp": {"max": 2.724750431707135, "avg": 1.8637709689234798, "unit": "ms", "min": 0.24901984551648396}, "tcp_download": {"max": 8397.405137360096, "avg": 7000.644505134189, "unit": "Mbits/s", "min": 5748.713209338188}}, "scenario": "OpenStack L2", "concurrency": 1, "test": "Download", "type": "concurrency", "id": "81624e4e-85ca-4778-bf30-2981be006e19", "node_chart": [["x", "node-2.domain.tld"], ["Avg ping_icmp, ms", 1.8637709689234798], ["Max ping_icmp, ms", 2.724750431707135], ["Min ping_icmp, ms", 0.24901984551648396], ["Avg tcp_download, Mbits/s", 7000.644505134189], ["Max tcp_download, Mbits/s", 8397.405137360096], ["Min tcp_download, Mbits/s", 5748.713209338188]]}, "962093f0-6fdf-4de2-a52c-658c778c56ed": {"stats": {"ping_icmp": {"max": 3.8055914979443024, "avg": 2.500997289896429, "unit": "ms", "min": 0.4344454003945638}, "tcp_upload": {"max": 6468.75922553256, "avg": 5883.431513520882, "unit": "Mbits/s", "min": 5525.95047860211}}, "scenario": "OpenStack L2", "concurrency": 1, "test": "Upload", "type": "concurrency", "id": "962093f0-6fdf-4de2-a52c-658c778c56ed", "node_chart": [["x", "node-2.domain.tld"], ["Avg ping_icmp, ms", 2.500997289896429], ["Max ping_icmp, ms", 3.8055914979443024], ["Min ping_icmp, ms", 0.4344454003945638], ["Avg tcp_upload, Mbits/s", 5883.431513520882], ["Max tcp_upload, Mbits/s", 6468.75922553256], ["Min tcp_upload, Mbits/s", 5525.95047860211]]}, "767d1a16-90dc-4238-9dff-e65a5fb21245": {"status": "ok", "node": "node-2.domain.tld", "finish": 1471431149.282346, "stats": {"ping_icmp": {"max": 3.8055914979443024, "avg": 2.500997289896429, "unit": "ms", "min": 0.4344454003945638}, "tcp_upload": {"max": 6468.75922553256, "avg": 5883.431513520882, "unit": "Mbits/s", "min": 5525.95047860211}}, "stderr": "", "scenario": "OpenStack L2", "concurrency": 1, "schedule": 1471431078.873783, "agent": "shaker_spfzte_master_0", "start": 1471431078.883927, "meta": [["time", "s"], ["ping_icmp", "ms"], ["tcp_upload", "Mbits/s"]], "command": {"data": "zcat `flent -H 10.0.0.4 -l 60 -s 1 tcp_upload 2>&1 | grep \"se with\" | grep -Po '\\./\\S+'`", "type": "script"}, "samples": [[0.0, 0.946, null], [1.0, 0.5769053361828108, null], [2.0, 0.5068223754845962, null], [3.0, 0.4344454003945638, null], [4.0, 0.5658557172328152, null], [5.0, 0.5286770700182437, null], [6.0, 2.860232721679145, 5678.97], [7.0, 3.1096846689642654, 5770.674852380752], [8.0, 3.16984958316764, 5759.960892066323], [9.0, 3.050436669575257, 5700.578947642704], [10.0, 3.189312906955009, 5655.891706933975], [11.0, 2.663101280792824, 5557.650247488022], [12.0, 3.453664371176562, 5736.750600459831], [13.0, 3.1031010873271128, 5764.44208097753], [14.0, 2.8920125738825764, 5748.2502435251845], [15.0, 2.623052241248202, 5726.30449442625], [16.0, 2.017259674324412, 5625.23609569788], [17.0, 2.7010804297821167, 5615.057947833261], [18.0, 2.818387103375592, 5555.789972993501], [19.0, 2.977326763910494, 5589.216948116363], [20.0, 2.636106980168298, 5525.95047860211], [21.0, 2.620189425987195, 5601.001516299248], [22.0, 3.4908350938152153, 5597.372247314453], [23.0, 3.3829422903795865, 5567.634310022169], [24.0, 3.106665672836037, 5662.3360316093995], [25.0, 2.758635868368972, 5628.823340148926], [26.0, 3.3921197421701867, 5567.550831187725], [27.0, 2.7295427417295284, 5608.145470609665], [28.0, 2.6517775967882664, 5863.960934550775], [29.0, 3.027625326180674, 5732.587875359236], [30.0, 3.127034335624502, 5731.485281928137], [31.0, 3.8055914979443024, 5600.514760588191], [32.0, 3.1166688083964695, 5537.141561227899], [33.0, 2.9166613423438723, 5882.585801430463], [34.0, 2.958050685438346, 6468.75922553256], [35.0, 3.2000263296559637, 5986.67359143768], [36.0, 2.5671389252589756, 5962.526861364097], [37.0, 2.3675413596934494, 6077.663051278564], [38.0, 3.115152492127282, 6098.312447201356], [39.0, 3.1022651152555953, 5981.431110435618], [40.0, 3.2144078632503055, 5941.744368852861], [41.0, 3.039061562687998, 6041.912153657703], [42.0, 2.9348675331851823, 5985.662196044922], [43.0, 3.0439136713754644, 6043.1969248533815], [44.0, 2.7275391836983616, 6053.7872218707735], [45.0, 2.681598375199298, 6096.257182966385], [46.0, 2.7461404619318515, 6166.349387273789], [47.0, 2.4292669046296127, 6253.514535180311], [48.0, 2.965358260499233, 6182.080034355143], [49.0, 2.8871658352430707, 6181.387458391072], [50.0, 2.607782791923784, 6166.631946611405], [51.0, 2.655586337700394, 6092.707614430776], [52.0, 2.6038842749188302, 6034.36061305019], [53.0, 2.4599416291930214, 6022.995141866213], [54.0, 3.129975913255369, 6038.152760276795], [55.0, 2.4259832383516127, 6049.57053091526], [56.0, 2.992323463281652, 6149.215163120409], [57.0, 2.148592597007098, 6059.127654289701], [58.0, 2.5156974099036105, 6026.445969186901], [59.0, 2.577779985251398, 6010.256285968699], [60.0, 2.9680883281207433, 5982.678391771657], [61.0, 2.778456551211223, 6019.2451740265205], [62.0, 2.5480421882051836, 5983.59184496932], [63.0, 2.5575976338093342, 5976.4311228990555], [64.0, 2.4773477555213934, 5971.440085287094], [65.0, 0.6253177957005152, 6096.338803987494], [66.0, 0.4463719848115713, 6097.01], [67.0, 0.525894997346648, null], [68.0, 0.5716062675405595, null], [69.0, 0.5244398923586158, null]], "executor": "flent", "test": "Upload", "type": "agent", "id": "767d1a16-90dc-4238-9dff-e65a5fb21245"}, "126aa218-701f-4291-a273-cf12779ade0b": {"meta": [["concurrency", ""], ["ping_icmp", "ms"], ["tcp_upload", "Mbits/s"]], "scenario": "OpenStack L2", "test": "Upload", "type": "test", "chart": [["concurrency", 1], ["ping_icmp", 2.500997289896429], ["tcp_upload", 5883.431513520882]], "id": "126aa218-701f-4291-a273-cf12779ade0b"}, "d93baffc-c32c-493b-b64d-448a8d59e07e": {"status": "ok", "node": "node-2.domain.tld", "finish": 1471431239.69618, "stats": {"ping_icmp": {"max": 4.721678343761847, "avg": 2.6919296755790825, "unit": "ms", "min": 0.37902597248228675}, "tcp_download": {"max": 4643.94538351059, "avg": 4244.3446550834915, "unit": "Mbits/s", "min": 2646.63}, "tcp_upload": {"max": 4900.47, "avg": 4172.959787324155, "unit": "Mbits/s", "min": 3470.0246925695888}}, "stderr": "", "scenario": "OpenStack L2", "concurrency": 1, "schedule": 1471431169.290563, "agent": "shaker_spfzte_master_0", "start": 1471431169.300683, "meta": [["time", "s"], ["ping_icmp", "ms"], ["tcp_download", "Mbits/s"], ["tcp_upload", "Mbits/s"]], "command": {"data": "zcat `flent -H 10.0.0.4 -l 60 -s 1 tcp_bidirectional 2>&1 | grep \"se with\" | grep -Po '\\./\\S+'`", "type": "script"}, "samples": [[0.0, 0.983, null, null], [1.0, 0.3982712922252011, null, null], [2.0, 0.472015617804058, null, null], [3.0, 0.5059423100857924, null, null], [4.0, 0.461963145446439, null, null], [5.0, 0.43871295413447703, null, null], [6.0, 3.105823483001328, 2646.63, 4900.47], [7.0, 3.1000271484419653, 4638.917549300194, 4518.186313674664], [8.0, 2.0130429259998652, 4305.540567426681, 4621.810868383677], [9.0, 3.054812649880096, 4395.7233377460225, 4459.549135649246], [10.0, 3.5767769065770576, 4587.786358180046, 4394.427285918815], [11.0, 3.570075150553498, 4056.5487615299226, 3906.929167105473], [12.0, 2.4392004381630796, 4069.3817717814445, 3980.746880976361], [13.0, 3.024432776110873, 3940.4415835639315, 4089.9845999759914], [14.0, 4.097656533551571, 3642.8630598020554, 3598.272797039711], [15.0, 3.279939276595714, 3794.551528174712, 3717.5350942775503], [16.0, 2.4305121914255405, 4145.034074840546, 4064.926302765894], [17.0, 3.4055308583583876, 4557.415502515423, 4533.64878697096], [18.0, 3.4396801085539823, 4409.268903098106, 4419.0678304599105], [19.0, 3.017338254455887, 3885.0322800820677, 3834.941760915032], [20.0, 3.441827161111012, 4363.558966712952, 4481.265823347569], [21.0, 2.09586693200423, 4539.059290723801, 4392.466686606407], [22.0, 1.452112662060288, 4533.186391305923, 4426.499394885981], [23.0, 3.618939598861763, 4374.635185260773, 3989.9342827463634], [24.0, 3.8260166128340662, 4155.86461566925, 3716.9243382767354], [25.0, 3.7910371138892223, 4172.179765224457, 3733.240370186538], [26.0, 3.663591046541656, 4133.186554775238, 3717.535558804795], [27.0, 4.445594290145807, 3913.702536654775, 3811.387402314348], [28.0, 4.721678343761847, 3740.632249741554, 3590.405842155494], [29.0, 3.9080402619532735, 4165.785894704274, 3725.1731682997106], [30.0, 3.368241593552198, 4211.55605923891, 3732.4805630111696], [31.0, 3.118557420684653, 4320.678069831163, 4169.511592543162], [32.0, 2.3390818709103143, 4313.770384061337, 4545.173631278901], [33.0, 3.232727035563215, 4404.259639396668, 4484.241055936813], [34.0, 3.2795981485833527, 4314.380113151074, 4538.285413057209], [35.0, 2.8676820479032874, 4508.306569585123, 4523.757077720165], [36.0, 3.624556794350524, 4359.36403472662, 4308.5601251066455], [37.0, 2.6185120889038833, 4330.725542294979, 4450.759317810535], [38.0, 2.6749123052940966, 4282.497466893196, 3882.3866328447025], [39.0, 3.45051770971366, 4323.301448917816, 3813.1199684934945], [40.0, 2.444250343636388, 4179.794828796387, 3922.0504493178278], [41.0, 2.1336337976853836, 4442.05030916214, 4529.6145593556175], [42.0, 3.3133697284186807, 4245.209099420793, 4084.138126205775], [43.0, 3.984672577519887, 4047.0651403141023, 3569.6186921481058], [44.0, 3.6423796231083223, 3971.2741898298264, 3475.991391783443], [45.0, 3.968568507478596, 3976.6864929676053, 3470.0246925695888], [46.0, 0.8924344727633056, 3943.8738521671294, 3709.4286498576394], [47.0, 3.137009789652798, 4558.775310082436, 4454.841122332751], [48.0, 3.280607162134588, 4643.94538351059, 4476.4587863826755], [49.0, 2.745071483007673, 4577.511855525476, 4450.04377414672], [50.0, 3.4868821048281027, 4193.013100919724, 4073.962788260477], [51.0, 3.4745950751163073, 4328.903724908829, 4413.937413863244], [52.0, 3.488656479536271, 4484.69577665329, 4257.451012084484], [53.0, 2.2965133206711545, 4331.348076343536, 4152.708033359065], [54.0, 2.4054731331851587, 4558.868753018638, 4458.657731552124], [55.0, 2.0574295796282827, 4608.9634131431585, 4482.27453119096], [56.0, 3.059566376961363, 4541.0553133311005, 4324.363013075188], [57.0, 4.203961057958522, 3949.130917961614, 4152.15381963253], [58.0, 3.1430979214196997, 3856.3097963380815, 4182.610228493968], [59.0, 2.245511340490747, 4400.966687470926, 4435.209154970195], [60.0, 2.078402735209801, 4495.936509175301, 4434.3101942527555], [61.0, 1.654720317930829, 4522.514504891988, 4632.96286242841], [62.0, 2.944697595984156, 4420.942976932526, 4570.995652585029], [63.0, 4.399189518623903, 4299.945439931137, 4430.204860892296], [64.0, 3.1813404695106966, 4032.208311543465, 4264.983471264734], [65.0, 0.6598030061443736, 4377.868138842145, 4034.566945227795], [66.0, 0.45059620394092315, 4380.4, 4033.38], [67.0, 0.4712447805234046, null, null], [68.0, 0.37902597248228675, null, null], [69.0, 0.4585277549969484, null, null]], "executor": "flent", "test": "Bi-directional", "type": "agent", "id": "d93baffc-c32c-493b-b64d-448a8d59e07e"}, "458fdbaf-7a46-43c6-9a07-18529ff6d05b": {"status": "ok", "node": "node-2.domain.tld", "finish": 1471431058.86583, "stats": {"ping_icmp": {"max": 2.724750431707135, "avg": 1.8637709689234798, "unit": "ms", "min": 0.24901984551648396}, "tcp_download": {"max": 8397.405137360096, "avg": 7000.644505134189, "unit": "Mbits/s", "min": 5748.713209338188}}, "stderr": "", "scenario": "OpenStack L2", "concurrency": 1, "schedule": 1471430988.421418, "agent": "shaker_spfzte_master_0", "start": 1471430988.431757, "meta": [["time", "s"], ["ping_icmp", "ms"], ["tcp_download", "Mbits/s"]], "command": {"data": "zcat `flent -H 10.0.0.4 -l 60 -s 1 tcp_download 2>&1 | grep \"se with\" | grep -Po '\\./\\S+'`", "type": "script"}, "samples": [[0.0, 1.14, null], [1.0, 0.24901984551648396, null], [2.0, 0.44395691617381594, null], [3.0, 0.444, null], [4.0, 0.4829908693021351, null], [5.0, 0.948299838617854, null], [6.0, 2.0458763508392837, 7111.78], [7.0, 2.388238215727093, 6892.416809959412], [8.0, 0.6612614081072321, 6170.88258266449], [9.0, 2.071009300540774, 7176.2925945663455], [10.0, 2.0204425684622875, 7616.488369781677], [11.0, 1.8512549686526656, 7809.332274260521], [12.0, 2.2263382565981185, 7936.621789031029], [13.0, 2.724750431707135, 6208.426509900093], [14.0, 1.770981196602372, 6329.967684626579], [15.0, 1.809342262923962, 8397.405137360096], [16.0, 1.8296991649207708, 8384.665312600135], [17.0, 2.5765877537179787, 8073.393480992317], [18.0, 1.7851724264435256, 7940.358823544979], [19.0, 1.9854833961825102, 8096.022097485065], [20.0, 2.5962419973127013, 7714.947781661442], [21.0, 1.8965611771008388, 6771.545287704467], [22.0, 2.094546655767284, 6815.120211424828], [23.0, 1.895407300677693, 7482.148845102787], [24.0, 1.9483364103008258, 7952.014665770531], [25.0, 1.7364929484747675, 7971.237358894348], [26.0, 1.8752862836606061, 7911.529287769794], [27.0, 1.841332758722031, 7702.527298002244], [28.0, 1.8689417525097365, 7553.790084233284], [29.0, 1.7833398984673, 7622.055522298812], [30.0, 2.6057938209730445, 7572.060424661636], [31.0, 2.227310702907379, 5748.713209338188], [32.0, 1.9223609341906815, 7398.213916645051], [33.0, 2.01524445732406, 7462.040263375141], [34.0, 1.6375896825595373, 7410.833331439495], [35.0, 1.6868033420522133, 7462.075821678639], [36.0, 1.756675417259539, 7483.061398618221], [37.0, 2.3585627970894336, 7466.608374493122], [38.0, 1.839489015067419, 6095.587041184903], [39.0, 2.4348437232451685, 7016.7374215531345], [40.0, 2.451096170739546, 6069.383142035008], [41.0, 2.534925117116088, 5989.148855290413], [42.0, 2.511737921755409, 5960.2610665035245], [43.0, 2.3594918117757198, 6100.88223269701], [44.0, 2.4908719905502994, 6043.925528118611], [45.0, 2.4343637639232365, 6837.779634985924], [46.0, 2.4768073433982334, 6094.107706656457], [47.0, 2.3865273604408124, 6025.280299413204], [48.0, 2.239983000919841, 6077.850577805042], [49.0, 2.6213529307596954, 6113.222457885545], [50.0, 2.436026264497647, 6158.0097801017755], [51.0, 2.001822617355416, 6632.158129825592], [52.0, 2.498282034190762, 6337.7955974102015], [53.0, 1.9845711590816522, 6800.643288316726], [54.0, 2.39243304666055, 6426.707358751297], [55.0, 2.402345349994655, 6080.436851835251], [56.0, 2.5012316772297742, 6121.808078050613], [57.0, 1.8388272674300323, 6399.738335981368], [58.0, 1.9177636042917898, 6695.056396932601], [59.0, 2.5070584949433843, 6092.453840227127], [60.0, 1.8463096501515441, 6610.830318336487], [61.0, 1.78, 7999.889646730423], [62.0, 1.871134031559878, 7917.693521003723], [63.0, 1.9072817894110647, 7514.02824385643], [64.0, 2.5447702043866816, 7416.2746793305605], [65.0, 0.5872431280431467, 6885.558232481863], [66.0, 0.3990628167823172, 6881.49], [67.0, 0.48541997436738554, null], [68.0, 0.3142322105434352, null], [69.0, 0.2651288456453512, null]], "executor": "flent", "test": "Download", "type": "agent", "id": "458fdbaf-7a46-43c6-9a07-18529ff6d05b"}}, "tests": {"Download": {"class": "flent", "method": "tcp_download", "title": "Download"}, "Bi-directional": {"class": "flent", "method": "tcp_bidirectional", "title": "Bi-directional"}, "Upload": {"class": "flent", "method": "tcp_upload", "title": "Upload"}}, "agents": {"shaker_spfzte_slave_0": {"node": "node-5.domain.tld", "zone": "nova", "availability_zone": "nova:node-5.domain.tld", "ip": "10.0.0.4", "master": {"node": "node-2.domain.tld", "zone": "nova", "availability_zone": "nova:node-2.domain.tld", "ip": "10.0.0.5", "mode": "master", "slave_id": "shaker_spfzte_slave_0", "id": "shaker_spfzte_master_0"}, "mode": "slave", "master_id": "shaker_spfzte_master_0", "id": "shaker_spfzte_slave_0"}, "shaker_spfzte_master_0": {"node": "node-2.domain.tld", "slave": {"node": "node-5.domain.tld", "zone": "nova", "availability_zone": "nova:node-5.domain.tld", "ip": "10.0.0.4", "mode": "slave", "master_id": "shaker_spfzte_master_0", "id": "shaker_spfzte_slave_0"}, "zone": "nova", "availability_zone": "nova:node-2.domain.tld", "ip": "10.0.0.5", "mode": "master", "slave_id": "shaker_spfzte_slave_0", "id": "shaker_spfzte_master_0"}}, "sla": []};
  </script>

  <script type="text/javascript">
    "use strict";

    $(function () {

      var fields = ["scenario", "test", "concurrency", "node", "agent"];
      var state = {
        scenario: "",
        test: "",
        concurrency: "",
        node: "",
        agent: ""
      };
      var tablePageSize = 10;

      // compiled templates
      var scenario_source_template = Handlebars.compile($("#scenario_source_template").html());
      var test_specification_template = Handlebars.compile($("#test_specification_template").html());
      var agents_table_template = Handlebars.compile($("#agents_table_template").html());
      var records_table_template = Handlebars.compile($("#records_table_template").html());
      var executor_template = Handlebars.compile($("#executor_template").html());
      var concurrency_summary_template = Handlebars.compile($("#concurrency_summary_template").html());
      var test_summary_template = Handlebars.compile($("#test_summary_template").html());
      var sla_table_template = Handlebars.compile($("#sla_table_template").html());
      var errors_template = Handlebars.compile($("#errors_template").html());

      function concatenate(strings) {
        // returns strings concatenated via comma (like join() but omits empty strings)
        var f = false;
        var result = "";
        $.each(strings, function (_i, string) {
          if (string.length > 0) {
            if (f) result += ", ";
            result += string;
            f = true;
          }
        });
        return result;
      }

      function initSingleSelector(name, values) {
        var selectorId = "#" + name + "_selector";

        var selector_inst = $(selectorId);
        selector_inst.empty();
        selector_inst.append($("<option>", {
          style: "font-style: italic; text-decoration: underline;",
          value: "",
          text: selector_inst.data('placeholder')
        }));

        $.each(values, function (key, item) {
          selector_inst.append($('<option>', {
            value: item, //(key + 1),
            text: item
          }));
        });

        selector_inst.val(state[name]);

        selector_inst.
            on("change", function (e) {
              state[name] = this.value;

              // convert state -> url
              var tokens = [];
              $.each(fields.sort(), function (i, field) {
                if (state[field] != "") {
                  tokens.push(field + "=" + state[field]);
                }
              });
              window.location.href = "#" + tokens.join(":");
            });
      }

      function getFieldValues(field, records) {
        var values_set = {};

        $.each(records, function (j, record) {
          if (record[field]) {
            values_set["" + record[field]] = true;
          }
        });

        return $.map(values_set, function (_i, value) {
          return value;
        }).sort();
      }

      function updateSelectors() {
        $.each(fields, function (i, field) {
          var values = getFieldValues(field, filterRecords(report.records, null, field));
          console.log(values);
          initSingleSelector(field, values);
        });
      }

      function filterRecords(records, type, except_field) {
        var res = [];
        $.each(records, function(_i, record){
          if (!type || typeof type === 'undefined' || record.type == type) {
            var flag = true;
            $.each(state, function (key, value) {
              if (key != except_field && value) {
                flag &= record[key] == value;
              }
            });
            if (flag) {
              res.push(record);
            }
          }
        });
        return res;
      }

      function getAgentsByIds(agent_ids) {
        var agents = [];
        $.each(agent_ids, function(agent_id){
          agents.push(report.agents[agent_id]);
        });
        return agents;
      }

      /* Template Rendering Funcs */

      function showScenarioSource(contentArea, scenario) {
        contentArea.append(scenario_source_template(
            {data: jsyaml.safeDump(scenario)}));
      }

      function showTestSpecification(contentArea, test) {
        contentArea.append(test_specification_template(
            {data: jsyaml.safeDump(test)}
        ))
      }

      function showAgentRecord(contentArea, record) {
        var chart_id = "chart_" + Math.round(Math.random() * 10000);
        var ext_options = {
          command_yaml: jsyaml.safeDump(record["command"]),
          chart_id: chart_id};
        if (record["stats"]) {
          ext_options["stats_yaml"] = jsyaml.safeDump(record["stats"]);
        }
        if ((record["start"]) && (record["finish"])) {
          ext_options["time_info"] = jsyaml.safeDump({
            "start": new Date(record["start"] * 1000).toISOString(),
            "finish": new Date(record["finish"] * 1000).toISOString()
          });
        }
        contentArea.append(executor_template(
            {record: $.extend({}, record, ext_options)}
        ));
        if (record["samples"]) {
          var meta = record["meta"];
          var axes = [];
          axes[meta[1][0]] = 'y';
          var axis = {
            x: {label: concatenate(meta[0])},
            y: {label: concatenate(meta[1]), min: 0}
          };
          if (meta.length > 2) {
            axes[meta[2][0]] = 'y2';
            axis['y2'] = {label: concatenate(meta[2]), min: 0, show: true}
          }

          var chart = [];
          $.each(meta, function(_i, meta_item){  // row titles
            chart.push([meta_item[0]]);
          });
          var samples = record["samples"];
          for (var i=0; i < samples.length; i++) {
            var point = samples[i];
            for (var j=0; j < point.length; j++) {
              chart[j].push(point[j]);
            }
          }

          c3.generate({
            bindto: "#" + chart_id,
            data: {
              x: 'time',
              columns: chart,
              axes: axes
            },
            axis: axis
          });
        }
      }

      function showConcurrencySummary(contentArea, record) {
        var chart_id = "chart_" + Math.round(Math.random() * 10000);
        var node_chart_id = "node_chart_" + Math.round(Math.random() * 10000);
        var ext_options = { chart_id: chart_id, node_chart_id: node_chart_id };
        if (record["stats"]) {
          ext_options["stats_yaml"] = jsyaml.safeDump(record["stats"]);
        }
        console.log(record);
        contentArea.append(concurrency_summary_template(
            {record: $.extend({}, record, ext_options)}
        ));
        if (record["node_chart"]) {
          c3.generate({
            bindto: "#" + node_chart_id,
            data: {
              x: 'x',
              columns: record["node_chart"],
              type: 'step',
              order: null
            },
            axis: {
              x: { type: 'category' }
            }
          });
        }
      }

      function showTestSummary(contentArea, record) {
        console.log(record);
        var chart_id = "chart_" + Math.round(Math.random() * 10000);
        var ext_options = { chart_id: chart_id };
        if (record["stats"]) {
          ext_options["stats_yaml"] = jsyaml.safeDump(record["stats"]);
        }
        contentArea.append(test_summary_template(
            {record: $.extend({}, record, ext_options)}
        ));
        if (record["chart"]) {
          var meta = record["meta"];
          var axes = [];
          axes[meta[1][0]] = 'y';
          var axis = {
            x: {label: concatenate(meta[0])},
            y: {label: concatenate(meta[1]), min: 0}
          };
          if (meta.length > 2) {
            axes[meta[2][0]] = 'y2';
            axis['y2'] = {label: concatenate(meta[2]), min: 0, show: true}
          }

          c3.generate({
            bindto: "#" + chart_id,
            data: {
              x: 'concurrency',
              columns: record["chart"],
              axes: axes
            },
            axis: axis
          });
        }
      }

      function showAgentsTable(contentArea, filteredRecords) {
        var agent_ids = {};
        $.each(filteredRecords, function(_i, record){
          if (record.agent) {
            agent_ids[record.agent] = true;
          }
        });

        var agents = getAgentsByIds(agent_ids);
        if (agents.length == 0) return;

        // add slave agents
        var slave_agent_ids = {};
        $.each(agents, function(_i, agent){
          if (agent.slave_id) {
            slave_agent_ids[agent.slave_id] = true;
          }
        });
        agents = $.merge(agents, getAgentsByIds(slave_agent_ids));

        contentArea.append(agents_table_template({
          agents: agents,
          table_id: "agents_table"
        }));
        $("#agents_table").dataTable({
          "autoWidth": true,
          "paging": false,
          "ordering": true,
          "info": false
        });
      }

      function makeURL(record, s) {
        var extra = {};
        extra[s] = record[s];
        return "#" + $.map($.extend({}, state, extra), function (val, index) {
          return val? (index + "=" + val) : null;
        }).join(":")
      }

      function showRecordsTable(contentArea, filteredRecords) {
        $.each(filteredRecords, function(_i, record) {
          $.each(fields, function(_j, field){
            if (record[field]) {
              record[field + "_url"] = makeURL(record, field);
            }
          });
        });

        contentArea.append(records_table_template({
          records: filteredRecords,
          table_id: "records_table"
        }));
        $("#records_table").dataTable({
          autoWidth: true,
          paging: filteredRecords.length > tablePageSize,
          ordering: true,
          info: false,
          searching: filteredRecords.length > tablePageSize
        });
      }

      function showSlaTable(contentArea, records) {
        if (records.length == 0) return;

        contentArea.append(sla_table_template({
          records: records,
          table_id: "sla_table"
        }));
        $("#records_table").dataTable({
          autoWidth: true,
          paging: records.length > tablePageSize,
          ordering: true,
          info: false,
          searching: records.length > tablePageSize
        });
      }

      function showErrors(contentArea, records) {
        if (records.length == 0) return;

        contentArea.append(errors_template({
          records: records,
          table_id: "errors_list"
        }));
      }

      /* Update cycle */

      function update() {
        var filteredRecords = filterRecords(report.records);
        console.log(filteredRecords);
        var slaRecords = [];
        var errorRecords = [];
        $.each(filterRecords(report.records), function(_i, record) {
          if (record["sla_info"]) {
            slaRecords.push(record);
          }
          if (record["is_status_error"]) {
            errorRecords.push(record);
          }
        });

        var contentArea = $("#content_area");
        contentArea.empty();

        updateSelectors();

        showRecordsTable(contentArea, filteredRecords);
        showSlaTable(contentArea, slaRecords);
        showErrors(contentArea, errorRecords);

        if (state["scenario"] != "" && state["test"] != "" &&
                state["concurrency"] != "" &&
                state["agent"] != "") {
          showAgentRecord(contentArea, filteredRecords[0]);
        }
        if (state["scenario"] != "" && state["test"] != "" &&
                state["concurrency"] != "" && state["node"] == "" &&
                state["agent"] == "") {
          var agg_recs = filterRecords(report.records, "concurrency");
          if (agg_recs.length > 0) {
            showConcurrencySummary(contentArea, agg_recs[0]);
          }
        }
        if (state["scenario"] != "" && state["test"] != "" &&
                state["concurrency"] == "" && state["node"] == "" &&
                state["agent"] == "") {
          var test_recs = filterRecords(report.records, "test");
          if (test_recs.length > 0) {
            showTestSummary(contentArea, test_recs[0]);
          }
        }
        if (state["test"] != "") {
          showTestSpecification(contentArea, report.tests[state["test"]]);
        }
        if (state["agent"] == "") {
          showAgentsTable(contentArea, filteredRecords);
        }
        if (state["scenario"] != "") {
          showScenarioSource(contentArea, report.scenarios[state["scenario"]]);
        }
      }

      function parseUrlToState() {
        var hashUrl = window.location.hash.substr(1);

        $.each(hashUrl.split(":"), function (_i, pair) {
          var kv = pair.split("=");
          if (kv.length == 2) {
            state[kv[0]] = decodeURIComponent(kv[1]);
          }
        });
      }

      // entry-point
      parseUrlToState();
      console.log(state);

      // pre-process records
      $.each(report.records, function(_i, record) {
        if (record.status) {
          record["is_status_ok"] = record.status == "ok";
          record["is_status_lost"] = record.status == "lost";
          record["is_status_interrupted"] = record.status == "interrupted";
          record["is_status_error"] = record.status == "error";
        }
      });

      // auto-select filters with 1 option
      $.each(fields, function(_i, field) {
        var values = getFieldValues(field, report.records);
        if (values.length == 1) {
          state[field] = values[0];
        }
      });

      update();

      $(window).on('hashchange', function() {
        parseUrlToState();
        update()
      });

      $('[data-toggle="tooltip"]').tooltip();
    });
  </script>

  <style type="text/css">
  </style>

</head>

<body>

<div class="container" id="container">
  <div class="row text-center">
    <h1>Shaker | The Report</h1>
  </div>
  <hr>
  <div class="row">
    <div class="col-md-2">
      <label for="scenario_selector" title="Scenario name">Scenario</label>
      <select id="scenario_selector" class="form-control" data-placeholder="- Any scenario -"></select>
    </div>
    <div class="col-md-2">
      <label for="test_selector" title="Test name">Test Case</label>
      <select id="test_selector" class="form-control" data-placeholder="- Any test case -"></select>
    </div>
    <div class="col-md-2">
      <label for="concurrency_selector" title="Concurrency">Concurrency</label>
      <select id="concurrency_selector" class="form-control" data-placeholder="- Any concurrency -"></select>
    </div>
    <div class="col-md-2">
      <label for="node_selector" title="Host / Compute node">Host</label>
      <select id="node_selector" class="form-control" data-placeholder="- Any node -"></select>
    </div>
    <div class="col-md-2">
      <label for="agent_selector" title="Agent">Agent</label>
      <select id="agent_selector" class="form-control" data-placeholder="- Any agent -"></select>
    </div>
  </div>

  <div id="content_area" class="row">
    <!-- Container for the screen content -->
  </div>

  <div id="footer" class="row">&nbsp;</div>
</div>

<!-- TEMPLATES --------------------------------------------------------------->

<!-- Scenario File -->
<script id="scenario_source_template" type="text/x-handlebars-template">
  <h3>Scenario</h3>
  <pre>{{ data }}</pre>
</script>

<!-- Test Specification -->
<script id="test_specification_template" type="text/x-handlebars-template">
  <h3>Test Specification</h3>
  <pre>{{ data }}</pre>
</script>

<!-- Executor Result -->
<script id="executor_template" type="text/x-handlebars-template">
  <h3>Execution Summary</h3>
  {{#with record}}
  <div id="{{ chart_id }}"></div>
  {{#if is_status_ok}}<span class="label label-success"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span>success</span>{{/if}}
  {{#if is_status_lost}}<span class="label label-danger"><span class="glyphicon glyphicon-alert" aria-hidden="true"></span>lost</span>{{/if}}
  {{#if is_status_interrupted}}<span class="label label-warning"><span class="glyphicon glyphicon-stop" aria-hidden="true"></span>interrupted</span>{{/if}}
  {{#if is_status_error}}<span class="label label-danger"><span class="glyphicon glyphicon-alert" aria-hidden="true"></span>error</span>{{/if}}
  {{#if stats_yaml}}
    <h4>Stats</h4>
    <pre>{{ stats_yaml }}</pre>
  {{/if}}
  {{#if time_info}}
    <h4>Time Info</h4>
    <pre>{{ time_info }}</pre>
  {{/if}}
  <h4>Command</h4>
  <pre>{{ command_yaml }}</pre>
  {{#if stdout}}
    <h4>Stdout</h4>
    <pre>{{ stdout }}</pre>
  {{/if}}
  {{#if verbose}}
    <h4>Verbose Info</h4>
    <pre>{{ verbose }}</pre>
  {{/if}}
  {{#if stderr}}
    <h4>Stderr</h4>
    <pre>{{ stderr }}</pre>
  {{/if}}
  {{/with}}
</script>

<!-- Concurrency summary -->
<script id="concurrency_summary_template" type="text/x-handlebars-template">
  {{#with record}}
  <div id="{{ chart_id  }}"></div>
  <h3>Per-node chart</h3>
  <div id="{{ node_chart_id  }}"></div>
  <h3>Stats</h3>
  <pre>{{ stats_yaml }}</pre>
  {{/with}}
</script>

<!-- Test summary -->
<script id="test_summary_template" type="text/x-handlebars-template">
  {{#with record}}
  <div id="{{ chart_id   }}"></div>
  {{#if stats_yaml}}
    <h3>Stats</h3>
    <pre>{{ stats_yaml }}</pre>
  {{/if}}
  {{/with}}
</script>

<!-- Records Table -->
<script id="records_table_template" type="text/x-handlebars-template">
  <h3>Records</h3>
  <table class="table table-striped" id="{{ table_id  }}">
    <thead>
    <tr>
      <th>Scenario</th>
      <th>Test Case</th>
      <th>Concurrency</th>
      <th>Host / Compute Node</th>
      <th>Agent</th>
      <th>Status</th>
    </tr>
    </thead>
    <tbody>
    {{#records}}
    <tr>
      <td><a href="{{ scenario_url }}">{{ scenario }}</a></td>
      <td><a href="{{ test_url }}">{{ test }}</a></td>
      <td><a href="{{ concurrency_url }}">{{ concurrency }}</a></td>
      <td><a href="{{ node_url }}">{{ node }}</a></td>
      <td><a href="{{ agent_url }}">{{ agent }}</a></td>
      <td>
        {{#if is_status_ok }}
          <span class="label label-success">
            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
            success
          </span>
        {{/if}}
        {{#if is_status_lost }}
          <span class="label label-danger">
            <span class="glyphicon glyphicon-alert" aria-hidden="true"></span>
            lost
          </span>
        {{/if}}
        {{#if is_status_interrupted }}
          <span class="label label-warning">
            <span class="glyphicon glyphicon-stop" aria-hidden="true"></span>
            interrupted
          </span>
        {{/if}}
        {{#if is_status_error }}
          <span class="label label-danger">
            <span class="glyphicon glyphicon-stop" aria-hidden="true"></span>
            error
          </span>
        {{/if}}
      </td>
    </tr>
    {{/records}}
    </tbody>
  </table>
</script>

<!-- Agents List -->
<script id="agents_table_template" type="text/x-handlebars-template">
  <h3>Agents</h3>
  <table class="table table-striped" id="{{ table_id }}">
    <thead>
    <tr>
      <th>Agent</th>
      <th>Mode</th>
      <th>IP</th>
      <th>Node</th>
      <th>AZ</th>
    </tr>
    </thead>
    <tbody>
    {{#agents}}
    <tr>
      <td>{{ id }}</td>
      <td>{{ mode }}</td>
      <td>{{ ip }}</td>
      <td>{{ node }}</td>
      <td>{{ zone }}</td>
    </tr>
    {{/agents}}
    </tbody>
  </table>
</script>

<!-- SLA List -->
<script id="sla_table_template" type="text/x-handlebars-template">
  <h3>Agents</h3>
  <table class="table table-striped" id="{{  table_id }}">
    <thead>
    <tr>
      <th>Condition</th>
      <th>Location</th>
      <th>Status</th>
    </tr>
    </thead>
    <tbody>
    {{#records}}
    <tr>
      <td>{{ sla }}</td>
      <td>{{ location }}</td>
      <td>
        {{#if is_status_ok }}
          <span class="text-success">
            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
            {{ status }}
          </span>
        {{else}}
          <span class="text-danger">
            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
            {{ status }}
          </span>
        {{/if}}
      </td>
    </tr>
    {{/records}}
    </tbody>
  </table>
</script>

<!-- Errors -->
<script id="errors_template" type="text/x-handlebars-template">
  <h3>Errors</h3>
  <div class="text-danger">
    <ul>
    {{#records}}
      <li>{{ info }}<br/>{{ stderr }}{{ traceback }}</li>
    {{/records}}
    </ul>
  </div>
</script>

</body>
</html>