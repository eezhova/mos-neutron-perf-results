<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head profile="http://gmpg.org/xfn/11">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>

  <title>Shaker | The distributed data-plane testing tool for OpenStack</title>

  <!-- LIBS -->

  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.4/js/bootstrap.js"></script>
  <script type="text/javascript"
          src="https://cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js"></script>
  <script type="text/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/3.0.1/handlebars.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/3.2.7/js-yaml.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script type="application/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.js"></script>

  <!-- STYLES -->

  <link rel="stylesheet"
        href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.4/simplex/bootstrap.min.css">
  <link rel=stylesheet type=text/css
        href="https://cdn.datatables.net/1.10.2/css/jquery.dataTables.min.css">
  <link rel=stylesheet type=text/css
        href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.css">
  <link rel='stylesheet' type='text/css'
        href='http://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic&subset=latin,cyrillic'>

  <script type="application/javascript">
    var report = {"scenarios": {"OpenStack L2": {"file_name": "shaker/shaker/scenarios/openstack/full_l2.yaml", "title": "OpenStack L2", "execution": {"tests": [{"title": "Download", "method": "tcp_download", "class": "flent"}, {"title": "Upload", "method": "tcp_upload", "class": "flent"}, {"title": "Bi-directional", "method": "tcp_bidirectional", "class": "flent"}], "progression": "quadratic"}, "description": "In this scenario Shaker launches pairs of instances in the same tenant network. Every instance is hosted on a separate compute node, all available compute nodes are utilized. The traffic goes within the tenant network (L2 domain).", "deployment": {"accommodation": ["pair", "single_room"], "template": "l2.hot"}}}, "records": {"fc94c26f-b00e-4af8-ada6-aec22cce7099": {"status": "ok", "node": "node-2.domain.tld", "finish": 1471335544.158082, "stats": {"ping_icmp": {"max": 1.32, "avg": 0.3550577123632581, "unit": "ms", "min": 0.21303455112298542}, "tcp_upload": {"max": 9848.805364129545, "avg": 9837.86293578972, "unit": "Mbits/s", "min": 9747.18}}, "stderr": "", "scenario": "OpenStack L2", "concurrency": 1, "schedule": 1471335473.746161, "agent": "shaker_oszeuk_master_0", "start": 1471335473.756536, "meta": [["time", "s"], ["ping_icmp", "ms"], ["tcp_upload", "Mbits/s"]], "command": {"data": "zcat `flent -H 10.0.0.6 -l 60 -s 1 tcp_upload 2>&1 | grep \"se with\" | grep -Po '\\./\\S+'`", "type": "script"}, "samples": [[0.0, 1.32, null], [1.0, 0.43742883873621363, null], [2.0, 0.5799070753889399, null], [3.0, 0.3910852725785567, null], [4.0, 0.5678925753249495, null], [5.0, 0.3990764068757222, null], [6.0, 0.2710323855976997, 9747.18], [7.0, 0.257003221108729, 9839.732496856615], [8.0, 0.2839922241901211, 9841.045348677635], [9.0, 0.2929975709475021, 9839.77862854004], [10.0, 0.284002304585854, 9841.566002832442], [11.0, 0.32298830322079836, 9840.448824710846], [12.0, 0.28900988969226077, 9840.44], [13.0, 0.30699494023145424, 9802.861036580225], [14.0, 0.3319923529136889, 9839.236324400901], [15.0, 0.36798733197329736, 9840.362919869423], [16.0, 0.3330107483913178, 9840.825523585929], [17.0, 0.2870117246073935, 9841.00824660778], [18.0, 0.29399813082106785, 9841.118928482534], [19.0, 0.2560084351525888, 9839.76470046431], [20.0, 0.2829931444927783, 9841.105284836292], [21.0, 0.4299410587231559, 9840.230556275124], [22.0, 0.5279494439048857, 9841.158846123219], [23.0, 0.3040647424780939, 9841.199618149249], [24.0, 0.3759747330115836, 9839.85732788086], [25.0, 0.33001375365216645, 9841.191193612573], [26.0, 0.34899386206148425, 9834.809179196358], [27.0, 0.2650199087112057, 9845.27228219711], [28.0, 0.29299247002816586, 9840.892492929614], [29.0, 0.28000324827667766, 9840.829832756897], [30.0, 0.40895061243969405, 9839.925401754379], [31.0, 0.3780110941326342, 9843.036763501168], [32.0, 0.43197738070262437, 9840.081227574348], [33.0, 0.2820419913484945, 9823.380408967683], [34.0, 0.31598966480347035, 9848.805364129545], [35.0, 0.26301350874490775, 9843.346978018284], [36.0, 0.4109430206086034, 9830.342938869], [37.0, 0.2870337362267903, 9840.325493965149], [38.0, 0.30999312371659754, 9840.343182769171], [39.0, 0.3319927618293785, 9841.212448012968], [40.0, 0.3290009477262795, 9839.975268554688], [41.0, 0.42895870990873985, 9840.939072530224], [42.0, 0.28203747173398963, 9840.167592548572], [43.0, 0.2520068094245679, 9828.860890140533], [44.0, 0.36695769977556053, 9840.319761266708], [45.0, 0.2940189730154934, 9840.638636898568], [46.0, 0.3379861429216826, 9840.669288481262], [47.0, 0.3559940048350412, 9840.640712230204], [48.0, 0.5009293829485453, 9840.903326620615], [49.0, 0.2750564823627355, 9840.130572118887], [50.0, 0.3879560379204403, 9841.38627947092], [51.0, 0.2680292725150494, 9840.193660029454], [52.0, 0.29699188309327434, 9840.840600729118], [53.0, 0.3099963085801015, 9837.22375117302], [54.0, 0.345988447616248, 9841.670172328948], [55.0, 0.3400018839966383, 9846.904359984397], [56.0, 0.3999768988809904, 9833.934225487708], [57.0, 0.23903654866975976, 9839.659687554931], [58.0, 0.24999753736686367, 9840.819991554124], [59.0, 0.3049846061748383, 9841.141077685355], [60.0, 0.3069994158815837, 9840.665355134146], [61.0, 0.2500124764037743, 9840.96985547781], [62.0, 0.3319747432341648, 9840.447440058326], [63.0, 0.39097800111381936, 9840.28476113558], [64.0, 0.21303455112298542, 9842.011452042741], [65.0, 0.22999663592668182, 9837.775488808415], [66.0, 0.5497969179747945, 9837.75], [67.0, 0.3480832399915199, null], [68.0, 0.5089029418810733, null], [69.0, 0.42704190019928856, null]], "executor": "flent", "test": "Upload", "type": "agent", "id": "fc94c26f-b00e-4af8-ada6-aec22cce7099"}, "ba8746b3-0d9a-4f0e-aa4b-fbc85791afc8": {"stats": {"ping_icmp": {"max": 1.32, "avg": 0.3550577123632581, "unit": "ms", "min": 0.21303455112298542}, "tcp_upload": {"max": 9848.805364129545, "avg": 9837.86293578972, "unit": "Mbits/s", "min": 9747.18}}, "scenario": "OpenStack L2", "concurrency": 1, "test": "Upload", "type": "concurrency", "id": "ba8746b3-0d9a-4f0e-aa4b-fbc85791afc8", "node_chart": [["x", "node-2.domain.tld"], ["Avg ping_icmp, ms", 0.3550577123632581], ["Max ping_icmp, ms", 1.32], ["Min ping_icmp, ms", 0.21303455112298542], ["Avg tcp_upload, Mbits/s", 9837.86293578972], ["Max tcp_upload, Mbits/s", 9848.805364129545], ["Min tcp_upload, Mbits/s", 9747.18]]}, "df468128-5e02-4574-8536-f3eca3637e53": {"meta": [["concurrency", ""], ["ping_icmp", "ms"], ["tcp_download", "Mbits/s"]], "scenario": "OpenStack L2", "test": "Download", "type": "test", "chart": [["concurrency", 1], ["ping_icmp", 0.7900550213436824], ["tcp_download", 9825.181860143759]], "id": "df468128-5e02-4574-8536-f3eca3637e53"}, "5a5eacdd-6a58-4a29-b0d0-ce5a786122b9": {"meta": [["concurrency", ""], ["ping_icmp", "ms"], ["tcp_upload", "Mbits/s"]], "scenario": "OpenStack L2", "test": "Upload", "type": "test", "chart": [["concurrency", 1], ["ping_icmp", 0.3550577123632581], ["tcp_upload", 9837.86293578972]], "id": "5a5eacdd-6a58-4a29-b0d0-ce5a786122b9"}, "5cc995ad-6708-4f92-9087-5c5f91e43f1d": {"meta": [["concurrency", ""], ["ping_icmp", "ms"], ["tcp_download", "Mbits/s"], ["tcp_upload", "Mbits/s"]], "scenario": "OpenStack L2", "test": "Bi-directional", "type": "test", "chart": [["concurrency", 1], ["ping_icmp", 1.7104512280909154], ["tcp_download", 6559.812518625581], ["tcp_upload", 6585.85891191791]], "id": "5cc995ad-6708-4f92-9087-5c5f91e43f1d"}, "4e8acfd1-063a-44dd-8fe7-0bcf21dc5fe6": {"stats": {"ping_icmp": {"max": 2.725876484691684, "avg": 1.7104512280909154, "unit": "ms", "min": 0.34711090206000805}, "tcp_download": {"max": 6993.123271226996, "avg": 6559.812518625581, "unit": "Mbits/s", "min": 5821.88}, "tcp_upload": {"max": 6981.51, "avg": 6585.85891191791, "unit": "Mbits/s", "min": 6189.49335128056}}, "scenario": "OpenStack L2", "concurrency": 1, "test": "Bi-directional", "type": "concurrency", "id": "4e8acfd1-063a-44dd-8fe7-0bcf21dc5fe6", "node_chart": [["x", "node-2.domain.tld"], ["Avg ping_icmp, ms", 1.7104512280909154], ["Max ping_icmp, ms", 2.725876484691684], ["Min ping_icmp, ms", 0.34711090206000805], ["Avg tcp_download, Mbits/s", 6559.812518625581], ["Max tcp_download, Mbits/s", 6993.123271226996], ["Min tcp_download, Mbits/s", 5821.88], ["Avg tcp_upload, Mbits/s", 6585.85891191791], ["Max tcp_upload, Mbits/s", 6981.51], ["Min tcp_upload, Mbits/s", 6189.49335128056]]}, "7cd554a2-947b-4da5-8dad-9259f0644679": {"stats": {"ping_icmp": {"max": 1.5698013271043987, "avg": 0.7900550213436824, "unit": "ms", "min": 0.3471441476062333}, "tcp_download": {"max": 9847.152645163536, "avg": 9825.181860143759, "unit": "Mbits/s", "min": 9141.81576704979}}, "scenario": "OpenStack L2", "concurrency": 1, "test": "Download", "type": "concurrency", "id": "7cd554a2-947b-4da5-8dad-9259f0644679", "node_chart": [["x", "node-2.domain.tld"], ["Avg ping_icmp, ms", 0.7900550213436824], ["Max ping_icmp, ms", 1.5698013271043987], ["Min ping_icmp, ms", 0.3471441476062333], ["Avg tcp_download, Mbits/s", 9825.181860143759], ["Max tcp_download, Mbits/s", 9847.152645163536], ["Min tcp_download, Mbits/s", 9141.81576704979]]}, "468d9cb9-0dc6-4ed2-9ea5-03f6815f626c": {"status": "ok", "node": "node-2.domain.tld", "finish": 1471335634.590818, "stats": {"ping_icmp": {"max": 2.725876484691684, "avg": 1.7104512280909154, "unit": "ms", "min": 0.34711090206000805}, "tcp_download": {"max": 6993.123271226996, "avg": 6559.812518625581, "unit": "Mbits/s", "min": 5821.88}, "tcp_upload": {"max": 6981.51, "avg": 6585.85891191791, "unit": "Mbits/s", "min": 6189.49335128056}}, "stderr": "", "scenario": "OpenStack L2", "concurrency": 1, "schedule": 1471335564.182137, "agent": "shaker_oszeuk_master_0", "start": 1471335564.192326, "meta": [["time", "s"], ["ping_icmp", "ms"], ["tcp_download", "Mbits/s"], ["tcp_upload", "Mbits/s"]], "command": {"data": "zcat `flent -H 10.0.0.6 -l 60 -s 1 tcp_bidirectional 2>&1 | grep \"se with\" | grep -Po '\\./\\S+'`", "type": "script"}, "samples": [[0.0, 0.782, null, null], [1.0, 0.4811678341074439, null, null], [2.0, 0.4740005743852789, null, null], [3.0, 0.40800079342373785, null, null], [4.0, 0.4209985884506171, null, null], [5.0, 0.34711090206000805, null, null], [6.0, 1.4788796463426919, 5821.88, 6981.51], [7.0, 2.127931179762918, 5957.717581369877, 6873.8558478569985], [8.0, 1.9507607835908076, 6427.465310759545, 6490.820660769178], [9.0, 2.367625770718391, 6521.060399595284, 6475.359241838455], [10.0, 1.8235894483912056, 6508.454606150913, 6448.873138656617], [11.0, 2.127697570345731, 6598.775291342735, 6551.446783918498], [12.0, 2.3480653367012225, 6556.492784180641, 6525.189388512418], [13.0, 2.725876484691684, 6609.491261949539, 6553.850671361521], [14.0, 2.5324890394570025, 6568.725388493538, 6559.52863125813], [15.0, 1.7214567741238214, 6589.373558278084, 6586.125445315659], [16.0, 1.650902873109339, 6646.696470575333, 6610.658474095062], [17.0, 2.5648771755447433, 6597.45487197876, 6553.656850873813], [18.0, 1.3611281089057443, 6622.001166702949, 6603.015150668622], [19.0, 1.7619044925249132, 6599.654177436829, 6575.538690002949], [20.0, 1.8483065655928967, 6623.74798242569, 6650.090913845856], [21.0, 2.006438203478153, 6993.123271226996, 6958.675736794472], [22.0, 1.9318949572259492, 6582.628957636754, 6555.914639620017], [23.0, 1.3635661294546328, 6608.623791503906, 6548.053238677261], [24.0, 1.5645052392647558, 6615.647661132812, 6578.6188737792645], [25.0, 1.2778979605685312, 6497.783107757568, 6425.050989070377], [26.0, 2.05695651263658, 6564.031489615693, 6540.579057927383], [27.0, 2.3710410449138184, 6505.567431418896, 6460.266242396831], [28.0, 1.8954190593765206, 6540.401435124874, 6522.351289941948], [29.0, 2.315072190307837, 6574.74515794754, 6544.64621882397], [30.0, 1.924031948132378, 6566.852120156288, 6556.835928054288], [31.0, 1.746026351664823, 6661.595991652011, 6605.71380081892], [32.0, 1.884499469553818, 6497.757620065212, 6482.469374477121], [33.0, 2.3800610435650373, 6551.176369835117, 6493.949614042926], [34.0, 2.208076753734782, 6515.36935274601, 6517.429489955815], [35.0, 2.0466393344432934, 6488.579697284698, 6478.2478005467665], [36.0, 2.231534958733698, 6394.002007226944, 6530.806386852264], [37.0, 2.163549422963958, 6388.647724249363, 6573.643457145691], [38.0, 1.9213510397175337, 6513.030713768006, 6505.646635935578], [39.0, 1.7195004789041872, 6573.236258411937, 6540.433661604698], [40.0, 2.147560462655849, 6551.608984718323, 6521.663361988068], [41.0, 1.571049463593516, 6564.288205077648, 6558.356987895619], [42.0, 1.9290025975991303, 6563.544642715454, 6529.9667857838685], [43.0, 2.564997672115992, 6574.0169161907625, 6479.9411053238555], [44.0, 1.3896446575181196, 6696.912438931465, 6693.205741505652], [45.0, 1.2916712294063613, 6914.478968896866, 6893.1576288549795], [46.0, 1.29, 6940.872767996788, 6963.762941657395], [47.0, 2.3904780015682165, 6639.18064450264, 6598.629498960972], [48.0, 2.4318286219396734, 6501.364479322434, 6472.443962873398], [49.0, 2.720722866863965, 6238.054032340049, 6189.49335128056], [50.0, 2.374809782369328, 6566.049738445282, 6486.829614543914], [51.0, 1.779307482589985, 6402.738851332664, 6375.197384250895], [52.0, 1.8986842828949495, 6485.26054031372, 6501.420614440442], [53.0, 2.0684746805690435, 6494.490788693428, 6455.474613337912], [54.0, 2.3406173628969933, 6520.004802188782, 6489.79186253989], [55.0, 1.8578782741429445, 6499.743519067764, 6471.248280321134], [56.0, 1.3464859245616596, 6947.846801548005, 6953.278075733185], [57.0, 1.5046863208580392, 6972.29894320488, 6927.469512592361], [58.0, 1.1589093621228659, 6680.063186268042, 6687.97381246341], [59.0, 2.173290048148368, 6614.429264736176, 6661.374860019684], [60.0, 1.2719862623111515, 6610.835997180939, 6689.016014122194], [61.0, 1.6048196063077396, 6352.6523305138335, 6478.839212684631], [62.0, 2.1274135545150195, 6402.237221975327, 6426.3932199335095], [63.0, 1.9403428489623753, 6717.266724672318, 6695.025089899986], [64.0, 1.7182779945770692, 6735.569316700877, 6750.977360065882], [65.0, 0.5344571484945986, 6521.15, 6664.150408479535], [66.0, 0.5067720096383704, null, 6663.46], [67.0, 0.47094859846843806, null, null], [68.0, 0.5063846743428377, null, null], [69.0, 0.5072521334610041, null, null]], "executor": "flent", "test": "Bi-directional", "type": "agent", "id": "468d9cb9-0dc6-4ed2-9ea5-03f6815f626c"}, "b0322715-3f94-4a3d-ad78-8d2b263260fd": {"status": "ok", "node": "node-2.domain.tld", "finish": 1471335453.726713, "stats": {"ping_icmp": {"max": 1.5698013271043987, "avg": 0.7900550213436824, "unit": "ms", "min": 0.3471441476062333}, "tcp_download": {"max": 9847.152645163536, "avg": 9825.181860143759, "unit": "Mbits/s", "min": 9141.81576704979}}, "stderr": "", "scenario": "OpenStack L2", "concurrency": 1, "schedule": 1471335383.29162, "agent": "shaker_oszeuk_master_0", "start": 1471335383.301906, "meta": [["time", "s"], ["ping_icmp", "ms"], ["tcp_download", "Mbits/s"]], "command": {"data": "zcat `flent -H 10.0.0.6 -l 60 -s 1 tcp_download 2>&1 | grep \"se with\" | grep -Po '\\./\\S+'`", "type": "script"}, "samples": [[0.0, 1.28, null], [1.0, 0.558161601604484, null], [2.0, 0.509034501675853, null], [3.0, 0.5507443061580249, null], [4.0, 0.3471441476062333, null], [5.0, 0.44531228878717805, null], [6.0, 0.6740540068520315, 9822.17], [7.0, 1.5698013271043987, 9141.81576704979], [8.0, 0.7880991500754784, 9811.256549062728], [9.0, 0.7976006123744535, 9840.545558071137], [10.0, 1.4899716414374973, 9495.422671289443], [11.0, 1.4100895513504954, 9842.803590459824], [12.0, 1.4299531366310094, 9845.534653010369], [13.0, 0.7541386443306521, 9842.501903882026], [14.0, 0.8078351013053574, 9842.907942864329], [15.0, 0.7411926283507876, 9845.75597787857], [16.0, 0.7987574798080007, 9845.809803886414], [17.0, 0.828903275530141, 9845.471666965484], [18.0, 0.7731631248974483, 9845.420245141982], [19.0, 0.9554333868325244, 9845.549362630843], [20.0, 0.7775224163084582, 9844.743971300124], [21.0, 0.9641912229466965, 9846.162988939286], [22.0, 0.8324224718543287, 9845.801814050674], [23.0, 0.7362772322658269, 9842.615689086915], [24.0, 0.6951160377819608, 9845.595242452622], [25.0, 0.7867308454990648, 9835.061970100403], [26.0, 0.845804618860147, 9843.30911031723], [27.0, 0.7891667850874274, 9845.001861286164], [28.0, 0.7341576409190433, 9845.497597608566], [29.0, 0.8017994846771557, 9845.062157249451], [30.0, 0.8408840619549285, 9846.124753961562], [31.0, 0.841, 9845.174706726075], [32.0, 0.7712035891792003, 9844.921225709915], [33.0, 0.9414708701610475, 9845.636469955443], [34.0, 0.8204837895458995, 9845.948480119707], [35.0, 0.8459220289707732, 9845.233530044556], [36.0, 0.8061683568632093, 9845.69769566536], [37.0, 0.8329119757821057, 9845.391519880293], [38.0, 0.7562240667670918, 9839.240299549101], [39.0, 0.7899006189974497, 9845.558719882965], [40.0, 0.7580926387146397, 9846.097499551774], [41.0, 0.8606151223198172, 9843.56503762416], [42.0, 0.8111483636335872, 9840.89576102495], [43.0, 0.7242488314472838, 9845.80078012228], [44.0, 0.7638836479111982, 9845.710708360672], [45.0, 0.7131447915002587, 9844.497201666833], [46.0, 0.6621982803810971, 9845.891676762103], [47.0, 0.7417621061840508, 9845.691239631176], [48.0, 0.756956587786163, 9845.501121571064], [49.0, 0.7320713733923998, 9845.5], [50.0, 0.8725755169478414, 9845.659055519103], [51.0, 0.8232141244767434, 9845.819055519103], [52.0, 0.8210065626619901, 9845.412420232296], [53.0, 0.7332533610200385, 9826.611625835896], [54.0, 0.742957081228305, 9827.971263551712], [55.0, 0.8436565948180716, 9845.993037538528], [56.0, 0.8101562459368751, 9844.350389289855], [57.0, 0.7601774872257647, 9846.447485628127], [58.0, 0.841755092557141, 9844.243163702487], [59.0, 0.7363059271015344, 9847.152645163536], [60.0, 0.8366993610487173, 9826.363549907208], [61.0, 0.7264670497927366, 9845.744183030129], [62.0, 0.7549057453094121, 9845.482243142127], [63.0, 0.739045934836605, 9845.559527759551], [64.0, 0.7330171962440347, 9832.855440411568], [65.0, 0.4178242847205048, 9845.35], [66.0, 0.44489453946030444, null], [67.0, 0.5098154263556087, null], [68.0, 0.501024276316213, null], [69.0, 0.41222991559497224, null]], "executor": "flent", "test": "Download", "type": "agent", "id": "b0322715-3f94-4a3d-ad78-8d2b263260fd"}}, "tests": {"Download": {"class": "flent", "method": "tcp_download", "title": "Download"}, "Bi-directional": {"class": "flent", "method": "tcp_bidirectional", "title": "Bi-directional"}, "Upload": {"class": "flent", "method": "tcp_upload", "title": "Upload"}}, "agents": {"shaker_oszeuk_master_0": {"node": "node-2.domain.tld", "slave": {"node": "node-5.domain.tld", "zone": "nova", "availability_zone": "nova:node-5.domain.tld", "ip": "10.0.0.6", "mode": "slave", "master_id": "shaker_oszeuk_master_0", "id": "shaker_oszeuk_slave_0"}, "zone": "nova", "availability_zone": "nova:node-2.domain.tld", "ip": "10.0.0.5", "mode": "master", "slave_id": "shaker_oszeuk_slave_0", "id": "shaker_oszeuk_master_0"}, "shaker_oszeuk_slave_0": {"node": "node-5.domain.tld", "zone": "nova", "availability_zone": "nova:node-5.domain.tld", "ip": "10.0.0.6", "master": {"node": "node-2.domain.tld", "zone": "nova", "availability_zone": "nova:node-2.domain.tld", "ip": "10.0.0.5", "mode": "master", "slave_id": "shaker_oszeuk_slave_0", "id": "shaker_oszeuk_master_0"}, "mode": "slave", "master_id": "shaker_oszeuk_master_0", "id": "shaker_oszeuk_slave_0"}}, "sla": []};
  </script>

  <script type="text/javascript">
    "use strict";

    $(function () {

      var fields = ["scenario", "test", "concurrency", "node", "agent"];
      var state = {
        scenario: "",
        test: "",
        concurrency: "",
        node: "",
        agent: ""
      };
      var tablePageSize = 10;

      // compiled templates
      var scenario_source_template = Handlebars.compile($("#scenario_source_template").html());
      var test_specification_template = Handlebars.compile($("#test_specification_template").html());
      var agents_table_template = Handlebars.compile($("#agents_table_template").html());
      var records_table_template = Handlebars.compile($("#records_table_template").html());
      var executor_template = Handlebars.compile($("#executor_template").html());
      var concurrency_summary_template = Handlebars.compile($("#concurrency_summary_template").html());
      var test_summary_template = Handlebars.compile($("#test_summary_template").html());
      var sla_table_template = Handlebars.compile($("#sla_table_template").html());
      var errors_template = Handlebars.compile($("#errors_template").html());

      function concatenate(strings) {
        // returns strings concatenated via comma (like join() but omits empty strings)
        var f = false;
        var result = "";
        $.each(strings, function (_i, string) {
          if (string.length > 0) {
            if (f) result += ", ";
            result += string;
            f = true;
          }
        });
        return result;
      }

      function initSingleSelector(name, values) {
        var selectorId = "#" + name + "_selector";

        var selector_inst = $(selectorId);
        selector_inst.empty();
        selector_inst.append($("<option>", {
          style: "font-style: italic; text-decoration: underline;",
          value: "",
          text: selector_inst.data('placeholder')
        }));

        $.each(values, function (key, item) {
          selector_inst.append($('<option>', {
            value: item, //(key + 1),
            text: item
          }));
        });

        selector_inst.val(state[name]);

        selector_inst.
            on("change", function (e) {
              state[name] = this.value;

              // convert state -> url
              var tokens = [];
              $.each(fields.sort(), function (i, field) {
                if (state[field] != "") {
                  tokens.push(field + "=" + state[field]);
                }
              });
              window.location.href = "#" + tokens.join(":");
            });
      }

      function getFieldValues(field, records) {
        var values_set = {};

        $.each(records, function (j, record) {
          if (record[field]) {
            values_set["" + record[field]] = true;
          }
        });

        return $.map(values_set, function (_i, value) {
          return value;
        }).sort();
      }

      function updateSelectors() {
        $.each(fields, function (i, field) {
          var values = getFieldValues(field, filterRecords(report.records, null, field));
          console.log(values);
          initSingleSelector(field, values);
        });
      }

      function filterRecords(records, type, except_field) {
        var res = [];
        $.each(records, function(_i, record){
          if (!type || typeof type === 'undefined' || record.type == type) {
            var flag = true;
            $.each(state, function (key, value) {
              if (key != except_field && value) {
                flag &= record[key] == value;
              }
            });
            if (flag) {
              res.push(record);
            }
          }
        });
        return res;
      }

      function getAgentsByIds(agent_ids) {
        var agents = [];
        $.each(agent_ids, function(agent_id){
          agents.push(report.agents[agent_id]);
        });
        return agents;
      }

      /* Template Rendering Funcs */

      function showScenarioSource(contentArea, scenario) {
        contentArea.append(scenario_source_template(
            {data: jsyaml.safeDump(scenario)}));
      }

      function showTestSpecification(contentArea, test) {
        contentArea.append(test_specification_template(
            {data: jsyaml.safeDump(test)}
        ))
      }

      function showAgentRecord(contentArea, record) {
        var chart_id = "chart_" + Math.round(Math.random() * 10000);
        var ext_options = {
          command_yaml: jsyaml.safeDump(record["command"]),
          chart_id: chart_id};
        if (record["stats"]) {
          ext_options["stats_yaml"] = jsyaml.safeDump(record["stats"]);
        }
        if ((record["start"]) && (record["finish"])) {
          ext_options["time_info"] = jsyaml.safeDump({
            "start": new Date(record["start"] * 1000).toISOString(),
            "finish": new Date(record["finish"] * 1000).toISOString()
          });
        }
        contentArea.append(executor_template(
            {record: $.extend({}, record, ext_options)}
        ));
        if (record["samples"]) {
          var meta = record["meta"];
          var axes = [];
          axes[meta[1][0]] = 'y';
          var axis = {
            x: {label: concatenate(meta[0])},
            y: {label: concatenate(meta[1]), min: 0}
          };
          if (meta.length > 2) {
            axes[meta[2][0]] = 'y2';
            axis['y2'] = {label: concatenate(meta[2]), min: 0, show: true}
          }

          var chart = [];
          $.each(meta, function(_i, meta_item){  // row titles
            chart.push([meta_item[0]]);
          });
          var samples = record["samples"];
          for (var i=0; i < samples.length; i++) {
            var point = samples[i];
            for (var j=0; j < point.length; j++) {
              chart[j].push(point[j]);
            }
          }

          c3.generate({
            bindto: "#" + chart_id,
            data: {
              x: 'time',
              columns: chart,
              axes: axes
            },
            axis: axis
          });
        }
      }

      function showConcurrencySummary(contentArea, record) {
        var chart_id = "chart_" + Math.round(Math.random() * 10000);
        var node_chart_id = "node_chart_" + Math.round(Math.random() * 10000);
        var ext_options = { chart_id: chart_id, node_chart_id: node_chart_id };
        if (record["stats"]) {
          ext_options["stats_yaml"] = jsyaml.safeDump(record["stats"]);
        }
        console.log(record);
        contentArea.append(concurrency_summary_template(
            {record: $.extend({}, record, ext_options)}
        ));
        if (record["node_chart"]) {
          c3.generate({
            bindto: "#" + node_chart_id,
            data: {
              x: 'x',
              columns: record["node_chart"],
              type: 'step',
              order: null
            },
            axis: {
              x: { type: 'category' }
            }
          });
        }
      }

      function showTestSummary(contentArea, record) {
        console.log(record);
        var chart_id = "chart_" + Math.round(Math.random() * 10000);
        var ext_options = { chart_id: chart_id };
        if (record["stats"]) {
          ext_options["stats_yaml"] = jsyaml.safeDump(record["stats"]);
        }
        contentArea.append(test_summary_template(
            {record: $.extend({}, record, ext_options)}
        ));
        if (record["chart"]) {
          var meta = record["meta"];
          var axes = [];
          axes[meta[1][0]] = 'y';
          var axis = {
            x: {label: concatenate(meta[0])},
            y: {label: concatenate(meta[1]), min: 0}
          };
          if (meta.length > 2) {
            axes[meta[2][0]] = 'y2';
            axis['y2'] = {label: concatenate(meta[2]), min: 0, show: true}
          }

          c3.generate({
            bindto: "#" + chart_id,
            data: {
              x: 'concurrency',
              columns: record["chart"],
              axes: axes
            },
            axis: axis
          });
        }
      }

      function showAgentsTable(contentArea, filteredRecords) {
        var agent_ids = {};
        $.each(filteredRecords, function(_i, record){
          if (record.agent) {
            agent_ids[record.agent] = true;
          }
        });

        var agents = getAgentsByIds(agent_ids);
        if (agents.length == 0) return;

        // add slave agents
        var slave_agent_ids = {};
        $.each(agents, function(_i, agent){
          if (agent.slave_id) {
            slave_agent_ids[agent.slave_id] = true;
          }
        });
        agents = $.merge(agents, getAgentsByIds(slave_agent_ids));

        contentArea.append(agents_table_template({
          agents: agents,
          table_id: "agents_table"
        }));
        $("#agents_table").dataTable({
          "autoWidth": true,
          "paging": false,
          "ordering": true,
          "info": false
        });
      }

      function makeURL(record, s) {
        var extra = {};
        extra[s] = record[s];
        return "#" + $.map($.extend({}, state, extra), function (val, index) {
          return val? (index + "=" + val) : null;
        }).join(":")
      }

      function showRecordsTable(contentArea, filteredRecords) {
        $.each(filteredRecords, function(_i, record) {
          $.each(fields, function(_j, field){
            if (record[field]) {
              record[field + "_url"] = makeURL(record, field);
            }
          });
        });

        contentArea.append(records_table_template({
          records: filteredRecords,
          table_id: "records_table"
        }));
        $("#records_table").dataTable({
          autoWidth: true,
          paging: filteredRecords.length > tablePageSize,
          ordering: true,
          info: false,
          searching: filteredRecords.length > tablePageSize
        });
      }

      function showSlaTable(contentArea, records) {
        if (records.length == 0) return;

        contentArea.append(sla_table_template({
          records: records,
          table_id: "sla_table"
        }));
        $("#records_table").dataTable({
          autoWidth: true,
          paging: records.length > tablePageSize,
          ordering: true,
          info: false,
          searching: records.length > tablePageSize
        });
      }

      function showErrors(contentArea, records) {
        if (records.length == 0) return;

        contentArea.append(errors_template({
          records: records,
          table_id: "errors_list"
        }));
      }

      /* Update cycle */

      function update() {
        var filteredRecords = filterRecords(report.records);
        console.log(filteredRecords);
        var slaRecords = [];
        var errorRecords = [];
        $.each(filterRecords(report.records), function(_i, record) {
          if (record["sla_info"]) {
            slaRecords.push(record);
          }
          if (record["is_status_error"]) {
            errorRecords.push(record);
          }
        });

        var contentArea = $("#content_area");
        contentArea.empty();

        updateSelectors();

        showRecordsTable(contentArea, filteredRecords);
        showSlaTable(contentArea, slaRecords);
        showErrors(contentArea, errorRecords);

        if (state["scenario"] != "" && state["test"] != "" &&
                state["concurrency"] != "" &&
                state["agent"] != "") {
          showAgentRecord(contentArea, filteredRecords[0]);
        }
        if (state["scenario"] != "" && state["test"] != "" &&
                state["concurrency"] != "" && state["node"] == "" &&
                state["agent"] == "") {
          var agg_recs = filterRecords(report.records, "concurrency");
          if (agg_recs.length > 0) {
            showConcurrencySummary(contentArea, agg_recs[0]);
          }
        }
        if (state["scenario"] != "" && state["test"] != "" &&
                state["concurrency"] == "" && state["node"] == "" &&
                state["agent"] == "") {
          var test_recs = filterRecords(report.records, "test");
          if (test_recs.length > 0) {
            showTestSummary(contentArea, test_recs[0]);
          }
        }
        if (state["test"] != "") {
          showTestSpecification(contentArea, report.tests[state["test"]]);
        }
        if (state["agent"] == "") {
          showAgentsTable(contentArea, filteredRecords);
        }
        if (state["scenario"] != "") {
          showScenarioSource(contentArea, report.scenarios[state["scenario"]]);
        }
      }

      function parseUrlToState() {
        var hashUrl = window.location.hash.substr(1);

        $.each(hashUrl.split(":"), function (_i, pair) {
          var kv = pair.split("=");
          if (kv.length == 2) {
            state[kv[0]] = decodeURIComponent(kv[1]);
          }
        });
      }

      // entry-point
      parseUrlToState();
      console.log(state);

      // pre-process records
      $.each(report.records, function(_i, record) {
        if (record.status) {
          record["is_status_ok"] = record.status == "ok";
          record["is_status_lost"] = record.status == "lost";
          record["is_status_interrupted"] = record.status == "interrupted";
          record["is_status_error"] = record.status == "error";
        }
      });

      // auto-select filters with 1 option
      $.each(fields, function(_i, field) {
        var values = getFieldValues(field, report.records);
        if (values.length == 1) {
          state[field] = values[0];
        }
      });

      update();

      $(window).on('hashchange', function() {
        parseUrlToState();
        update()
      });

      $('[data-toggle="tooltip"]').tooltip();
    });
  </script>

  <style type="text/css">
  </style>

</head>

<body>

<div class="container" id="container">
  <div class="row text-center">
    <h1>Shaker | The Report</h1>
  </div>
  <hr>
  <div class="row">
    <div class="col-md-2">
      <label for="scenario_selector" title="Scenario name">Scenario</label>
      <select id="scenario_selector" class="form-control" data-placeholder="- Any scenario -"></select>
    </div>
    <div class="col-md-2">
      <label for="test_selector" title="Test name">Test Case</label>
      <select id="test_selector" class="form-control" data-placeholder="- Any test case -"></select>
    </div>
    <div class="col-md-2">
      <label for="concurrency_selector" title="Concurrency">Concurrency</label>
      <select id="concurrency_selector" class="form-control" data-placeholder="- Any concurrency -"></select>
    </div>
    <div class="col-md-2">
      <label for="node_selector" title="Host / Compute node">Host</label>
      <select id="node_selector" class="form-control" data-placeholder="- Any node -"></select>
    </div>
    <div class="col-md-2">
      <label for="agent_selector" title="Agent">Agent</label>
      <select id="agent_selector" class="form-control" data-placeholder="- Any agent -"></select>
    </div>
  </div>

  <div id="content_area" class="row">
    <!-- Container for the screen content -->
  </div>

  <div id="footer" class="row">&nbsp;</div>
</div>

<!-- TEMPLATES --------------------------------------------------------------->

<!-- Scenario File -->
<script id="scenario_source_template" type="text/x-handlebars-template">
  <h3>Scenario</h3>
  <pre>{{ data }}</pre>
</script>

<!-- Test Specification -->
<script id="test_specification_template" type="text/x-handlebars-template">
  <h3>Test Specification</h3>
  <pre>{{ data }}</pre>
</script>

<!-- Executor Result -->
<script id="executor_template" type="text/x-handlebars-template">
  <h3>Execution Summary</h3>
  {{#with record}}
  <div id="{{ chart_id }}"></div>
  {{#if is_status_ok}}<span class="label label-success"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span>success</span>{{/if}}
  {{#if is_status_lost}}<span class="label label-danger"><span class="glyphicon glyphicon-alert" aria-hidden="true"></span>lost</span>{{/if}}
  {{#if is_status_interrupted}}<span class="label label-warning"><span class="glyphicon glyphicon-stop" aria-hidden="true"></span>interrupted</span>{{/if}}
  {{#if is_status_error}}<span class="label label-danger"><span class="glyphicon glyphicon-alert" aria-hidden="true"></span>error</span>{{/if}}
  {{#if stats_yaml}}
    <h4>Stats</h4>
    <pre>{{ stats_yaml }}</pre>
  {{/if}}
  {{#if time_info}}
    <h4>Time Info</h4>
    <pre>{{ time_info }}</pre>
  {{/if}}
  <h4>Command</h4>
  <pre>{{ command_yaml }}</pre>
  {{#if stdout}}
    <h4>Stdout</h4>
    <pre>{{ stdout }}</pre>
  {{/if}}
  {{#if verbose}}
    <h4>Verbose Info</h4>
    <pre>{{ verbose }}</pre>
  {{/if}}
  {{#if stderr}}
    <h4>Stderr</h4>
    <pre>{{ stderr }}</pre>
  {{/if}}
  {{/with}}
</script>

<!-- Concurrency summary -->
<script id="concurrency_summary_template" type="text/x-handlebars-template">
  {{#with record}}
  <div id="{{ chart_id  }}"></div>
  <h3>Per-node chart</h3>
  <div id="{{ node_chart_id  }}"></div>
  <h3>Stats</h3>
  <pre>{{ stats_yaml }}</pre>
  {{/with}}
</script>

<!-- Test summary -->
<script id="test_summary_template" type="text/x-handlebars-template">
  {{#with record}}
  <div id="{{ chart_id   }}"></div>
  {{#if stats_yaml}}
    <h3>Stats</h3>
    <pre>{{ stats_yaml }}</pre>
  {{/if}}
  {{/with}}
</script>

<!-- Records Table -->
<script id="records_table_template" type="text/x-handlebars-template">
  <h3>Records</h3>
  <table class="table table-striped" id="{{ table_id  }}">
    <thead>
    <tr>
      <th>Scenario</th>
      <th>Test Case</th>
      <th>Concurrency</th>
      <th>Host / Compute Node</th>
      <th>Agent</th>
      <th>Status</th>
    </tr>
    </thead>
    <tbody>
    {{#records}}
    <tr>
      <td><a href="{{ scenario_url }}">{{ scenario }}</a></td>
      <td><a href="{{ test_url }}">{{ test }}</a></td>
      <td><a href="{{ concurrency_url }}">{{ concurrency }}</a></td>
      <td><a href="{{ node_url }}">{{ node }}</a></td>
      <td><a href="{{ agent_url }}">{{ agent }}</a></td>
      <td>
        {{#if is_status_ok }}
          <span class="label label-success">
            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
            success
          </span>
        {{/if}}
        {{#if is_status_lost }}
          <span class="label label-danger">
            <span class="glyphicon glyphicon-alert" aria-hidden="true"></span>
            lost
          </span>
        {{/if}}
        {{#if is_status_interrupted }}
          <span class="label label-warning">
            <span class="glyphicon glyphicon-stop" aria-hidden="true"></span>
            interrupted
          </span>
        {{/if}}
        {{#if is_status_error }}
          <span class="label label-danger">
            <span class="glyphicon glyphicon-stop" aria-hidden="true"></span>
            error
          </span>
        {{/if}}
      </td>
    </tr>
    {{/records}}
    </tbody>
  </table>
</script>

<!-- Agents List -->
<script id="agents_table_template" type="text/x-handlebars-template">
  <h3>Agents</h3>
  <table class="table table-striped" id="{{ table_id }}">
    <thead>
    <tr>
      <th>Agent</th>
      <th>Mode</th>
      <th>IP</th>
      <th>Node</th>
      <th>AZ</th>
    </tr>
    </thead>
    <tbody>
    {{#agents}}
    <tr>
      <td>{{ id }}</td>
      <td>{{ mode }}</td>
      <td>{{ ip }}</td>
      <td>{{ node }}</td>
      <td>{{ zone }}</td>
    </tr>
    {{/agents}}
    </tbody>
  </table>
</script>

<!-- SLA List -->
<script id="sla_table_template" type="text/x-handlebars-template">
  <h3>Agents</h3>
  <table class="table table-striped" id="{{  table_id }}">
    <thead>
    <tr>
      <th>Condition</th>
      <th>Location</th>
      <th>Status</th>
    </tr>
    </thead>
    <tbody>
    {{#records}}
    <tr>
      <td>{{ sla }}</td>
      <td>{{ location }}</td>
      <td>
        {{#if is_status_ok }}
          <span class="text-success">
            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
            {{ status }}
          </span>
        {{else}}
          <span class="text-danger">
            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
            {{ status }}
          </span>
        {{/if}}
      </td>
    </tr>
    {{/records}}
    </tbody>
  </table>
</script>

<!-- Errors -->
<script id="errors_template" type="text/x-handlebars-template">
  <h3>Errors</h3>
  <div class="text-danger">
    <ul>
    {{#records}}
      <li>{{ info }}<br/>{{ stderr }}{{ traceback }}</li>
    {{/records}}
    </ul>
  </div>
</script>

</body>
</html>